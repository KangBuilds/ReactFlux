import{p as _t,m as ie,u as f,r as g,d as O,P as ls,i as cs,o as bt,a as ds,b as us,c as hs,e as G,M as b,C as ms,j as e,f as J,g as Ue,h as ne,A as vt,I as fs,T as _,S as Se,k as $e,l as nt,n as ps,q as gs,s as Be,t as xs,v as ys,w as Ne,B as E,x as js,D as _s,y as Ce,z as ke,E as wt,F as bs,G as vs,H as ws,J as at,K as St,L as Ss,N as Ie,O as Cs,Q as Ct,R as ee,U as ks,V as Is,W as Ts,X as Fs,Y as Es,Z as K,_ as Q,$ as ot,a0 as R,a1 as ue,a2 as W,a3 as kt,a4 as it,a5 as It,a6 as As,a7 as Tt,a8 as L,a9 as Ns,aa as oe,ab as Ls,ac as Rs,ad as Ms,ae as Ds,af as Ps,ag as Vs,ah as zs,ai as Os,aj as Ft,ak as Et,al as He,am as Us,an as $s,ao as Bs,ap as Hs,aq as qs,ar as Ws,as as Ks,at as Gs,au as Le,av as Ys,aw as Xs,ax as Js,ay as Te,az as Qs,aA as Zs,aB as er,aC as tr,aD as sr,aE as lt,aF as At,aG as rr,aH as nr,aI as ar,aJ as qe,aK as or,aL as ct,aM as ir,aN as lr,aO as cr,aP as dr,aQ as ur,aR as hr,aS as mr,aT as fr}from"./vendor-DVnNU1pO.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();const pr="modulepreload",gr=function(t){return"/"+t},dt={},ge=function(s,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(l=>{if(l=gr(l),l in dt)return;dt[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":pr,d||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),d)return new Promise((x,p)=>{h.addEventListener("load",x),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return a.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return s().catch(i)})},xr=(t,s,r)=>{const n=t[s];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},yr=()=>{const{language:t}=I.get(),s=We();return t||s},We=()=>{const t=navigator.language;return t==="zh-Hans-CN"?"zh-CN":t},Nt={articleWidth:90,fontSize:1.05,homePage:"all",language:We(),layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},I=_t("settings",Nt,{encode:JSON.stringify,decode:JSON.parse}),U=t=>I.get()[t],q=t=>I.set({...I.get(),...t}),jr=()=>I.set(Nt),A=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},H=ie({polyglot:null}),_r=A(H,"polyglot"),br=async(t,s)=>{let r,n=t;try{r=await xr(Object.assign({"../locales/en-US.json":()=>ge(()=>import("./en-US-BgTNpLhj.js"),[]),"../locales/es-ES.json":()=>ge(()=>import("./es-ES-ZAv43Hxo.js"),[]),"../locales/zh-CN.json":()=>ge(()=>import("./zh-CN-48FLAeXc.js"),[])}),`../locales/${t}.json`,3)}catch{r=await ge(()=>import("./en-US-BgTNpLhj.js"),[]),n="en-US"}{const a=new ls({phrases:r.default,locale:n});_r(a)}},Lt=()=>{const{language:t}=f(I);g.useEffect(()=>{t?(br(t),t==="zh-CN"?O.locale("zh-cn"):t==="es"||t.startsWith("es-")?O.locale("es"):O.locale("en")):q({language:We()})},[t])},Ke=ie({addFeedModalVisible:!1,settingsModalVisible:!1}),vr=A(Ke,"addFeedModalVisible"),wr=A(Ke,"settingsModalVisible"),Ge=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=f(Ke);return{addFeedModalVisible:t,setAddFeedModalVisible:vr,settingsModalVisible:s,setSettingsModalVisible:wr}},he=()=>{const[t,s]=g.useState(window.innerWidth),r=t<=768,n=t<=992;return g.useEffect(()=>{const a=()=>s(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},Rt={server:"",token:"",username:"",password:""},Re=_t("auth",Rt,{encode:JSON.stringify,decode:JSON.parse}),Mt=t=>Re.set(t),Sr=()=>Mt(Rt),Cr=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},Fe=t=>{const{server:s,token:r,username:n,password:a}=t;return!s||!cs(s,{require_protocol:!0})&&!Cr(s)?!1:r||n&&a},kr=()=>bt.create({retry:3,onRequest({_request:t,options:s}){const r=Re.get();if(!Fe(r))throw new Error("Invalid auth");const{server:n,token:a,username:i,password:o}=r;s.baseURL=n,s.headers=a?{"X-Auth-Token":a}:{Authorization:`Basic ${btoa(`${i}:${o}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var i;s.status===401&&(localStorage.removeItem("auth"),await is.navigate("/login"));const a=((i=s._data)==null?void 0:i.error_message)??s.statusText;throw console.error("Response error: ",a),new Error(a)}}),S=kr();S.get=t=>S(t,{method:"GET"});S.post=(t,s)=>S(t,{method:"POST",body:s});S.put=(t,s)=>S(t,{method:"PUT",body:s});const Ir=async()=>S.get("/v1/categories"),Tr=async t=>S.post("/v1/categories",{title:t}),Fr=async t=>S.raw(`/v1/categories/${t}`,{method:"DELETE"}),Er=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return S.put(`/v1/categories/${t}`,n)},Ar=async t=>S.put(`/v1/categories/${t}/mark-all-as-read`);O.extend(ds);O.extend(us);O.extend(hs);const Nr=t=>O(t).isAfter(O().subtract(24,"hour")),Lr=()=>O().subtract(24,"hour").unix(),Rr=()=>O().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),Mr=t=>O(t).format("dddd, MMMM D, YYYY h:mm A"),Dt=(t,s)=>{const{polyglot:r}=H.get();if(!s){const j=O(),v=O(t),N=v.from(j),w=O.duration(j.diff(v)).asSeconds();return w>=0&&w<60?r.t("date.just_now"):N}const n=O(),i=O(t).diff(n),o=O.duration(Math.abs(i)),c=o.years(),l=o.months(),d=o.days(),u=o.hours(),h=o.minutes(),x=[];if(c>0&&x.push(r.t(c>1?"date.years":"date.year",{count:c})),l>0&&x.push(r.t(l>1?"date.months":"date.month",{count:l})),d>0&&x.push(r.t(d>1?"date.days":"date.day",{count:d})),u>0&&x.push(r.t(u>1?"date.hours":"date.hour",{count:u})),h>0&&x.push(r.t(h>1?"date.minutes":"date.minute",{count:h})),x.length===0)return r.t("date.just_now");const p=x.join(" ");return i>0?r.t("date.in_time",{time:p}):r.t("date.time_ago",{time:p})},Me=async(t,s)=>S.put("/v1/entries",{entry_ids:t,status:s}),Dr=async t=>S.put(`/v1/entries/${t}/bookmark`),Pr=async t=>S.get(`/v1/entries/${t}/fetch-content`),le=(t,s={})=>{const{baseUrl:r,orderField:n,offset:a,limit:i,status:o}=t,c=U("orderDirection"),l=new URLSearchParams({order:n,direction:c,offset:a,limit:i,...s});return o&&l.append("status",o),`${r}?${l}`},Vr=async(t=0,s=null)=>{const r=U("orderBy"),n=U("pageSize"),a=U("showAllFeeds"),i={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s},o={globally_visible:!a};return S.get(le(i,o))},be=async(t=0,s=null,r=null)=>{const n=U("orderBy"),a=r??U("pageSize"),i=U("showAllFeeds"),o=Lr(),c={baseUrl:"/v1/entries",orderField:n,offset:t,limit:a,status:s},l={globally_visible:!i,published_after:o};return S.get(le(c,l))},Pt=async(t=0,s=null)=>{const r=U("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},a={starred:"true"};return S.get(le(n,a))},Vt=async(t=0)=>{const s=U("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return S.get(le(r))},zr=async()=>S.get("/v1/feeds"),Or=async()=>S.get("/v1/feeds/counters"),Ur=async t=>S.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),$r=async()=>S.raw("/v1/feeds/refresh",{method:"PUT"}),Br=async(t,s,r)=>S.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),Hr=async t=>S.raw(`/v1/feeds/${t}`,{method:"DELETE"}),ut=async(t,s)=>{const{categoryId:r,title:n,siteUrl:a,feedUrl:i,hidden:o,disabled:c,isFullText:l}=s;return S.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:a,feed_url:i,hide_globally:o,disabled:c,crawler:l})},qr=async t=>S.put(`/v1/feeds/${t}/mark-all-as-read`),Wr=async()=>S.get("/v1/me"),Kr=async t=>S.get(`/v1/icons/${t}`),Gr=async()=>S.get("/v1/version"),Yr=async()=>{const t=await Wr();return S.put(`/v1/users/${t.data.id}/mark-all-as-read`)},zt={isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1},V=ie(zt),Ye=G(V,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(a=>({...a,unreadCount:s[a.id]??0})).sort((a,i)=>a.title.localeCompare(i.title,"en"))}),me=G([V,Ye],(t,s)=>{const{categoriesData:r}=t;return r.map(a=>{const i=s.filter(o=>o.category.id===a.id);return{...a,unreadCount:i.reduce((o,c)=>o+(c.unreadCount??0),0),feedCount:i.length}}).sort((a,i)=>a.title.localeCompare(i.title,"en"))}),Ot=G(me,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),Xe=G([Ye,Ot],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Ut=G([Ye,Xe,I],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),Xr=G([me,Ot,I],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),$t=G(Ut,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),Jr=G([V,Ut],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[a,i])=>s.some(o=>o.id===Number(a))?n+i:n,0)}),ve=A(V,"categoriesData"),se=A(V,"feedsData"),De=A(V,"historyCount"),ht=A(V,"isAppDataReady"),Pe=A(V,"starredCount"),Bt=A(V,"unreadInfo"),Ht=A(V,"unreadTodayCount"),Qr=A(V,"isVersionAtLeast2_2_0"),Zr=()=>V.set(zt),qt=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(i=>i.id===n.id)||n)},Ve=(t,s)=>{const r={};let n=0;const a=t.filter(l=>l.status!==s);if(a.length===0)return;De(s==="read"?l=>l+a.length:l=>Math.max(0,l-a.length));for(const l of a){const d=l.feed.id,u=Nr(l.published_at),h=s==="read"?-1:1;r[d]=(r[d]??0)+h,n+=u?h:0}Ht(l=>Math.max(0,l+n)),Bt(l=>{const d={...l};for(const[u,h]of Object.entries(r))d[u]=Math.max(0,(d[u]??0)+h);return d});const i=a.map(l=>({...l,status:s})),{activeContent:o}=F.get(),c=i.find(l=>l.id===(o==null?void 0:o.id));c&&X(c),fe(l=>qt(l,i))},Je=()=>{const{activeContent:t}=f(F),s=(o,c)=>{Ve([o],c)},r=(o,c)=>{c?(Pe(d=>d+1),ms({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Pe(d=>Math.max(0,d-1));const l={...o,starred:c};t&&X(l),fe(d=>qt(d,[l]))};return{handleEntryStatusUpdate:s,handleFetchContent:async()=>{try{const o=await Pr(t.id);b.success("Fetched content successfully"),X({...t,content:o.content})}catch{b.error("Failed to fetch content, please try again later")}},handleToggleStarred:async o=>{const c=!o.starred;r(o,c),Dr(o.id).catch(()=>{b.error(`Failed to ${c?"star":"unstar"} entry, please try again later`),r(o,!c)})},handleToggleStatus:async o=>{const c=o.status,l=c==="read"?"unread":"read";s(o,l),Me([o.id],l).catch(()=>{b.error(`Failed to mark entry as ${l}, please try again later`),s(o,c)})}}},en=(t,s)=>{if(t.length===0||s==="none")return t;const r=t.map((d,u)=>({id:d.id,index:u})),n=new Map,a=new Map,i=new Map,o=[],c=t.slice().sort((d,u)=>d.id-u.id).filter(d=>{const{hash:u,title:h,url:x,id:p}=d;switch(s){case"hash":if(n.has(u))return o.push(d),!1;n.set(u,p);break;case"title":if(a.has(h))return o.push(d),!1;a.set(h,p);break;case"url":if(i.has(x))return o.push(d),!1;i.set(x,p);break;default:return!0}return!0}),l=o.filter(d=>d.status==="unread").map(d=>d.id);return l.length>0&&(Ve(o,"read"),Me(l,"read").catch(()=>{b.error("Failed to mark duplicate entries as read"),Ve(o,"unread")})),c.sort((d,u)=>{const h=r.find(p=>p.id===d.id).index,x=r.find(p=>p.id===u.id).index;return h-x})},tn=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},xe=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,a=r?s.toLowerCase():s;if(a.length===0)return 0;const i=tn(a);let o=0,c=0;for(;o<n.length;)if(n[o]===a[c]?(o++,c++):c!==0?c=i[c-1]:o++,c===a.length)return o-c;return-1},sn=t=>{const s=[],r=[];let n=[];const a=[],i=t.match(/([-+|]?)\s*"([^"]+)"/g);let o=t;i&&(n=i.map(l=>{const d=l.trim()[0],u=l.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(u);break;case"+":s.push(u);break;case"|":a.push([u]);break;default:s.push(u);break}return u}),o=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const c=o.split(/\s+/);for(const l of c){const d=l.replace(/^-|\+|\|$/,"");if(l.startsWith("-")&&d)r.push(d);else if(l.startsWith("+")&&d)s.push(d);else if(l.includes("|")){const u=l.split("|").filter(h=>h);u.length>0&&a.push(u)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:a}},rn=(t,s,r=[],n=!0)=>{const{includeTerms:a,excludeTerms:i,exactPhrases:o,orConditions:c}=sn(s);return t.filter(l=>r.some(d=>{const u=l[d];if(typeof u!="string")return!1;const h=n?u.toLowerCase():u;if(i.some(j=>xe(h,j,n)!==-1)||o.length>0&&!o.some(j=>xe(h,j,n)!==-1))return!1;const x=a.every(j=>xe(h,j,n)!==-1),p=c.length===0||c.some(j=>j.some(v=>xe(h,v,n)!==-1));return x&&p}))},nn=(t,s,r=[],n=!0)=>{try{if(!Array.isArray(t)||t.length===0)throw new Error("Invalid data input");if(typeof s!="string"||s.trim().length===0)throw new Error("Invalid query input");return rn(t,s,r,n)}catch(a){return console.error(a.message),[]}},we=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),an=(t,s,r)=>r?nn(t,r,[s]):t,Wt={activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:U("homePage"),isArticleFocused:!1,isArticleListReady:!1,offset:0,total:0},F=ie(Wt),Qe=G(F,t=>{const{entries:s,total:r}=t;return s.length<r}),Ze=G([F,V,Xe,I],(t,s,r,n)=>{const{entries:a,filterString:i,filterType:o,infoFrom:c}=t,l=an(a,o,i),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:u,showAllFeeds:h}=n,x=!["starred","history"].includes(c),p=v=>d||h||!r.includes(v.feed.id),j=x?l.filter(p):l;return u==="none"||["starred","history"].includes(c)?j:en(j,u)}),X=A(F,"activeContent"),fe=A(F,"entries"),Ee=A(F,"filterString"),Ae=A(F,"filterType"),on=A(F,"infoFrom"),re=A(F,"isArticleFocused"),mt=A(F,"isArticleListReady"),Kt=A(F,"offset"),ln=A(F,"total"),cn=()=>F.set(Wt),ft=ie(),ye=new Set,dn=t=>{const s=f(ft);return g.useEffect(()=>{s[t]||ye.has(t)||(ye.add(t),Kr(t).then(r=>{const n=`data:${r.data}`;ft.setKey(t,n),ye.delete(t)}).catch(()=>{ye.delete(t)}))},[t,s]),s[t]},un=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},pt=t=>{const s=un(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},hn=t=>`https://icons.duckduckgo.com/ip3/${pt(t.site_url)??pt(t.feed_url)}.ico`,Gt=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,n=hn(t);if(r===0)return e.jsx("img",{className:s,src:n,alt:""});const[a,i]=g.useState(n),o=dn(r);return g.useEffect(()=>{o&&i(o)},[o]),e.jsx("img",{className:s,src:a,alt:"",onError:()=>i(n)})},Yt=J.Item,mn=({category:t,path:s})=>{var o;const n=(o=f($t)[t.id])==null?void 0:o.reduce((c,l)=>c+l.unreadCount,0),a=ne(),i=()=>{a(`/category/${t.id}`),X(null)};return e.jsxs("div",{className:Ne("category-title",{"active-subMenu":s===`/category/${t.id}`,"inactive-subMenu":s!==`/category/${t.id}`}),onClick:i,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&i()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(_.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(_.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},fn=({count:t})=>e.jsx(_.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),je=({path:t,Icon:s,label:r,count:n})=>{const a=Ue(),i=ne(),o=a.pathname===t,c=()=>{i(t),X(null)};return e.jsx(Yt,{onClick:c,className:Ne("arco-menu-item",{"arco-menu-selected":o}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(fn,{count:n})]})},t)},Xt=()=>{const{homePage:t,showFeedIcon:s}=f(I),{historyCount:r,isAppDataReady:n,starredCount:a,unreadTodayCount:i}=f(V),o=f($t),c=f(Xr),l=f(Jr),{polyglot:d}=f(H),u=Ue(),h=ne(),[x,p]=g.useState([`/${t}`]),j=u.pathname;g.useEffect(()=>{p([j])},[j]);const v=()=>e.jsxs(e.Fragment,{children:[e.jsx(je,{path:"/all",Icon:ps,label:d.t("sidebar.all"),count:l}),e.jsx(je,{path:"/today",Icon:gs,label:d.t("sidebar.today"),count:i}),e.jsx(je,{path:"/starred",Icon:Be,label:d.t("sidebar.starred"),count:a}),e.jsx(je,{path:"/history",Icon:xs,label:d.t("sidebar.history"),count:r})]}),N=C=>{var z;return(z=o[C])==null?void 0:z.map(P=>e.jsx(Yt,{style:{position:"relative",overflow:"hidden"},onClick:T=>{T.stopPropagation(),h(`/feed/${P.id}`),X(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(_.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:P.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[s&&e.jsx(Gt,{feed:P,className:"feed-icon-sidebar"}),P.title]}),P.unreadCount!==0&&e.jsx(_.Ellipsis,{className:"item-count",expandable:!1,children:P.unreadCount})]})},`/feed/${P.id}`))},w=()=>c.map(C=>e.jsx(nt.Item,{name:`/category/${C.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(mn,{category:C,path:j}),expandIcon:e.jsx(ys,{}),children:N(C.id)},C.id));return e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(J,{hasCollapseButton:!1,selectedKeys:x,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(vt,{className:"avatar",size:32,children:e.jsx(fs,{style:{color:"var(--color-bg-1)"}})}),e.jsx(_.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(_.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:d.t("sidebar.articles")}),e.jsx(Se,{loading:!n,animation:!0,text:{rows:3}}),n&&v(),e.jsx(_.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:d.t("sidebar.feeds")})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx($e,{style:{maxHeight:"100%"},autoHide:!0,children:e.jsxs(J,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:x,children:[e.jsx(Se,{loading:!n,animation:!0,text:{rows:6}}),n&&e.jsx(nt,{triggerRegion:"icon",bordered:!1,children:w()})]})})})]})},pn=()=>{const{showAllFeeds:t,theme:s}=f(I),{polyglot:r}=f(H),n=[{label:r.t("header.theme_option_light"),value:"light"},{label:r.t("header.theme_option_dark"),value:"dark"},{label:r.t("header.theme_option_system"),value:"system"}],a=ne(),i=Ue().pathname,{setAddFeedModalVisible:o,setSettingsModalVisible:c}=Ge(),{isBelowLarge:l}=he(),[d,u]=g.useState(!1),[h,x]=g.useState(!1),[p,j]=g.useState(!1);g.useEffect(()=>{l||u(!1)},[l]),g.useEffect(()=>{i&&u(!1)},[i]);const v=()=>{q({showAllFeeds:!t})},N=()=>{q({theme:s==="light"?"dark":"light"})},w=()=>{jr(),x(!1)},C=()=>{Sr(),cn(),Zr(),a("/login"),b.success(r.t("header.logout_success"))},z=()=>s==="dark"?e.jsx(ks,{}):s==="system"?e.jsx(Is,{}):e.jsx(Ts,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(E,{className:"trigger",onClick:()=>u(!d),shape:"circle",size:"small",children:e.jsx(js,{})})}),e.jsx(_s,{className:"sidebar-drawer",visible:d,title:null,footer:null,closable:!1,onCancel:()=>u(!1),placement:"left",width:240,children:e.jsx(Xt,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(Ce,{size:16,children:[e.jsx(ke,{content:r.t("header.add_feed"),mini:!0,children:e.jsx(E,{shape:"circle",size:"small",type:"primary",icon:e.jsx(wt,{}),onClick:()=>o(!0)})}),e.jsx(ke,{content:t?r.t("header.hide_some_feeds"):r.t("header.show_all_feeds"),mini:!0,children:e.jsx(E,{shape:"circle",size:"small",icon:t?e.jsx(bs,{}):e.jsx(vs,{}),onClick:v})}),e.jsx(E,{shape:"circle",size:"small",icon:e.jsx(ws,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(at,{droplist:e.jsx(J,{defaultSelectedKeys:[s],className:"theme-menu",children:n.map(({label:P,value:T})=>e.jsxs(J.Item,{className:"theme-menu-item",onClick:()=>q({theme:T}),children:[P,s===T&&e.jsx(St,{style:{marginLeft:8}})]},T))}),trigger:"hover",position:"bottom",children:e.jsx(E,{icon:z(),shape:"circle",size:"small",onClick:N})}),e.jsx(at,{droplist:e.jsxs(J,{children:[e.jsxs(J.Item,{onClick:()=>c(!0),children:[e.jsx(Ss,{className:"icon-right"}),r.t("header.settings")]},"0"),e.jsxs(J.Item,{onClick:()=>x(!0),children:[e.jsx(Ie,{className:"icon-right"}),r.t("header.reset_settings")]},"1"),e.jsxs(J.Item,{onClick:()=>j(!0),children:[e.jsx(Cs,{className:"icon-right"}),r.t("header.logout")]},"2")]}),trigger:"click",position:"br",children:e.jsx(vt,{size:28,style:{cursor:"pointer"},children:e.jsx(Ct,{})})})]})}),e.jsx(ee,{title:r.t("header.settings_reset_confirm"),visible:h,onOk:w,onCancel:()=>x(!1),children:e.jsx("p",{children:r.t("header.settings_reset_description")})}),e.jsx(ee,{title:r.t("header.logout_confirm"),visible:p,onOk:C,onCancel:()=>j(!1),children:e.jsx("p",{children:r.t("header.logout_description")})})]})},gn=(t,s)=>{const r=t.split("."),n=s.split(".");for(let a=0;a<Math.max(r.length,n.length);a++){const i=r[a]||"0",o=n[a]||"0",c=i.localeCompare(o,void 0,{numeric:!0});if(c!==0)return c}return 0},et=()=>{const t=g.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,ht(!1);try{const r=await Promise.all([Or(),be(0,"unread"),Pt(),Vt(),zr(),Ir(),Gr()]),[n,a,i,o,c,l,d]=r,u=c.reduce((h,x)=>(h[x.id]=n.unreads[x.id]??0,h),{});Bt(u),Ht(a.total??0),Pe(i.total??0),De(o.total??0),se(c),ve(l),Qr(gn(d.version,"2.2.0")>=0),ht(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},ze={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Green:{light:"#00B42A",dark:"#27C346"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Magenta:{light:"#F5319D",dark:"#F756A9"}},Oe=t=>{const s=ze[t]||ze.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=U("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},Jt=t=>{Fs(Oe(t),{list:!0}).map(Es).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},xn=()=>{const{articleWidth:t,fontSize:s,layout:r,showDetailedRelativeTime:n,showFeedIcon:a,themeColor:i}=f(I),{polyglot:o}=f(H),c=l=>{q(l),l.themeColor&&Jt(l.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.theme_color_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.theme_color_description")})]}),e.jsx("div",{style:{display:"flex"},children:Object.keys(ze).map(l=>e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:Oe(l),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:l===i?`1px solid ${Oe(l)}`:"none"},onClick:()=>c({themeColor:l}),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&c({themeColor:l})},"aria-label":o.t("appearance.theme_color_aria_label",{color:l})}))})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.compact_article_list_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.compact_article_list_description")})]}),e.jsx("div",{children:e.jsx(Q,{checked:r==="small",onChange:l=>c({layout:l?"small":"large"})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.show_detailed_relative_time_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.show_detailed_relative_time_description")})]}),e.jsx("div",{children:e.jsx(Q,{checked:n,onChange:l=>c({showDetailedRelativeTime:l})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.show_feed_icon_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.show_feed_icon_description")})]}),e.jsx("div",{children:e.jsx(Q,{checked:a,onChange:l=>c({showFeedIcon:l})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.font_size_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.font_size_description")})]}),e.jsx("div",{children:e.jsxs(Ce,{children:[e.jsx(_.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(ot,{formatTooltip:l=>`${l}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:l=>c({fontSize:l})}),e.jsx(_.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.article_width_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.article_width_description")})]}),e.jsx("div",{children:e.jsxs(Ce,{children:[e.jsx(_.Text,{children:"60%"}),e.jsx(ot,{formatTooltip:l=>`${l}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:l=>c({articleWidth:l})}),e.jsx(_.Text,{children:"90%"})]})})]})]})},yn=()=>{const t=f(me),[s]=R.useForm(),[r,n]=g.useState(!1),[a,i]=g.useState(""),[o,c]=g.useState({}),[l,d]=g.useState(!1),u=async()=>{if(a.trim()){try{const p=await Tr(a);ve(j=>[...j,{...p}]),b.success("Category added successfully")}catch(p){console.error("Failed to add category: ",p),b.error("Failed to add category")}i(""),d(!1)}},h=async(p,j,v)=>{try{const N=await Er(p,j,v);se(w=>w.map(C=>C.category.id===p?{...C,category:{...C.category,title:j,hide_globally:v}}:C)),ve(w=>w.map(C=>C.id===p?{...C,...N}:C)),b.success("Category updated successfully")}catch{b.error("Failed to update category")}n(!1),s.resetFields()},x=async p=>{try{(await Fr(p.id)).status===204?(ve(v=>v.filter(N=>N.id!==p.id)),b.success(`Deleted category: ${p.title}`)):b.error(`Failed to delete category: ${p.title}`)}catch(j){console.error(`Failed to delete category: ${p.title}`,j),b.error(`Failed to delete category: ${p.title}`)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(p=>e.jsx(ue,{className:"tag-style",closable:p.feedCount===0,size:"medium",onClick:()=>{c(p),n(!0),s.setFieldsValue({title:p.title})},onClose:async j=>{j.stopPropagation(),await x(p)},children:p.title},p.id)),l?e.jsx(W,{autoFocus:!0,className:"input-style",onBlur:u,onChange:i,onPressEnter:u,size:"small",value:a}):e.jsx(ue,{className:"add-category-tag",icon:e.jsx(wt,{}),onClick:()=>d(!0),size:"medium",tabIndex:0})]}),o&&e.jsx(ee,{className:"modal-style",onOk:s.submit,title:"Edit Category",unmountOnExit:!0,visible:r,onCancel:()=>{n(!1),s.resetFields()},children:e.jsxs(R,{form:s,layout:"vertical",onSubmit:p=>h(o.id,p.title,p.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(R.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(W,{placeholder:"Please input category title"})}),e.jsx(R.Item,{label:"Hidden",field:"hidden",initialValue:o.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Q,{})})]})})]})},jn=t=>new Promise(s=>setTimeout(s,t)),Qt=kt(""),gt=A(Qt),Zt=G([V,Qt],(t,s)=>{const{feedsData:r}=t;return[...r].sort((n,a)=>n.disabled&&!a.disabled?1:!n.disabled&&a.disabled?-1:0).sort((n,a)=>a.parsing_error_count-n.parsing_error_count).filter(n=>we(n.title,s)||we(n.site_url,s)||we(n.feed_url,s))}),_n=G(Zt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),xt=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:Rr()}:t,bn=()=>{const t=f(me),{isAppDataReady:s}=f(V),{showDetailedRelativeTime:r}=f(I),n=f(Zt),a=f(_n),{polyglot:i}=f(H),[o,c]=g.useState(!1),[l]=R.useForm(),[d,u]=g.useState(!1),[h,x]=g.useState(""),[p,j]=g.useState(null),{isBelowMedium:v}=he();g.useEffect(()=>{gt("")},[]);const N=m=>{j(m),u(!0),l.setFieldsValue({category:m.category.id,title:m.title,siteUrl:m.site_url,feedUrl:m.feed_url,hidden:m.hidden,disabled:m.disabled,crawler:m.crawler})},w=async(m,y,k=!0)=>{try{const D=(await m()).status===204;return k&&(D?b.success(i.t("feed_table.refresh_success")):b.error(i.t("feed_table.refresh_error"))),se(te=>te.map(ae=>y(ae,D))),D}catch{return k&&b.error(i.t("feed_table.refresh_error")),se(D=>D.map(te=>y(te,!1))),!1}},C=async(m,y=!0)=>{const k=m.id||m.key;return w(()=>Ur(k),(M,D)=>xt(M,D,k),y)},z=async()=>{try{const m=await Promise.all(n.map(async y=>{const k=new URL(y.feed_url).hostname;if(k===h)return y;const M=y.feed_url.replace(k,h),D=await ut(y.id,{feedUrl:M});return{...y,...D}}));se(y=>y.map(k=>m.find(M=>M.id===k.id)||k)),b.success(i.t("feed_table.bulk_update_success")),c(!1)}catch{b.error(i.t("feed_table.bulk_update_error"))}},P=()=>{const[m,y]=g.useState(!1),k=async()=>{y(!1),await w($r,xt)},M=async()=>{y(!1);const te=n.filter(B=>B.parsing_error_count>0);b.success(i.t("feed_table.bulk_refresh_error_feeds_message"));let ae=0,Z=0;for(const B of te)await C(B,!1)?ae++:Z++,await jn(500);b.success(i.t("feed_table.bulk_refresh_error_feeds_result",{success:ae,failure:Z}))},D=()=>y(!1);return e.jsxs(e.Fragment,{children:[e.jsx(E,{icon:e.jsx(Ie,{}),shape:"circle",onClick:()=>y(!0)}),e.jsx(ee,{className:"edit-modal",onCancel:D,title:i.t("feed_table.refresh_feeds_title"),visible:m,footer:[e.jsx(E,{onClick:D,children:i.t("feed_table.refresh_feeds_cancel")},"cancel"),e.jsx(E,{type:"outline",onClick:M,children:i.t("feed_table.refresh_feeds_error")},"error"),e.jsx(E,{type:"primary",onClick:k,children:i.t("feed_table.refresh_feeds_all")},"all")],children:e.jsx("p",{children:i.t("feed_table.refresh_feeds_description")})})]})},T=async m=>{try{(await Hr(m.key)).status===204?(se(k=>k.filter(M=>M.id!==m.key)),b.success(i.t("feed_table.remove_feed_success",{title:m.title}))):b.error(i.t("feed_table.remove_feed_error",{title:m.title}))}catch(y){console.error(`Failed to unfollow feed: ${m.title}`,y),b.error(i.t("feed_table.remove_feed_error",{title:m.title}))}},$=[{title:i.t("feed_table.table_title"),dataIndex:"title",sorter:(m,y)=>m.title.localeCompare(y.title,"en"),render:(m,y)=>{const k=y.parsing_error_count;let M=y.disabled?`🚫 ${m}`:m;k>0&&(M=`⚠️ ${m}`);const D=e.jsxs("div",{children:[m,k>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"⚠️ Parsing error count: ",k]})]});return e.jsx(_.Ellipsis,{expandable:!1,children:e.jsx(ke,{mini:!0,content:D,children:M})})}},!v&&{title:i.t("feed_table.table_url"),dataIndex:"feed_url",sorter:(m,y)=>m.feed_url.localeCompare(y.feed_url,"en"),render:m=>e.jsx(_.Ellipsis,{expandable:!1,showTooltip:!0,children:m})},{title:i.t("feed_table.table_category"),dataIndex:"category.title",sorter:(m,y)=>m.category.title.localeCompare(y.category.title,"en"),render:m=>e.jsx(_.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(ue,{children:m})})},!v&&{title:i.t("feed_table.table_checked_at"),dataIndex:"checked_at",sorter:(m,y)=>m.checked_at.localeCompare(y.checked_at,"en"),render:m=>e.jsx(_.Ellipsis,{expandable:!1,children:Dt(m,r)})},{title:i.t("feed_table.table_actions"),dataIndex:"op",fixed:"right",width:100,render:(m,y)=>e.jsxs(Ce,{children:[e.jsx("button",{"aria-label":i.t("feed_table.table_feed_edit_label"),className:"list-item-action",onClick:()=>N(y),type:"button",children:e.jsx(it,{})}),e.jsx("button",{"aria-label":i.t("feed_table.table_feed_refresh_label"),className:"list-item-action",onClick:()=>C(y),type:"button",children:e.jsx(Ie,{})}),e.jsx(It,{focusLock:!0,position:"left",title:i.t("feed_table.table_feed_remove_confirm"),onOk:()=>T(y),children:e.jsx("span",{className:"list-item-action",children:e.jsx(As,{})})})]})}].filter(Boolean),Y=async(m,y)=>{try{const k=await ut(m,y);se(M=>M.map(D=>D.id===m?{...D,...k}:D)),b.success(i.t("feed_table.update_feed_success")),u(!1),l.resetFields()}catch{b.error(i.t("feed_table.update_feed_error"))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{alignItems:"center",display:"flex",width:"100%"},children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(W.Search,{className:"search-input",placeholder:i.t("feed_table.search_placeholder"),searchButton:!0,onChange:gt})}),e.jsxs("div",{style:{display:"flex",gap:16,paddingBottom:16,paddingLeft:16},children:[e.jsx(E,{icon:e.jsx(it,{}),shape:"circle",onClick:()=>c(!0)}),e.jsxs(ee,{className:"edit-modal",onOk:z,title:i.t("feed_table.modal_bulk_update_title"),visible:o,onCancel:()=>{c(!1),x("")},children:[e.jsx("p",{children:i.t("feed_table.modal_bulk_update_description")}),e.jsx(W,{placeholder:"rsshub.app",value:h,onChange:m=>x(m)})]}),e.jsx(P,{})]})]}),e.jsx(Tt,{borderCell:!0,className:"feed-table",columns:$,data:a,loading:!s,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),p&&e.jsx(ee,{className:"edit-modal",onOk:l.submit,title:i.t("feed_table.modal_edit_feed_title"),unmountOnExit:!0,visible:d,onCancel:()=>{u(!1),l.resetFields()},children:e.jsxs(R,{form:l,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async m=>{const y={categoryId:m.category,title:m.title,siteUrl:m.siteUrl.trim(),feedUrl:m.feedUrl.trim(),hidden:m.hidden,disabled:m.disabled,isFullText:m.crawler};y.feedUrl?await Y(p.key,y):b.error(i.t("feed_table.modal_edit_feed_submit_error"))},children:[e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_category_label"),required:!0,field:"category",rules:[{required:!0}],children:e.jsx(L,{children:t.map(m=>e.jsx(L.Option,{value:m.id,children:m.title},m.id))})}),e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(W,{placeholder:i.t("feed_table.modal_edit_feed_title_placeholder")})}),e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_site_url_label"),field:"siteUrl",rules:[{required:!0}],children:e.jsx(W,{placeholder:i.t("feed_table.modal_edit_feed_site_url_placeholder")})}),e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_feed_url_label"),field:"feedUrl",rules:[{required:!0}],children:e.jsx(W,{placeholder:i.t("feed_table.modal_edit_feed_feed_url_placeholder")})}),e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_hidden_label"),field:"hidden",initialValue:p.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Q,{})}),e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_disabled_label"),field:"disabled",initialValue:p.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Q,{})}),e.jsx(R.Item,{label:i.t("feed_table.modal_edit_feed_crawler_label"),field:"crawler",tooltip:e.jsx("div",{children:i.t("feed_table.modal_edit_feed_crawler_tooltip")}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Q,{})})]})})]})},vn=[{label:"English",value:"en-US"},{label:"Español",value:"es-ES"},{label:"简体中文",value:"zh-CN"}],wn=()=>{const{homePage:t,language:s,markReadOnScroll:r,orderBy:n,pageSize:a,removeDuplicates:i}=f(I),{polyglot:o}=f(H);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("appearance.language_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("appearance.language_description")})]}),e.jsx("div",{children:e.jsx(L,{className:"input-select",onChange:c=>q({language:c}),value:s,children:vn.map(({label:c,value:l})=>e.jsx(L.Option,{value:l,children:c},l))})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("settings.default_home_page_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("settings.default_home_page_description")})]}),e.jsx("div",{children:e.jsxs(L,{className:"input-select",onChange:c=>q({homePage:c}),value:t,children:[e.jsx(L.Option,{value:"all",children:o.t("settings.default_home_page_option_all")}),e.jsx(L.Option,{value:"today",children:o.t("settings.default_home_page_option_today")}),e.jsx(L.Option,{value:"starred",children:o.t("settings.default_home_page_option_starred")}),e.jsx(L.Option,{value:"history",children:o.t("settings.default_home_page_option_history")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("settings.entries_order_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("settings.entries_order_description")})]}),e.jsx("div",{children:e.jsxs(L,{className:"input-select",onChange:c=>q({orderBy:c}),value:n,children:[e.jsx(L.Option,{value:"published_at",children:o.t("settings.entries_order_option_published_at")}),e.jsx(L.Option,{value:"created_at",children:o.t("settings.entries_order_option_created_at")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("settings.entries_per_page_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("settings.entries_per_page_description")})]}),e.jsx("div",{children:e.jsx(Ns,{className:"input-select",defaultValue:a,min:1,mode:"button",onChange:c=>q({pageSize:c}),size:"small"})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("settings.remove_duplicates_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("settings.remove_duplicates_description")})]}),e.jsx("div",{children:e.jsxs(L,{className:"input-select",onChange:c=>q({removeDuplicates:c}),value:i,children:[e.jsx(L.Option,{value:"none",children:o.t("settings.remove_duplicates_option_none")}),e.jsx(L.Option,{value:"hash",children:o.t("settings.remove_duplicates_option_hash")}),e.jsx(L.Option,{value:"title",children:o.t("settings.remove_duplicates_option_title")}),e.jsx(L.Option,{value:"url",children:o.t("settings.remove_duplicates_option_url")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(_.Title,{heading:6,style:{marginTop:0},children:o.t("settings.mark_read_on_scroll_label")}),e.jsx(_.Text,{type:"secondary",children:o.t("settings.mark_read_on_scroll_description")})]}),e.jsx("div",{children:e.jsx(Q,{checked:r,onChange:c=>q({markReadOnScroll:c})})})]})]})},Sn=()=>{const{polyglot:t}=f(H),s=[{title:t.t("hotkeys.key"),dataIndex:"keyName",render:n=>e.jsx(ue,{children:n})},{title:t.t("hotkeys.function"),dataIndex:"description"}],r=[{key:"1",keyName:"Esc",description:t.t("hotkeys.esc")},{key:"2",keyName:"←",description:t.t("hotkeys.left")},{key:"3",keyName:"Ctrl + ←",description:t.t("hotkeys.ctrl_left")},{key:"4",keyName:"→",description:t.t("hotkeys.right")},{key:"5",keyName:"Ctrl + →",description:t.t("hotkeys.ctrl_right")},{key:"6",keyName:"B",description:t.t("hotkeys.b")},{key:"7",keyName:"D",description:t.t("hotkeys.d")},{key:"8",keyName:"M",description:t.t("hotkeys.m")},{key:"9",keyName:"S",description:t.t("hotkeys.s")},{key:"10",keyName:"V",description:t.t("hotkeys.v")}];return e.jsx(Tt,{borderCell:!0,columns:s,data:r,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}})},Cn=()=>{const{polyglot:t}=f(H),s=(r,n)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r,e.jsx("div",{style:{fontSize:"12px"},children:n})]});return e.jsxs(oe,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(oe.TabPane,{title:s(e.jsx(Ls,{style:{fontSize:"20px"}}),t.t("settings.feeds")),children:e.jsx(bn,{})},"1"),e.jsx(oe.TabPane,{title:s(e.jsx(Rs,{style:{fontSize:"20px"}}),t.t("settings.categories")),children:e.jsx(yn,{})},"2"),e.jsx(oe.TabPane,{title:s(e.jsx(Ms,{style:{fontSize:"20px"}}),t.t("settings.general")),children:e.jsx(wn,{})},"3"),e.jsx(oe.TabPane,{title:s(e.jsx(Ds,{style:{fontSize:"20px"}}),t.t("settings.appearance")),children:e.jsx(xn,{})},"4"),e.jsx(oe.TabPane,{title:s(e.jsx(Ps,{style:{fontSize:"20px"}}),t.t("settings.hotkeys")),children:e.jsx(Sn,{})},"5")]})},kn=[{required:!0}],In=[{required:!0}],Tn=[{type:"boolean"}],Fn=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=Ge();return e.jsx(ee,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(Cn,{})})},En=()=>{const t=f(me),{polyglot:s}=f(H),{addFeedModalVisible:r,setAddFeedModalVisible:n}=Ge(),[a,i]=g.useState(!1),[o]=R.useForm(),{fetchAppData:c}=et(),l=async(d,u,h)=>{i(!0);try{await Br(d,u,h),await c(),b.success("Added a feed successfully"),n(!1),o.resetFields()}catch{b.error("Failed to add a feed")}finally{i(!1)}};return e.jsx(ee,{title:s.t("main.add_feed_modal_title"),visible:r,unmountOnExit:!0,style:{width:"400px"},onOk:o.submit,confirmLoading:a,onCancel:()=>{n(!1),o.resetFields()},children:e.jsxs(R,{form:o,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async d=>{const u=d.url.trim();u?await l(u,d.category,d.crawler):b.error("Feed URL cannot be empty")},children:[e.jsx(R.Item,{label:s.t("main.add_feed_modal_feed_url_label"),field:"url",rules:kn,children:e.jsx(W,{placeholder:s.t("main.add_feed_modal_feed_url_placeholder")})}),e.jsx(R.Item,{field:"category",label:s.t("main.add_feed_modal_category_label"),required:!0,rules:In,children:e.jsx(L,{placeholder:s.t("main.add_feed_modal_category_placeholder"),showSearch:!0,filterOption:(d,u)=>we(u.props.children,d),children:t.map(d=>e.jsx(L.Option,{value:d.id,children:d.title},d.id))})}),e.jsx(R.Item,{field:"crawler",initialValue:!1,label:s.t("main.add_feed_modal_crawler_label"),rules:Tn,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(Q,{})})]})})},An=()=>e.jsxs("div",{className:"main",children:[e.jsx(Vs,{}),e.jsx(Fn,{}),e.jsx(En,{})]}),es=()=>{const{theme:t,themeColor:s}=f(I),[r,n]=g.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);g.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),i=o=>n(o.matches);return a.addEventListener("change",i),()=>a.removeEventListener("change",i)},[]),g.useEffect(()=>{const a=i=>{const o=i?"dark":"light";document.body.setAttribute("arco-theme",o),document.body.style.colorScheme=o};Jt(s),a(t==="system"?r:t==="dark")},[r,t,s])},ts=()=>{const t=document.querySelector(".spinner");t&&(t.style.display="none")},Nn=()=>{Lt(),es();const{isBelowLarge:t}=he(),{polyglot:s}=f(H);return g.useEffect(()=>{ts()},[]),s&&e.jsxs("div",{className:"app",children:[t?null:e.jsx(zs.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(Xt,{})}),e.jsx(pn,{}),e.jsx(An,{})]})},ss=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},rs=t=>{var a;const n=(a=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:a.getAttribute("src");return{...t,imgSrc:n}},Ln=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(rs);fe(s),ln(t.total)}},Rn=t=>{const{isAppDataReady:s}=f(V),{showStatus:r}=f(I),n=g.useRef(!1),a=async i=>{if(!n.current){n.current=!0,mt(!1);try{const o=r==="unread"?await i(0,"unread"):await i();mt(!0),re(!0),Ln(o)}catch(o){console.error("Error fetching articles: ",o),re(!1)}finally{n.current=!1}}};return g.useEffect(()=>{s&&a(t)},[s]),{fetchArticleList:a}},ns=kt(!1),yt=A(ns),tt=()=>{const{offset:t}=f(F),{pageSize:s,showStatus:r}=f(I),n=f(ns),a=o=>{const c=(l,d)=>d.filter(u=>!l.some(h=>h.id===u.id));fe(l=>[...l,...c(l,o)]),Kt(l=>l+s)};return{handleLoadMore:async o=>{yt(!0);try{const c=r==="unread"?await o(t+s,"unread"):await o(t+s);if(c!=null&&c.entries){const l=c.entries.map(rs);a(l)}}catch(c){console.error("Error fetching more articles: ",c)}finally{yt(!1)}},loadingMore:n}},st=ie({isPhotoSliderVisible:!1,selectedIndex:0}),Mn=A(st,"isPhotoSliderVisible"),Dn=A(st,"selectedIndex"),as=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=f(st);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:Mn,selectedIndex:s,setSelectedIndex:Dn}},os=(t,s)=>{const{activeContent:r}=f(F),n=f(Ze),a=f(Qe),{isPhotoSliderVisible:i,setIsPhotoSliderVisible:o,setSelectedIndex:c}=as(),{loadingMore:l}=tt(),[d,u]=g.useState(!1),[h,x]=g.useState(!1);g.useEffect(()=>{h&&!l&&(u(!1),x(!1),v())},[l,h]),g.useEffect(()=>{var T;r&&((T=document.querySelector(".card-custom-selected-style"))==null||T.scrollIntoView({behavior:"smooth",block:"nearest"}))},[r]);const p=()=>{r&&(X(null),s.current&&s.current.contentWrapperEl.focus())},j=(T=!1)=>{const $=n.findIndex(Y=>Y.id===(r==null?void 0:r.id));if($>0){const Y=T?n.slice(0,$).toReversed().find(m=>m.status==="unread"):n[$-1];Y&&t(Y)}},v=(T=!1)=>{if(d)return;const $=n.findIndex(y=>y.id===(r==null?void 0:r.id));if($===n.length-1&&a){u(!0),x(!0);return}if($===-1){s.current.contentWrapperEl.scrollTo({top:0,left:0,behavior:"smooth"});return}const m=T?n.slice($+1).find(y=>y.status==="unread"):n[$+1];m&&(t(m),x(!1))};return{exitDetailView:p,fetchOriginalArticle:T=>{r&&T()},navigateToNextArticle:v,navigateToPreviousArticle:j,openLinkExternally:()=>{r&&window.open(r.url,"_blank")},openPhotoSlider:()=>{!r||!ss(r.content).length||i||(c(0),o(!0),re(!1))},toggleReadStatus:T=>{r&&T()},toggleStarStatus:T=>{r&&T()}}},Pn=({handleEntryClick:t,entryListRef:s})=>{const{activeContent:r}=f(F),{handleFetchContent:n,handleToggleStarred:a,handleToggleStatus:i}=Je(),{exitDetailView:o,navigateToNextArticle:c,navigateToPreviousArticle:l}=os(t,s);if(!r)return null;const d=r.status==="unread",u=r.starred;return e.jsxs(E.Group,{className:"action-buttons",children:[e.jsx(E,{icon:e.jsx(Os,{}),onClick:()=>o(),shape:"round",type:"primary"}),e.jsx(E,{icon:d?e.jsx(Ft,{}):e.jsx(Et,{}),onClick:()=>i(r),type:"primary"}),e.jsx(E,{icon:u?e.jsx(He,{style:{color:"#ffcd00"}}):e.jsx(Be,{}),onClick:()=>a(r),type:"primary"}),e.jsx(E,{icon:e.jsx(Us,{}),onClick:()=>l(),type:"primary"}),e.jsx(E,{icon:e.jsx($s,{}),onClick:()=>c(),type:"primary"}),e.jsx(E,{icon:e.jsx(Bs,{}),onClick:n,shape:"round",type:"primary"})]})},Vn=({url:t,text:s})=>{const[r,n]=g.useState(!1),a=()=>n(!r);return e.jsx(Ks,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:a,onMouseLeave:a,children:s})},jt=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var j;const{fontSize:a}=f(I),[i,o]=g.useState(!1),[c,l]=g.useState(!1),{isBelowMedium:d}=he();g.useEffect(()=>{const N=(n?t.children[0]:t).attribs.src,w=new Image;w.src=N,w.onload=()=>l(w.width<=100&&w.height<=100)},[t,n]);const u=n?t.children[0]:t,h=()=>e.jsx("img",{...u.attribs,alt:u.attribs.alt??"image",style:c?{display:"inline-block",width:"auto",height:`${a}rem`,margin:0}:{}});if(c)return n?e.jsxs("a",{...t.attribs,children:[h(),(j=t.children[1])==null?void 0:j.data]}):h();const x=()=>o(!0),p=()=>o(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:x,onMouseLeave:p,children:[n?e.jsx("a",{...t.attribs,children:h()}):h(),e.jsx(E,{icon:e.jsx(Gs,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:d||i?1:0,transition:"opacity 0.3s"},onClick:v=>{v.preventDefault(),r(s)}})]})})},zn=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const n=r.children[0];if(n.type==="tag"&&n.name==="img"){const a=t.findIndex(i=>i===n.attribs.src);return e.jsx(jt,{node:r,index:a,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const n=t.findIndex(a=>a===r.attribs.src);return e.jsx(jt,{node:r,index:n,togglePhotoSlider:s})}return r}}),On=g.forwardRef(({handleEntryClick:t,entryListRef:s},r)=>{const n=ne(),{activeContent:a}=f(F),{articleWidth:i,fontSize:o}=f(I),{isPhotoSliderVisible:c,setIsPhotoSliderVisible:l,selectedIndex:d,setSelectedIndex:u}=as(),h=()=>{Ae("author"),Ee(a.author)},x=C=>{u(C),l(z=>!z),re(z=>!z)};if(!a)return e.jsxs("div",{ref:r,className:"content-empty",children:[e.jsx(Hs,{style:{fontSize:"64px"}}),e.jsx(_.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const p=ss(a.content),j=zn(p,x),v=qs(a.content,j),{id:N,title:w}=a.feed.category;return e.jsxs("div",{className:"article-content",onBlur:()=>re(!1),onFocus:()=>re(!0),ref:r,children:[e.jsxs($e,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${i}%`},children:[e.jsx(_.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(_.Text,{children:e.jsx(Vn,{url:`/feed/${a.feed.id}`,text:a.feed.title})}),e.jsx(_.Text,{onClick:h,style:{cursor:"pointer"},children:` - ${a.author}`}),e.jsx(_.Text,{children:e.jsx(ue,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>n(`/category/${N}`),children:w})})]}),e.jsx(_.Text,{className:"article-date",children:Mr(a.published_at)}),e.jsx(K,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${o}rem`,width:`${i}%`},children:[v,e.jsx(Ws,{images:p.map(C=>({src:C,key:C})),loop:!1,visible:c,onClose:()=>{l(!1),re(!0)},index:d,onIndexChange:u})]},a.id)]}),e.jsx(Pn,{handleEntryClick:t,entryListRef:s})]})}),Un=({alt:t,borderRadius:s,height:r,src:n,status:a,width:i})=>{const[o,c]=g.useState(!1),{ref:l}=Le({triggerOnce:!0,onChange:(d,u)=>{if(d&&!o){const h=new Image;h.onload=()=>c(!0),h.onerror=()=>{u.target.style.display="none"},h.src=n}}});return e.jsx("div",{className:"image-container",ref:l,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:o?e.jsx("img",{className:a==="unread"?"":"read",src:n,alt:t,style:{width:i,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(Se,{text:{rows:0},image:{style:{width:i,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},$n=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(Un,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},Bn=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:a}=f(I),i=Ne({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:i,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:t.imgSrc?r?"0 10px 0 0":"0 0 10px 0":"0"},children:e.jsx($n,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(_.Text,{className:"article-card-title",children:t.title}),e.jsxs(_.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(Gt,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Dt(t.published_at,a)]}),t.starred&&e.jsx(He,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},Hn=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:a,showFeedIcon:i}=f(I),{activeContent:o}=f(F),c=o&&t.id===o.id,{handleToggleStarred:l,handleToggleStatus:d}=Je(),[u,h]=g.useState(0),x=100,p=.5,j=t.starred,v=t.status==="unread",N=Ys({preventScrollOnSwipe:!0,delta:x/2,onSwiping:y=>{const k=Math.min(Math.abs(y.deltaX*p),x)*Math.sign(y.deltaX);h(k)},onSwiped:async y=>{try{y.deltaX>x?(await l(t),b.success(j?"Unmarked as starred":"Marked as starred")):y.deltaX<-x&&(await d(t),b.success(v?"Marked as read":"Marked as unread"))}catch{b.error("Failed to update, please try again")}h(0)}}),[w,C]=g.useState(!1),[z,P]=g.useState(!1),T=()=>d(t),$=20,{ref:Y}=Le({skip:z,onChange:async(y,k)=>{if(!(!a||!v)){if(y)C(!0);else if(w){const{top:M}=k.boundingClientRect;M<$&&(await T(),P(!0))}}}}),m=Xs({x:u});return g.createElement("div",{...N,className:"article-card",key:t.id},e.jsxs("div",{ref:Y,children:[e.jsx(Js.div,{className:"swipe-card",style:m,children:e.jsx(Te,{className:Ne("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":c}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Te.Meta,{description:e.jsx(Bn,{entry:t,showFeedIcon:i,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:j?e.jsx(He,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(Be,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:v?e.jsx(Ft,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(Et,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},qn=()=>{const{layout:t}=f(I),{isArticleListReady:s}=f(F),r=t==="large"?2:4,n=a=>e.jsx(Te,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Te.Meta,{description:e.jsx(Se,{loading:!s,animation:!0,text:{rows:3,width:150}})})},a);return!s&&Array.from({length:r},(a,i)=>n(i))},Wn=()=>{const{orderDirection:t}=f(I),{filterString:s,filterType:r}=f(F),{polyglot:n}=f(H),{isBelowMedium:a}=he(),i=()=>{q({orderDirection:t==="desc"?"asc":"desc"})};return g.useEffect(()=>{Ae("title"),Ee("")},[]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(W.Search,{allowClear:!0,onChange:Ee,placeholder:n.t("article_list.search_placeholder"),style:{width:a?"100%":278,marginLeft:8},value:s,addBefore:e.jsxs(L,{onChange:Ae,style:{width:100},value:r,children:[e.jsx(L.Option,{value:"title",children:n.t("article_list.search_type_title")}),e.jsx(L.Option,{value:"content",children:n.t("article_list.search_type_content")}),e.jsx(L.Option,{value:"author",children:n.t("article_list.search_type_author")})]})}),e.jsx(ke,{mini:!0,content:t==="desc"?n.t("article_list.sort_direction_desc"):n.t("article_list.sort_direction_asc"),children:e.jsx(E,{shape:"circle",size:"small",style:{margin:"0 8px",flexShrink:0},icon:t==="desc"?e.jsx(Qs,{}):e.jsx(Zs,{}),onClick:i})})]})},Kn=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},Gn=(t,s,r)=>{g.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},Yn=({duration:t,color:s})=>{const[r,n]=g.useState([]);Gn(r.length,t,()=>{n([])});const a=i=>{const o=i.currentTarget.getBoundingClientRect(),c=o.width>o.height?o.width:o.height,l=i.pageX-o.x-c/2,d=i.pageY-o.y-c/2,u={x:l,y:d,size:c,id:`${new Date().getTime()}-${l}-${d}`};n([...r,u])};return e.jsx("div",{className:"ripple-container",onMouseDown:a,children:r.length>0&&r.map(i=>e.jsx("span",{className:"ripple-span",style:{top:i.y,left:i.x,width:i.size,height:i.size,backgroundColor:s,animationDuration:`${t}ms`}},i.id))})},Xn=({getEntries:t})=>{const{isArticleListReady:s}=f(F),r=f(Qe),{loadingMore:n,handleLoadMore:a}=tt(),{ref:i}=Le({skip:!r,onChange:async o=>{!o||!s||n||await a(t)}});return s&&r&&e.jsxs("div",{className:"load-more-container",ref:i,children:[e.jsx(tr,{loading:n,style:{paddingRight:"10px"}}),"Loading more ..."]})},Jn=g.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:a,pageSize:i}=f(I),o=a==="small",{isArticleListReady:c}=f(F),l=f(Ze),d=l.length-Math.ceil(i*.2)-1,u=f(Qe),{loadingMore:h,handleLoadMore:x}=tt(),{ref:p}=Le({skip:!u,onChange:async w=>{!w||!c||h||await x(t)}}),j=er({count:l.length,getScrollElement:()=>r.current,estimateSize:()=>o?120:280}),v=j.getVirtualItems(),N=g.useCallback(w=>w===d?Kn(j.measureElement,p):j.measureElement,[d,j.measureElement,p]);return e.jsxs(e.Fragment,{children:[e.jsx(Wn,{}),e.jsxs($e,{className:"entry-list",ref:n,children:[e.jsx(qn,{}),c&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:j.getTotalSize(),width:"100%",position:"relative"},children:v.map(w=>e.jsx("div",{"data-index":w.index,ref:N(w.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${w.start}px)`},children:e.jsx(Hn,{entry:l[w.index],handleEntryClick:s,mini:o,children:e.jsx(Yn,{color:"var(--color-text-4)",duration:1e3})})},w.key))})}),e.jsx(Xn,{getEntries:t})]})]})}),Qn=()=>{fe(t=>t.map(s=>({...s,status:"read"})))},Zn=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:n}=f(F),{showStatus:a}=f(I),{polyglot:i}=f(H),{fetchAppData:o}=et(),c=async()=>{try{await r(),Qn(),await o(),b.success(i.t("article_list.mark_all_as_read_success"))}catch{b.error(i.t("article_list.mark_all_as_read_error"))}},l=d=>{q({showStatus:d})};return g.useEffect(()=>{Ae("title"),Ee("")},[a]),e.jsxs("div",{className:"entry-panel",children:[!["starred","history"].includes(t.from)&&e.jsx(It,{focusLock:!0,title:i.t("article_list.mark_all_as_read_confirm"),onOk:c,children:e.jsx(E,{icon:e.jsx(St,{}),shape:"circle"})}),e.jsx(sr.Group,{disabled:t.from==="history",onChange:l,options:[{label:i.t("article_list.filter_status_all"),value:"all"},{label:i.t("article_list.filter_status_unread"),value:"unread"}],type:"button",value:t.from==="history"?"all":a}),e.jsx(E,{icon:e.jsx(Ie,{}),loading:!n,shape:"circle",onClick:s})]})},ce=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleFocused:a,isArticleListReady:i}=f(F),{isAppDataReady:o}=f(V),{orderBy:c,orderDirection:l,showAllFeeds:d,showStatus:u}=f(I),h=f(Ze),x=f(Xe),{handleFetchContent:p,handleToggleStarred:j,handleToggleStatus:v,handleEntryStatusUpdate:N}=Je(),{fetchAppData:w}=et(),{fetchArticleList:C}=Rn(s),z=g.useRef(null),P=g.useRef(null),T=g.useRef(null);g.useEffect(()=>{on(t.from),n&&X(null),Z(s)},[t]),g.useEffect(()=>{["starred","history"].includes(t.from)||Z(s)},[c]),g.useEffect(()=>{x.length===0||["starred","history"].includes(t.from)||Z(s)},[d]),g.useEffect(()=>{Z(s)},[l,u]);const $=async B=>{if(X(null),B.status!=="unread"){setTimeout(()=>{X({...B,status:"read"})},200);return}try{setTimeout(()=>{X({...B,status:"read"}),N(B,"read")},200),await Me([B.id],"read")}catch{b.error("Failed to mark entry as read, please try again later"),N(B,"unread")}},{exitDetailView:Y,fetchOriginalArticle:m,navigateToNextArticle:y,navigateToPreviousArticle:k,openLinkExternally:M,openPhotoSlider:D,toggleReadStatus:te,toggleStarStatus:ae}=os($,z);g.useEffect(()=>{const B={ArrowLeft:()=>k(),ArrowRight:()=>y(),Escape:()=>Y(),b:M,d:()=>m(p),m:()=>te(()=>v(n)),s:()=>ae(()=>j(n)),v:D},pe=de=>{const rt=B[de.key];rt&&(de.key==="ArrowLeft"?k(de.ctrlKey):de.key==="ArrowRight"?y(de.ctrlKey):rt())};return a?document.addEventListener("keydown",pe):document.removeEventListener("keydown",pe),()=>{document.removeEventListener("keydown",pe)}},[n,h,a]);const Z=async B=>{Kt(0),o?await C(B):await w()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(lt,{in:i,timeout:200,nodeRef:P,classNames:"fade",children:e.jsx(Jn,{cardsRef:P,getEntries:s,handleEntryClick:$,ref:z})}),e.jsx(Zn,{info:t,refreshArticleList:()=>Z(s),markAllAsRead:r})]}),e.jsx(lt,{in:n!==null,timeout:200,nodeRef:T,classNames:"fade",unmountOnExit:!0,children:e.jsx(On,{handleEntryClick:$,entryListRef:z,ref:T})})]})},ea=()=>e.jsx(ce,{info:{from:"all",id:""},getEntries:Vr,markAllAsRead:Yr}),ta=()=>{const{id:t}=At(),s=U("orderBy"),r=U("pageSize"),n=U("showAllFeeds"),a=async(i=0,o=null)=>{const c={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:i,limit:r,status:o},l={globally_visible:!n};return S.get(le(c,l))};return e.jsx(ce,{info:{from:"category",id:t},getEntries:a,markAllAsRead:()=>Ar(t)})},sa=()=>{const t=ne(),s=rr();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(nr,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(E,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},ra=()=>{const{id:t}=At(),s=U("orderBy"),r=U("pageSize"),n=async(a=0,i=null)=>{const o={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:a,limit:r,status:i};return S.get(le(o))};return e.jsx(ce,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>qr(t)})},na=()=>e.jsx(ce,{info:{from:"history",id:""},getEntries:Vt}),aa=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,a]of Object.entries(s))if(n!=="password"){const i=a==null?void 0:a.trim();t.setFieldValue(n,i),i||(r=!1)}else a||(r=!1);return r},_e=(t,s)=>{t.key==="Enter"&&s.submit()},oa=()=>{Lt(),es();const t=f(Re),{homePage:s}=f(I),{polyglot:r}=f(H),[n]=ar(),[a,i]=g.useState(!1),[o,c]=g.useState("token"),l=ne(),d=async()=>{i(!0);const{server:h,token:x,username:p,password:j}=n.getFieldsValue();try{(await bt.raw("v1/me",{baseURL:h,headers:x?{"X-Auth-Token":x}:{Authorization:`Basic ${btoa(`${p}:${j}`)}`}})).status===200&&(b.success(r.t("login.success")),Mt({server:h,token:x,username:p,password:j}),l("/"))}catch(v){console.error(v),b.error(v.message)}i(!1)},u=async()=>{const h=n.getFieldsValue();if(!Fe(h)){b.error(r.t("login.auth_error"));return}await d()};return g.useEffect(()=>{ts()},[]),Fe(t)?e.jsx(qe,{to:`/${s}`}):r&&e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(_.Title,{heading:3,children:r.t("login.login_to_your_server")}),e.jsxs(R,{autoComplete:"off",form:n,layout:"vertical",onSubmit:async()=>{aa(n)?await u():b.error(r.t("login.submit_error"))},children:[e.jsx(R.Item,{field:"server",label:r.t("login.server_label"),rules:[{required:!0}],onKeyDown:h=>{_e(h,n)},children:e.jsx(W,{disabled:a,placeholder:r.t("login.server_placeholder"),prefix:e.jsx(or,{})})}),o==="token"&&e.jsx(R.Item,{field:"token",label:r.t("login.token_label"),rules:[{required:!0}],onKeyDown:h=>{_e(h,n)},children:e.jsx(W.Password,{disabled:a,placeholder:r.t("login.token_placeholder"),prefix:e.jsx(ct,{})})}),o==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(R.Item,{field:"username",label:r.t("login.username_label"),rules:[{required:!0}],onKeyDown:h=>{_e(h,n)},children:e.jsx(W,{disabled:a,placeholder:r.t("login.username_placeholder"),prefix:e.jsx(Ct,{})})}),e.jsx(R.Item,{field:"password",label:r.t("login.password_label"),rules:[{required:!0}],onKeyDown:h=>{_e(h,n)},children:e.jsx(W.Password,{disabled:a,placeholder:r.t("login.password_placeholder"),prefix:e.jsx(ct,{})})})]})]}),e.jsx(E,{loading:a,type:"primary",long:!0,onClick:()=>n.submit(),style:{marginTop:"20px"},children:r.t("login.login_button")}),e.jsx(K,{orientation:"center",children:r.t("login.another_login_method")}),e.jsx(E,{type:"secondary",long:!0,onClick:()=>c(o==="token"?"user":"token"),style:{marginTop:"20px"},children:o==="token"?r.t("login.another_login_button"):r.t("login.token_label")}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(_.Text,{disabled:!0,children:r.t("login.need_help")}),e.jsx(ir,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:r.t("login.miniflux_official_website")})]})]})}),e.jsx("div",{className:"background"})]})},ia=({children:t})=>{const s=f(Re);return Fe(s)?e.jsx(e.Fragment,{children:t}):e.jsx(qe,{to:"/login"})},la=()=>e.jsx(ce,{info:{from:"starred",id:""},getEntries:Pt}),ca=()=>{const t=async()=>{const s=await be(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=be(0,"unread",r).then(i=>i.entries));const a=n.map(i=>i.id);return Me(a,"read")};return e.jsx(ce,{info:{from:"today",id:""},getEntries:be,markAllAsRead:t})},da=U("homePage"),ua=[{path:"/all",element:e.jsx(ea,{})},{path:"/today",element:e.jsx(ca,{})},{path:"/starred",element:e.jsx(la,{})},{path:"/history",element:e.jsx(na,{})},{path:"/category/:id",element:e.jsx(ta,{})},{path:"/feed/:id",element:e.jsx(ra,{})}],is=lr([{path:"/",element:e.jsx(ia,{children:e.jsx(Nn,{})}),errorElement:e.jsx(sa,{}),children:[...ua,{index:!0,element:e.jsx(qe,{to:`/${da}`,replace:!0})}]},{path:"/login",element:e.jsx(oa,{})}]),ha={"zh-CN":mr,"es-ES":fr},ma=()=>ha[yr()]||hr;cr.createRoot(document.getElementById("root")).render(e.jsx(dr,{locale:ma(),children:e.jsx(ur,{router:is})}));
