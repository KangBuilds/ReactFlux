import{p as gt,m as le,u as f,r as g,P as rs,i as ns,o as xt,d as G,a as as,b as os,c as is,e as X,M as b,C as ls,j as e,f as Q,g as $e,h as ae,A as yt,I as cs,T as y,S as ve,k as ze,l as st,n as ds,q as us,s as Ue,t as hs,v as ms,w as Fe,B as T,x as fs,D as ps,y as we,z as Se,E as jt,F as gs,G as xs,H as ys,J as rt,K as _t,L as js,N as ke,O as _s,Q as bt,R as ee,U as bs,V as vs,W as ws,X as Ss,Y as ks,Z as K,_ as Z,$ as nt,a0 as R,a1 as ue,a2 as q,a3 as vt,a4 as at,a5 as wt,a6 as Cs,a7 as St,a8 as N,a9 as Is,aa as ie,ab as Ts,ac as Fs,ad as Es,ae as As,af as Ns,ag as Rs,ah as Ls,ai as Ms,aj as kt,ak as Ct,al as Be,am as Ds,an as Ps,ao as Vs,ap as Os,aq as $s,ar as zs,as as Us,at as Bs,au as Ee,av as Hs,aw as qs,ax as Ws,ay as Ce,az as Ks,aA as Gs,aB as Ys,aC as Xs,aD as Js,aE as ot,aF as It,aG as Qs,aH as Zs,aI as er,aJ as tr,aK as it,aL as sr,aM as Tt,aN as rr,aO as nr,aP as ar,aQ as or,aR as ir,aS as lr}from"./vendor-DmKC6Ayp.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const cr="modulepreload",dr=function(t){return"/"+t},lt={},Ne=function(s,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.all(r.map(c=>{if(c=dr(c),c in lt)return;lt[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":cr,l||(u.as="script"),u.crossOrigin="",u.href=c,i&&u.setAttribute("nonce",i),document.head.appendChild(u),l)return new Promise((h,j)=>{u.addEventListener("load",h),u.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${c}`)))})}))}return o.then(()=>s()).catch(a=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a})},ur=(t,s,r)=>{const n=t[s];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((o,a)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},Ft={articleWidth:90,fontSize:1.05,homePage:"all",language:navigator.language,layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},F=gt("settings",Ft,{encode:JSON.stringify,decode:JSON.parse}),O=t=>F.get()[t],H=t=>F.set({...F.get(),...t}),hr=()=>F.set(Ft),E=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},W=le({polyglot:null}),mr=E(W,"polyglot"),fr=async(t,s)=>{let r;try{r=await ur(Object.assign({"../locales/en-US.json":()=>Ne(()=>import("./en-US-CUbuTdeg.js"),[]),"../locales/zh-CN.json":()=>Ne(()=>import("./zh-CN-fvTBX-Am.js"),[])}),`../locales/${t}.json`,3)}catch{r=await Ne(()=>import("./en-US-CUbuTdeg.js"),[])}{const n=new rs({phrases:r.default,locale:t});mr(n)}},Et=()=>{const{language:t}=f(F);g.useEffect(()=>{t?fr(t):H({language:navigator.language})},[t])},He=le({addFeedModalVisible:!1,settingsModalVisible:!1}),pr=E(He,"addFeedModalVisible"),gr=E(He,"settingsModalVisible"),qe=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=f(He);return{addFeedModalVisible:t,setAddFeedModalVisible:pr,settingsModalVisible:s,setSettingsModalVisible:gr}},he=()=>{const[t,s]=g.useState(window.innerWidth),r=t<=768,n=t<=992;return g.useEffect(()=>{const o=()=>s(window.innerWidth);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},At={server:"",token:"",username:"",password:""},We=gt("auth",At,{encode:JSON.stringify,decode:JSON.parse}),Nt=t=>We.set(t),xr=()=>Nt(At),yr=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},Ke=t=>{const{server:s,token:r,username:n,password:o}=t;return!s||!ns(s,{require_protocol:!0})&&!yr(s)?!1:r||n&&o},jr=()=>xt.create({retry:3,onRequest({_request:t,options:s}){const r=We.get();if(!Ke(r))throw new Error("Invalid auth");const{server:n,token:o,username:a,password:i}=r;s.baseURL=n,s.headers=o?{"X-Auth-Token":o}:{Authorization:`Basic ${btoa(`${a}:${i}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var a;s.status===401&&(localStorage.removeItem("auth"),await ss.navigate("/login"));const o=((a=s._data)==null?void 0:a.error_message)??s.statusText;throw console.error("Response error: ",o),new Error(o)}}),S=jr();S.get=t=>S(t,{method:"GET"});S.post=(t,s)=>S(t,{method:"POST",body:s});S.put=(t,s)=>S(t,{method:"PUT",body:s});const _r=async()=>S.get("/v1/categories"),br=async t=>S.post("/v1/categories",{title:t}),vr=async t=>S.raw(`/v1/categories/${t}`,{method:"DELETE"}),wr=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return S.put(`/v1/categories/${t}`,n)},Sr=async t=>S.put(`/v1/categories/${t}/mark-all-as-read`);G.extend(as);G.extend(os);G.extend(is);const kr=t=>G(t).isAfter(G().subtract(24,"hour")),Cr=()=>G().subtract(24,"hour").unix(),Rt=(t,s)=>{if(!s){const p=G(t).fromNow();return p==="a few seconds ago"?"just now":p}const r=G(),o=G(t).diff(r),a=G.duration(Math.abs(o)),i=a.years(),c=a.months(),l=a.days(),d=a.hours(),u=a.minutes(),h=[];if(i>0&&h.push(`${i} year${i>1?"s":""}`),c>0&&h.push(`${c} month${c>1?"s":""}`),l>0&&h.push(`${l} day${l>1?"s":""}`),d>0&&h.push(`${d} hour${d>1?"s":""}`),u>0&&h.push(`${u} minute${u>1?"s":""}`),h.length===0)return"just now";const j=h.join(" ");return o>0?`in ${j}`:`${j} ago`},Ir=()=>G().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),Ae=async(t,s)=>S.put("/v1/entries",{entry_ids:t,status:s}),Tr=async t=>S.put(`/v1/entries/${t}/bookmark`),Fr=async t=>S.get(`/v1/entries/${t}/fetch-content`),ce=(t,s={})=>{const{baseUrl:r,orderField:n,offset:o,limit:a,status:i}=t,c=O("orderDirection"),l=new URLSearchParams({order:n,direction:c,offset:o,limit:a,...s});return i&&l.append("status",i),`${r}?${l}`},Er=async(t=0,s=null)=>{const r=O("orderBy"),n=O("pageSize"),o=O("showAllFeeds"),a={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s},i={globally_visible:!o};return S.get(ce(a,i))},je=async(t=0,s=null,r=null)=>{const n=O("orderBy"),o=r??O("pageSize"),a=O("showAllFeeds"),i=Cr(),c={baseUrl:"/v1/entries",orderField:n,offset:t,limit:o,status:s},l={globally_visible:!a,published_after:i};return S.get(ce(c,l))},Lt=async(t=0,s=null)=>{const r=O("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},o={starred:"true"};return S.get(ce(n,o))},Mt=async(t=0)=>{const s=O("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return S.get(ce(r))},Ar=async()=>S.get("/v1/feeds"),Nr=async()=>S.get("/v1/feeds/counters"),Rr=async t=>S.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),Lr=async()=>S.raw("/v1/feeds/refresh",{method:"PUT"}),Mr=async(t,s,r)=>S.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),Dr=async t=>S.raw(`/v1/feeds/${t}`,{method:"DELETE"}),ct=async(t,s)=>{const{categoryId:r,title:n,siteUrl:o,feedUrl:a,hidden:i,disabled:c,isFullText:l}=s;return S.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:o,feed_url:a,hide_globally:i,disabled:c,crawler:l})},Pr=async t=>S.put(`/v1/feeds/${t}/mark-all-as-read`),Vr=async()=>S.get("/v1/me"),Or=async t=>S.get(`/v1/icons/${t}`),$r=async()=>S.get("/v1/version"),zr=async()=>{const t=await Vr();return S.put(`/v1/users/${t.data.id}/mark-all-as-read`)},$=le({isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1}),Ge=X($,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(o=>({...o,unreadCount:s[o.id]??0})).sort((o,a)=>o.title.localeCompare(a.title,"en"))}),me=X([$,Ge],(t,s)=>{const{categoriesData:r}=t;return r.map(o=>{const a=s.filter(i=>i.category.id===o.id);return{...o,unreadCount:a.reduce((i,c)=>i+(c.unreadCount??0),0),feedCount:a.length}}).sort((o,a)=>o.title.localeCompare(a.title,"en"))}),Dt=X(me,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),Pt=X([Ge,Dt],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Vt=X([Ge,Pt,F],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(o=>n||!s.includes(o.id))}),Ot=X(Vt,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),Ur=X([$,Vt],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[o,a])=>s.some(i=>i.id===Number(o))?n+a:n,0)}),_e=E($,"categoriesData"),re=E($,"feedsData"),Re=E($,"historyCount"),Le=E($,"isAppDataReady"),Me=E($,"starredCount"),$t=E($,"unreadInfo"),zt=E($,"unreadTodayCount"),Br=E($,"isVersionAtLeast2_2_0"),Ut=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(a=>a.id===n.id)||n)},De=(t,s)=>{const r={};let n=0;const o=t.filter(l=>l.status!==s);if(o.length===0)return;Re(s==="read"?l=>l+o.length:l=>Math.max(0,l-o.length));for(const l of o){const d=l.feed.id,u=kr(l.published_at),h=s==="read"?-1:1;r[d]=(r[d]??0)+h,n+=u?h:0}zt(l=>Math.max(0,l+n)),$t(l=>{const d={...l};for(const[u,h]of Object.entries(r))d[u]=Math.max(0,(d[u]??0)+h);return d});const a=o.map(l=>({...l,status:s})),{activeContent:i}=A.get(),c=a.find(l=>l.id===(i==null?void 0:i.id));c&&Y(c),fe(l=>Ut(l,a))},Ye=()=>{const{activeContent:t}=f(A),s=(i,c)=>{De([i],c)},r=(i,c)=>{c?(Me(d=>d+1),ls({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Me(d=>Math.max(0,d-1));const l={...i,starred:c};t&&Y(l),fe(d=>Ut(d,[l]))};return{handleEntryStatusUpdate:s,handleFetchContent:async()=>{try{const i=await Fr(t.id);b.success("Fetched content successfully"),Y({...t,content:i.content})}catch{b.error("Failed to fetch content, please try again later")}},handleToggleStarred:async i=>{const c=!i.starred;r(i,c),Tr(i.id).catch(()=>{b.error(`Failed to ${c?"star":"unstar"} entry, please try again later`),r(i,!c)})},handleToggleStatus:async i=>{const c=i.status,l=c==="read"?"unread":"read";s(i,l),Ae([i.id],l).catch(()=>{b.error(`Failed to mark entry as ${l}, please try again later`),s(i,c)})}}},Hr=(t,s)=>{if(t.length===0||s==="none")return t;const r=t.map((d,u)=>({id:d.id,index:u})),n=new Map,o=new Map,a=new Map,i=[],c=t.slice().sort((d,u)=>d.id-u.id).filter(d=>{const{hash:u,title:h,url:j,id:p}=d;switch(s){case"hash":if(n.has(u))return i.push(d),!1;n.set(u,p);break;case"title":if(o.has(h))return i.push(d),!1;o.set(h,p);break;case"url":if(a.has(j))return i.push(d),!1;a.set(j,p);break;default:return!0}return!0}),l=i.filter(d=>d.status==="unread").map(d=>d.id);return l.length>0&&(De(i,"read"),Ae(l,"read").catch(()=>{b.error("Failed to mark duplicate entries as read"),De(i,"unread")})),c.sort((d,u)=>{const h=r.find(p=>p.id===d.id).index,j=r.find(p=>p.id===u.id).index;return h-j})},qr=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},pe=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,o=r?s.toLowerCase():s;if(o.length===0)return 0;const a=qr(o);let i=0,c=0;for(;i<n.length;)if(n[i]===o[c]?(i++,c++):c!==0?c=a[c-1]:i++,c===o.length)return i-c;return-1},Wr=t=>{const s=[],r=[];let n=[];const o=[],a=t.match(/([-+|]?)\s*"([^"]+)"/g);let i=t;a&&(n=a.map(l=>{const d=l.trim()[0],u=l.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(u);break;case"+":s.push(u);break;case"|":o.push([u]);break;default:s.push(u);break}return u}),i=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const c=i.split(/\s+/);for(const l of c){const d=l.replace(/^-|\+|\|$/,"");if(l.startsWith("-")&&d)r.push(d);else if(l.startsWith("+")&&d)s.push(d);else if(l.includes("|")){const u=l.split("|").filter(h=>h);u.length>0&&o.push(u)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:o}},Kr=(t,s,r=[],n=!0)=>{const{includeTerms:o,excludeTerms:a,exactPhrases:i,orConditions:c}=Wr(s);return t.filter(l=>r.some(d=>{const u=l[d];if(typeof u!="string")return!1;const h=n?u.toLowerCase():u;if(a.some(_=>pe(h,_,n)!==-1)||i.length>0&&!i.some(_=>pe(h,_,n)!==-1))return!1;const j=o.every(_=>pe(h,_,n)!==-1),p=c.length===0||c.some(_=>_.some(v=>pe(h,v,n)!==-1));return j&&p}))},Gr=(t,s,r=[],n=!0)=>{try{if(!Array.isArray(t)||t.length===0)throw new Error("Invalid data input");if(typeof s!="string"||s.trim().length===0)throw new Error("Invalid query input");return Kr(t,s,r,n)}catch(o){return console.error(o.message),[]}},be=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),Yr=(t,s,r)=>r?Gr(t,r,[s]):t,A=le({activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:O("homePage"),isArticleFocused:!1,isArticleListReady:!1,offset:0,total:0}),Xe=X(A,t=>{const{entries:s,total:r}=t;return s.length<r}),Je=X([A,$,Pt,F],(t,s,r,n)=>{const{entries:o,filterString:a,filterType:i,infoFrom:c}=t,l=Yr(o,i,a),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:u,showAllFeeds:h}=n,j=!["starred","history"].includes(c),p=v=>d||h||!r.includes(v.feed.id),_=j?l.filter(p):l;return u==="none"||["starred","history"].includes(c)?_:Hr(_,u)}),Y=E(A,"activeContent"),fe=E(A,"entries"),Ie=E(A,"filterString"),Te=E(A,"filterType"),Xr=E(A,"infoFrom"),ne=E(A,"isArticleFocused"),Pe=E(A,"isArticleListReady"),Bt=E(A,"offset"),Jr=E(A,"total"),dt=le(),ge=new Set,Qr=t=>{const s=f(dt);return g.useEffect(()=>{s[t]||ge.has(t)||(ge.add(t),Or(t).then(r=>{const n=`data:${r.data}`;dt.setKey(t,n),ge.delete(t)}).catch(()=>{ge.delete(t)}))},[t,s]),s[t]},Zr=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},ut=t=>{const s=Zr(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},en=t=>`https://icons.duckduckgo.com/ip3/${ut(t.site_url)??ut(t.feed_url)}.ico`,Ht=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,n=en(t);if(r===0)return e.jsx("img",{className:s,src:n,alt:""});const[o,a]=g.useState(n),i=Qr(r);return g.useEffect(()=>{i&&a(i)},[i]),e.jsx("img",{className:s,src:o,alt:"",onError:()=>a(n)})},qt=Q.Item,tn=({category:t,path:s})=>{var i;const n=(i=f(Ot)[t.id])==null?void 0:i.reduce((c,l)=>c+l.unreadCount,0),o=ae(),a=()=>{o(`/category/${t.id}`),Y(null)};return e.jsxs("div",{className:Fe("category-title",{"active-subMenu":s===`/category/${t.id}`,"inactive-subMenu":s!==`/category/${t.id}`}),onClick:a,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&a()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(y.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},sn=({count:t})=>e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),xe=({path:t,Icon:s,label:r,count:n})=>{const o=$e(),a=ae(),i=o.pathname===t,c=()=>{a(t),Y(null)};return e.jsx(qt,{onClick:c,className:Fe("arco-menu-item",{"arco-menu-selected":i}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(sn,{count:n})]})},t)},Wt=()=>{const{homePage:t,showAllFeeds:s,showFeedIcon:r}=f(F),{historyCount:n,isAppDataReady:o,starredCount:a,unreadTodayCount:i}=f($),c=f(me),l=f(Ot),d=f(Dt),u=f(Ur),{polyglot:h}=f(W),j=$e(),p=ae(),[_,v]=g.useState([`/${t}`]),L=j.pathname;g.useEffect(()=>{v([L])},[L]);const w=()=>e.jsxs(e.Fragment,{children:[e.jsx(xe,{path:"/all",Icon:ds,label:h.t("sidebar.all"),count:u}),e.jsx(xe,{path:"/today",Icon:us,label:h.t("sidebar.today"),count:i}),e.jsx(xe,{path:"/starred",Icon:Ue,label:h.t("sidebar.starred"),count:a}),e.jsx(xe,{path:"/history",Icon:hs,label:h.t("sidebar.history"),count:n})]}),I=V=>{var k;return(k=l[V])==null?void 0:k.map(M=>e.jsx(qt,{style:{position:"relative",overflow:"hidden"},onClick:U=>{U.stopPropagation(),p(`/feed/${M.id}`),Y(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:M.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[r&&e.jsx(Ht,{feed:M,className:"feed-icon-sidebar"}),M.title]}),M.unreadCount!==0&&e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:M.unreadCount})]})},`/feed/${M.id}`))},z=()=>c.filter(V=>s||!d.includes(V.id)).map(V=>e.jsx(st.Item,{name:`/category/${V.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(tn,{category:V,path:L}),expandIcon:e.jsx(ms,{}),children:I(V.id)},V.id));return e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(Q,{hasCollapseButton:!1,selectedKeys:_,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(yt,{className:"avatar",size:32,children:e.jsx(cs,{style:{color:"var(--color-bg-1)"}})}),e.jsx(y.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:h.t("sidebar.articles")}),e.jsx(ve,{loading:!o,animation:!0,text:{rows:3}}),o&&w(),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:h.t("sidebar.feeds")})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx(ze,{style:{maxHeight:"100%"},autoHide:!0,children:e.jsxs(Q,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:_,children:[e.jsx(ve,{loading:!o,animation:!0,text:{rows:6}}),o&&e.jsx(st,{triggerRegion:"icon",bordered:!1,children:z()})]})})})]})},rn=()=>{const{showAllFeeds:t,theme:s}=f(F),{polyglot:r}=f(W),n=[{label:r.t("header.theme_option_light"),value:"light"},{label:r.t("header.theme_option_dark"),value:"dark"},{label:r.t("header.theme_option_system"),value:"system"}],o=ae(),a=$e().pathname,{setAddFeedModalVisible:i,setSettingsModalVisible:c}=qe(),{isBelowLarge:l}=he(),[d,u]=g.useState(!1),[h,j]=g.useState(!1),[p,_]=g.useState(!1);g.useEffect(()=>{l||u(!1)},[l]),g.useEffect(()=>{a&&u(!1)},[a]);const v=()=>{H({showAllFeeds:!t})},L=()=>{H({theme:s==="light"?"dark":"light"})},w=()=>{hr(),j(!1)},I=()=>{xr(),Le(!1),Pe(!1),o("/login"),b.success(r.t("header.logout_success"))},z=()=>s==="dark"?e.jsx(bs,{}):s==="system"?e.jsx(vs,{}):e.jsx(ws,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(T,{className:"trigger",onClick:()=>u(!d),shape:"circle",size:"small",children:e.jsx(fs,{})})}),e.jsx(ps,{className:"sidebar-drawer",visible:d,title:null,footer:null,closable:!1,onCancel:()=>u(!1),placement:"left",width:240,children:e.jsx(Wt,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(we,{size:16,children:[e.jsx(Se,{content:r.t("header.add_feed"),mini:!0,children:e.jsx(T,{shape:"circle",size:"small",type:"primary",icon:e.jsx(jt,{}),onClick:()=>i(!0)})}),e.jsx(Se,{content:t?r.t("header.hide_some_feeds"):r.t("header.show_all_feeds"),mini:!0,children:e.jsx(T,{shape:"circle",size:"small",icon:t?e.jsx(gs,{}):e.jsx(xs,{}),onClick:v})}),e.jsx(T,{shape:"circle",size:"small",icon:e.jsx(ys,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(rt,{droplist:e.jsx(Q,{defaultSelectedKeys:[s],className:"theme-menu",children:n.map(({label:V,value:k})=>e.jsxs(Q.Item,{className:"theme-menu-item",onClick:()=>H({theme:k}),children:[V,s===k&&e.jsx(_t,{style:{marginLeft:8}})]},k))}),trigger:"hover",position:"bottom",children:e.jsx(T,{icon:z(),shape:"circle",size:"small",onClick:L})}),e.jsx(rt,{droplist:e.jsxs(Q,{children:[e.jsxs(Q.Item,{onClick:()=>c(!0),children:[e.jsx(js,{className:"icon-right"}),r.t("header.settings")]},"0"),e.jsxs(Q.Item,{onClick:()=>j(!0),children:[e.jsx(ke,{className:"icon-right"}),r.t("header.reset_settings")]},"1"),e.jsxs(Q.Item,{onClick:()=>_(!0),children:[e.jsx(_s,{className:"icon-right"}),r.t("header.logout")]},"2")]}),trigger:"click",position:"br",children:e.jsx(yt,{size:28,style:{cursor:"pointer"},children:e.jsx(bt,{})})})]})}),e.jsx(ee,{title:r.t("header.settings_reset_confirm"),visible:h,onOk:w,onCancel:()=>j(!1),children:e.jsx("p",{children:r.t("header.settings_reset_description")})}),e.jsx(ee,{title:r.t("header.logout_confirm"),visible:p,onOk:I,onCancel:()=>_(!1),children:e.jsx("p",{children:r.t("header.logout_description")})})]})},nn=(t,s)=>{const r=t.split("."),n=s.split(".");for(let o=0;o<Math.max(r.length,n.length);o++){const a=r[o]||"0",i=n[o]||"0",c=a.localeCompare(i,void 0,{numeric:!0});if(c!==0)return c}return 0},Qe=()=>{const t=g.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,Le(!1);try{const r=await Promise.all([Nr(),je(0,"unread"),Lt(),Mt(),Ar(),_r(),$r()]),[n,o,a,i,c,l,d]=r,u=c.reduce((h,j)=>(h[j.id]=n.unreads[j.id]??0,h),{});$t(u),zt(o.total??0),Me(a.total??0),Re(i.total??0),re(c),_e(l),Br(nn(d.version,"2.2.0")>=0),Le(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},Ve={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Green:{light:"#00B42A",dark:"#27C346"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Magenta:{light:"#F5319D",dark:"#F756A9"}},Oe=t=>{const s=Ve[t]||Ve.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=O("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},Kt=t=>{Ss(Oe(t),{list:!0}).map(ks).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},an=()=>{const{articleWidth:t,fontSize:s,layout:r,showDetailedRelativeTime:n,showFeedIcon:o,themeColor:a}=f(F),{polyglot:i}=f(W),c=l=>{H(l),l.themeColor&&Kt(l.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.theme_color_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.theme_color_description")})]}),e.jsx("div",{style:{display:"flex"},children:Object.keys(Ve).map(l=>e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:Oe(l),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:l===a?`1px solid ${Oe(l)}`:"none"},onClick:()=>c({themeColor:l}),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&c({themeColor:l})},"aria-label":i.t("appearance.theme_color_aria_label",{color:l})}))})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.compact_article_list_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.compact_article_list_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:r==="small",onChange:l=>c({layout:l?"small":"large"})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.show_detailed_relative_time_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.show_detailed_relative_time_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:n,onChange:l=>c({showDetailedRelativeTime:l})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.show_feed_icon_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.show_feed_icon_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:o,onChange:l=>c({showFeedIcon:l})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.font_size_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.font_size_description")})]}),e.jsx("div",{children:e.jsxs(we,{children:[e.jsx(y.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(nt,{formatTooltip:l=>`${l}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:l=>c({fontSize:l})}),e.jsx(y.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.article_width_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.article_width_description")})]}),e.jsx("div",{children:e.jsxs(we,{children:[e.jsx(y.Text,{children:"60%"}),e.jsx(nt,{formatTooltip:l=>`${l}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:l=>c({articleWidth:l})}),e.jsx(y.Text,{children:"90%"})]})})]})]})},on=()=>{const t=f(me),[s]=R.useForm(),[r,n]=g.useState(!1),[o,a]=g.useState(""),[i,c]=g.useState({}),[l,d]=g.useState(!1),u=async()=>{if(o.trim()){try{const p=await br(o);_e(_=>[..._,{...p}]),b.success("Category added successfully")}catch(p){console.error("Failed to add category: ",p),b.error("Failed to add category")}a(""),d(!1)}},h=async(p,_,v)=>{try{const L=await wr(p,_,v);re(w=>w.map(I=>I.category.id===p?{...I,category:{...I.category,title:_,hide_globally:v}}:I)),_e(w=>w.map(I=>I.id===p?{...I,...L}:I)),b.success("Category updated successfully")}catch{b.error("Failed to update category")}n(!1),s.resetFields()},j=async p=>{try{(await vr(p.id)).status===204?(_e(v=>v.filter(L=>L.id!==p.id)),b.success(`Deleted category: ${p.title}`)):b.error(`Failed to delete category: ${p.title}`)}catch(_){console.error(`Failed to delete category: ${p.title}`,_),b.error(`Failed to delete category: ${p.title}`)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(p=>e.jsx(ue,{className:"tag-style",closable:p.feedCount===0,size:"medium",onClick:()=>{c(p),n(!0),s.setFieldsValue({title:p.title})},onClose:async _=>{_.stopPropagation(),await j(p)},children:p.title},p.id)),l?e.jsx(q,{autoFocus:!0,className:"input-style",onBlur:u,onChange:a,onPressEnter:u,size:"small",value:o}):e.jsx(ue,{className:"add-category-tag",icon:e.jsx(jt,{}),onClick:()=>d(!0),size:"medium",tabIndex:0})]}),i&&e.jsx(ee,{className:"modal-style",onOk:s.submit,title:"Edit Category",unmountOnExit:!0,visible:r,onCancel:()=>{n(!1),s.resetFields()},children:e.jsxs(R,{form:s,layout:"vertical",onSubmit:p=>h(i.id,p.title,p.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(R.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(q,{placeholder:"Please input category title"})}),e.jsx(R.Item,{label:"Hidden",field:"hidden",initialValue:i.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})})]})})]})},ln=t=>new Promise(s=>setTimeout(s,t)),Gt=vt(""),ht=E(Gt),Yt=X([$,Gt],(t,s)=>{const{feedsData:r}=t;return[...r].sort((n,o)=>n.disabled&&!o.disabled?1:!n.disabled&&o.disabled?-1:0).sort((n,o)=>o.parsing_error_count-n.parsing_error_count).filter(n=>be(n.title,s)||be(n.site_url,s)||be(n.feed_url,s))}),cn=X(Yt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),mt=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:Ir()}:t,dn=()=>{const t=f(me),{isAppDataReady:s}=f($),{showDetailedRelativeTime:r}=f(F),n=f(Yt),o=f(cn),{polyglot:a}=f(W),[i,c]=g.useState(!1),[l]=R.useForm(),[d,u]=g.useState(!1),[h,j]=g.useState(""),[p,_]=g.useState(null),{isBelowMedium:v}=he();g.useEffect(()=>{ht("")},[]);const L=m=>{_(m),u(!0),l.setFieldsValue({category:m.category.id,title:m.title,siteUrl:m.site_url,feedUrl:m.feed_url,hidden:m.hidden,disabled:m.disabled,crawler:m.crawler})},w=async(m,x,C=!0)=>{try{const P=(await m()).status===204;return C&&(P?b.success(a.t("feed_table.refresh_success")):b.error(a.t("feed_table.refresh_error"))),re(te=>te.map(J=>x(J,P))),P}catch{return C&&b.error(a.t("feed_table.refresh_error")),re(P=>P.map(te=>x(te,!1))),!1}},I=async(m,x=!0)=>{const C=m.id||m.key;return w(()=>Rr(C),(D,P)=>mt(D,P,C),x)},z=async()=>{try{const m=await Promise.all(n.map(async x=>{const C=new URL(x.feed_url).hostname,D=x.feed_url.replace(C,h),P=await ct(x.id,{feedUrl:D});return{...x,...P}}));re(x=>x.map(C=>m.find(D=>D.id===C.id)||C)),b.success(a.t("feed_table.bulk_update_success")),c(!1)}catch{b.error(a.t("feed_table.bulk_update_error"))}},V=()=>{const[m,x]=g.useState(!1),C=async()=>{x(!1),await w(Lr,mt)},D=async()=>{x(!1);const te=n.filter(se=>se.parsing_error_count>0);b.success(a.t("feed_table.bulk_refresh_error_feeds_message"));let J=0,B=0;for(const se of te)await I(se,!1)?J++:B++,await ln(500);b.success(a.t("feed_table.bulk_refresh_error_feeds_result",{success:J,failure:B}))},P=()=>x(!1);return e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:e.jsx(ke,{}),shape:"circle",onClick:()=>x(!0)}),e.jsx(ee,{className:"edit-modal",onCancel:P,title:a.t("feed_table.refresh_feeds_title"),visible:m,footer:[e.jsx(T,{onClick:P,children:a.t("feed_table.refresh_feeds_cancel")},"cancel"),e.jsx(T,{type:"outline",onClick:D,children:a.t("feed_table.refresh_feeds_error")},"error"),e.jsx(T,{type:"primary",onClick:C,children:a.t("feed_table.refresh_feeds_all")},"all")],children:e.jsx("p",{children:a.t("feed_table.refresh_feeds_description")})})]})},k=async m=>{try{(await Dr(m.key)).status===204?(re(C=>C.filter(D=>D.id!==m.key)),b.success(a.t("feed_table.remove_feed_success",{title:m.title}))):b.error(a.t("feed_table.remove_feed_error",{title:m.title}))}catch(x){console.error(`Failed to unfollow feed: ${m.title}`,x),b.error(a.t("feed_table.remove_feed_error",{title:m.title}))}},M=[{title:a.t("feed_table.table_title"),dataIndex:"title",sorter:(m,x)=>m.title.localeCompare(x.title,"en"),render:(m,x)=>{const C=x.parsing_error_count;let D=x.disabled?`🚫 ${m}`:m;C>0&&(D=`⚠️ ${m}`);const P=e.jsxs("div",{children:[m,C>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"⚠️ Parsing error count: ",C]})]});return e.jsx(y.Ellipsis,{expandable:!1,children:e.jsx(Se,{mini:!0,content:P,children:D})})}},!v&&{title:a.t("feed_table.table_url"),dataIndex:"feed_url",sorter:(m,x)=>m.feed_url.localeCompare(x.feed_url,"en"),render:m=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:m})},{title:a.t("feed_table.table_category"),dataIndex:"category.title",sorter:(m,x)=>m.category.title.localeCompare(x.category.title,"en"),render:m=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(ue,{children:m})})},!v&&{title:a.t("feed_table.table_checked_at"),dataIndex:"checked_at",sorter:(m,x)=>m.checked_at.localeCompare(x.checked_at,"en"),render:m=>e.jsx(y.Ellipsis,{expandable:!1,children:Rt(m,r)})},{title:a.t("feed_table.table_actions"),dataIndex:"op",fixed:"right",width:100,render:(m,x)=>e.jsxs(we,{children:[e.jsx("button",{"aria-label":a.t("feed_table.table_feed_edit_label"),className:"list-item-action",onClick:()=>L(x),type:"button",children:e.jsx(at,{})}),e.jsx("button",{"aria-label":a.t("feed_table.table_feed_refresh_label"),className:"list-item-action",onClick:()=>I(x),type:"button",children:e.jsx(ke,{})}),e.jsx(wt,{focusLock:!0,position:"left",title:a.t("feed_table.table_feed_remove_confirm"),onOk:()=>k(x),children:e.jsx("span",{className:"list-item-action",children:e.jsx(Cs,{})})})]})}].filter(Boolean),U=async(m,x)=>{try{const C=await ct(m,x);re(D=>D.map(P=>P.id===m?{...P,...C}:P)),b.success(a.t("feed_table.update_feed_success")),u(!1),l.resetFields()}catch{b.error(a.t("feed_table.update_feed_error"))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{alignItems:"center",display:"flex",width:"100%"},children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(q.Search,{className:"search-input",placeholder:a.t("feed_table.search_placeholder"),searchButton:!0,onChange:ht})}),e.jsxs("div",{style:{display:"flex",gap:16,paddingBottom:16,paddingLeft:16},children:[e.jsx(T,{icon:e.jsx(at,{}),shape:"circle",onClick:()=>c(!0)}),e.jsxs(ee,{className:"edit-modal",onOk:z,title:a.t("feed_table.modal_bulk_update_title"),visible:i,onCancel:()=>{c(!1),j("")},children:[e.jsx("p",{children:a.t("feed_table.modal_bulk_update_description")}),e.jsx(q,{placeholder:"rsshub.app",value:h,onChange:m=>j(m)})]}),e.jsx(V,{})]})]}),e.jsx(St,{borderCell:!0,className:"feed-table",columns:M,data:o,loading:!s,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),p&&e.jsx(ee,{className:"edit-modal",onOk:l.submit,title:a.t("feed_table.modal_edit_feed_title"),unmountOnExit:!0,visible:d,onCancel:()=>{u(!1),l.resetFields()},children:e.jsxs(R,{form:l,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async m=>{const x={categoryId:m.category,title:m.title,siteUrl:m.siteUrl.trim(),feedUrl:m.feedUrl.trim(),hidden:m.hidden,disabled:m.disabled,isFullText:m.crawler};x.feedUrl?await U(p.key,x):b.error(a.t("feed_table.modal_edit_feed_submit_error"))},children:[e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_category_label"),required:!0,field:"category",rules:[{required:!0}],children:e.jsx(N,{children:t.map(m=>e.jsx(N.Option,{value:m.id,children:m.title},m.id))})}),e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(q,{placeholder:a.t("feed_table.modal_edit_feed_title_placeholder")})}),e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_site_url_label"),field:"siteUrl",rules:[{required:!0}],children:e.jsx(q,{placeholder:a.t("feed_table.modal_edit_feed_site_url_placeholder")})}),e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_feed_url_label"),field:"feedUrl",rules:[{required:!0}],children:e.jsx(q,{placeholder:a.t("feed_table.modal_edit_feed_feed_url_placeholder")})}),e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_hidden_label"),field:"hidden",initialValue:p.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})}),e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_disabled_label"),field:"disabled",initialValue:p.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})}),e.jsx(R.Item,{label:a.t("feed_table.modal_edit_feed_crawler_label"),field:"crawler",tooltip:e.jsx("div",{children:a.t("feed_table.modal_edit_feed_crawler_tooltip")}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})})]})})]})},un=[{label:"English",value:"en-US"},{label:"简体中文",value:"zh-CN"}],hn=()=>{const{homePage:t,language:s,markReadOnScroll:r,orderBy:n,pageSize:o,removeDuplicates:a}=f(F),{polyglot:i}=f(W);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.language_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.language_description")})]}),e.jsx("div",{children:e.jsx(N,{className:"input-select",onChange:c=>H({language:c}),value:s,children:un.map(({label:c,value:l})=>e.jsx(N.Option,{value:l,children:c},l))})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.default_home_page_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.default_home_page_description")})]}),e.jsx("div",{children:e.jsxs(N,{className:"input-select",onChange:c=>H({homePage:c}),value:t,children:[e.jsx(N.Option,{value:"all",children:i.t("settings.default_home_page_option_all")}),e.jsx(N.Option,{value:"today",children:i.t("settings.default_home_page_option_today")}),e.jsx(N.Option,{value:"starred",children:i.t("settings.default_home_page_option_starred")}),e.jsx(N.Option,{value:"history",children:i.t("settings.default_home_page_option_history")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.entries_order_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.entries_order_description")})]}),e.jsx("div",{children:e.jsxs(N,{className:"input-select",onChange:c=>H({orderBy:c}),value:n,children:[e.jsx(N.Option,{value:"published_at",children:i.t("settings.entries_order_option_published_at")}),e.jsx(N.Option,{value:"created_at",children:i.t("settings.entries_order_option_created_at")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.entries_per_page_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.entries_per_page_description")})]}),e.jsx("div",{children:e.jsx(Is,{className:"input-select",defaultValue:o,min:1,mode:"button",onChange:c=>H({pageSize:c}),size:"small"})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.remove_duplicates_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.remove_duplicates_description")})]}),e.jsx("div",{children:e.jsxs(N,{className:"input-select",onChange:c=>H({removeDuplicates:c}),value:a,children:[e.jsx(N.Option,{value:"none",children:i.t("settings.remove_duplicates_option_none")}),e.jsx(N.Option,{value:"hash",children:i.t("settings.remove_duplicates_option_hash")}),e.jsx(N.Option,{value:"title",children:i.t("settings.remove_duplicates_option_title")}),e.jsx(N.Option,{value:"url",children:i.t("settings.remove_duplicates_option_url")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.mark_read_on_scroll_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.mark_read_on_scroll_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:r,onChange:c=>H({markReadOnScroll:c})})})]})]})},mn=()=>{const{polyglot:t}=f(W),s=[{title:t.t("hotkeys.key"),dataIndex:"keyName",render:n=>e.jsx(ue,{children:n})},{title:t.t("hotkeys.function"),dataIndex:"description"}],r=[{key:"1",keyName:"Esc",description:t.t("hotkeys.esc")},{key:"2",keyName:"←",description:t.t("hotkeys.left")},{key:"3",keyName:"Ctrl + ←",description:t.t("hotkeys.ctrl_left")},{key:"4",keyName:"→",description:t.t("hotkeys.right")},{key:"5",keyName:"Ctrl + →",description:t.t("hotkeys.ctrl_right")},{key:"6",keyName:"B",description:t.t("hotkeys.b")},{key:"7",keyName:"D",description:t.t("hotkeys.d")},{key:"8",keyName:"M",description:t.t("hotkeys.m")},{key:"9",keyName:"S",description:t.t("hotkeys.s")},{key:"10",keyName:"V",description:t.t("hotkeys.v")}];return e.jsx(St,{borderCell:!0,columns:s,data:r,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}})},fn=()=>{const{polyglot:t}=f(W),s=(r,n)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r,e.jsx("div",{style:{fontSize:"12px"},children:n})]});return e.jsxs(ie,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(ie.TabPane,{title:s(e.jsx(Ts,{style:{fontSize:"20px"}}),t.t("settings.feeds")),children:e.jsx(dn,{})},"1"),e.jsx(ie.TabPane,{title:s(e.jsx(Fs,{style:{fontSize:"20px"}}),t.t("settings.categories")),children:e.jsx(on,{})},"2"),e.jsx(ie.TabPane,{title:s(e.jsx(Es,{style:{fontSize:"20px"}}),t.t("settings.general")),children:e.jsx(hn,{})},"3"),e.jsx(ie.TabPane,{title:s(e.jsx(As,{style:{fontSize:"20px"}}),t.t("settings.appearance")),children:e.jsx(an,{})},"4"),e.jsx(ie.TabPane,{title:s(e.jsx(Ns,{style:{fontSize:"20px"}}),t.t("settings.hotkeys")),children:e.jsx(mn,{})},"5")]})},pn=[{required:!0}],gn=[{required:!0}],xn=[{type:"boolean"}],yn=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=qe();return e.jsx(ee,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(fn,{})})},jn=()=>{const t=f(me),{polyglot:s}=f(W),{addFeedModalVisible:r,setAddFeedModalVisible:n}=qe(),[o,a]=g.useState(!1),[i]=R.useForm(),{fetchAppData:c}=Qe(),l=async(d,u,h)=>{a(!0);try{await Mr(d,u,h),await c(),b.success("Added a feed successfully"),n(!1),i.resetFields()}catch{b.error("Failed to add a feed")}finally{a(!1)}};return e.jsx(ee,{title:s.t("main.add_feed_modal_title"),visible:r,unmountOnExit:!0,style:{width:"400px"},onOk:i.submit,confirmLoading:o,onCancel:()=>{n(!1),i.resetFields()},children:e.jsxs(R,{form:i,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async d=>{const u=d.url.trim();u?await l(u,d.category,d.crawler):b.error("Feed URL cannot be empty")},children:[e.jsx(R.Item,{label:s.t("main.add_feed_modal_feed_url_label"),field:"url",rules:pn,children:e.jsx(q,{placeholder:s.t("main.add_feed_modal_feed_url_placeholder")})}),e.jsx(R.Item,{field:"category",label:s.t("main.add_feed_modal_category_label"),required:!0,rules:gn,children:e.jsx(N,{placeholder:s.t("main.add_feed_modal_category_placeholder"),showSearch:!0,filterOption:(d,u)=>be(u.props.children,d),children:t.map(d=>e.jsx(N.Option,{value:d.id,children:d.title},d.id))})}),e.jsx(R.Item,{field:"crawler",initialValue:!1,label:s.t("main.add_feed_modal_crawler_label"),rules:xn,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(Z,{})})]})})},_n=()=>e.jsxs("div",{className:"main",children:[e.jsx(Rs,{}),e.jsx(yn,{}),e.jsx(jn,{})]}),Xt=()=>{const{theme:t,themeColor:s}=f(F),[r,n]=g.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);g.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),a=i=>n(i.matches);return o.addEventListener("change",a),()=>o.removeEventListener("change",a)},[]),g.useEffect(()=>{const o=a=>{const i=a?"dark":"light";document.body.setAttribute("arco-theme",i),document.body.style.colorScheme=i};Kt(s),o(t==="system"?r:t==="dark")},[r,t,s])},bn=()=>{Et(),Xt();const{isBelowLarge:t}=he(),{polyglot:s}=f(W);return s?e.jsxs("div",{className:"app",children:[t?null:e.jsx(Ls.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(Wt,{})}),e.jsx(rn,{}),e.jsx(_n,{})]}):null},Jt=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},Qt=t=>{var o;const n=(o=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:o.getAttribute("src");return{...t,imgSrc:n}},vn=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(Qt);fe(s),Jr(t.total)}},wn=t=>{const{isAppDataReady:s}=f($),{showStatus:r}=f(F),n=g.useRef(!1),o=async a=>{if(!n.current){n.current=!0,Pe(!1);try{const i=r==="unread"?await a(0,"unread"):await a();Pe(!0),ne(!0),vn(i)}catch(i){console.error("Error fetching articles: ",i),ne(!1)}finally{n.current=!1}}};return g.useEffect(()=>{s&&o(t)},[s]),{fetchArticleList:o}},Zt=vt(!1),ft=E(Zt),Ze=()=>{const{offset:t}=f(A),{pageSize:s,showStatus:r}=f(F),n=f(Zt),o=i=>{const c=(l,d)=>d.filter(u=>!l.some(h=>h.id===u.id));fe(l=>[...l,...c(l,i)]),Bt(l=>l+s)};return{handleLoadMore:async i=>{ft(!0);try{const c=r==="unread"?await i(t+s,"unread"):await i(t+s);if(c!=null&&c.entries){const l=c.entries.map(Qt);o(l)}}catch(c){console.error("Error fetching more articles: ",c)}finally{ft(!1)}},loadingMore:n}},et=le({isPhotoSliderVisible:!1,selectedIndex:0}),Sn=E(et,"isPhotoSliderVisible"),kn=E(et,"selectedIndex"),es=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=f(et);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:Sn,selectedIndex:s,setSelectedIndex:kn}},ts=(t,s)=>{const{activeContent:r}=f(A),n=f(Je),o=f(Xe),{isPhotoSliderVisible:a,setIsPhotoSliderVisible:i,setSelectedIndex:c}=es(),{loadingMore:l}=Ze(),[d,u]=g.useState(!1),[h,j]=g.useState(!1);g.useEffect(()=>{h&&!l&&(u(!1),j(!1),v())},[l,h]),g.useEffect(()=>{var k;r&&((k=document.querySelector(".card-custom-selected-style"))==null||k.scrollIntoView({behavior:"smooth",block:"nearest"}))},[r]);const p=()=>{r&&(Y(null),s.current&&s.current.contentWrapperEl.focus())},_=(k=!1)=>{const M=n.findIndex(U=>U.id===(r==null?void 0:r.id));if(M>0){const U=k?n.slice(0,M).toReversed().find(m=>m.status==="unread"):n[M-1];U&&t(U)}},v=(k=!1)=>{if(d)return;const M=n.findIndex(x=>x.id===(r==null?void 0:r.id));if(M===n.length-1&&o){u(!0),j(!0);return}if(M===-1){s.current.contentWrapperEl.scrollTo({top:0,left:0,behavior:"smooth"});return}const m=k?n.slice(M+1).find(x=>x.status==="unread"):n[M+1];m&&(t(m),j(!1))};return{exitDetailView:p,fetchOriginalArticle:k=>{r&&k()},navigateToNextArticle:v,navigateToPreviousArticle:_,openLinkExternally:()=>{r&&window.open(r.url,"_blank")},openPhotoSlider:()=>{!r||!Jt(r.content).length||a||(c(0),i(!0),ne(!1))},toggleReadStatus:k=>{r&&k()},toggleStarStatus:k=>{r&&k()}}},Cn=({handleEntryClick:t,entryListRef:s})=>{const{activeContent:r}=f(A),{handleFetchContent:n,handleToggleStarred:o,handleToggleStatus:a}=Ye(),{exitDetailView:i,navigateToNextArticle:c,navigateToPreviousArticle:l}=ts(t,s);if(!r)return null;const d=r.status==="unread",u=r.starred;return e.jsxs(T.Group,{className:"action-buttons",children:[e.jsx(T,{icon:e.jsx(Ms,{}),onClick:()=>i(),shape:"round",type:"primary"}),e.jsx(T,{icon:d?e.jsx(kt,{}):e.jsx(Ct,{}),onClick:()=>a(r),type:"primary"}),e.jsx(T,{icon:u?e.jsx(Be,{style:{color:"#ffcd00"}}):e.jsx(Ue,{}),onClick:()=>o(r),type:"primary"}),e.jsx(T,{icon:e.jsx(Ds,{}),onClick:()=>l(),type:"primary"}),e.jsx(T,{icon:e.jsx(Ps,{}),onClick:()=>c(),type:"primary"}),e.jsx(T,{icon:e.jsx(Vs,{}),onClick:n,shape:"round",type:"primary"})]})},In=({url:t,text:s})=>{const[r,n]=g.useState(!1),o=()=>n(!r);return e.jsx(Us,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:o,onMouseLeave:o,children:s})},pt=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var _;const{fontSize:o}=f(F),[a,i]=g.useState(!1),[c,l]=g.useState(!1),{isBelowMedium:d}=he();g.useEffect(()=>{const L=(n?t.children[0]:t).attribs.src,w=new Image;w.src=L,w.onload=()=>l(w.width<=100&&w.height<=100)},[t,n]);const u=n?t.children[0]:t,h=()=>e.jsx("img",{...u.attribs,alt:u.attribs.alt??"image",style:c?{display:"inline-block",width:"auto",height:`${o}rem`,margin:0}:{}});if(c)return n?e.jsxs("a",{...t.attribs,children:[h(),(_=t.children[1])==null?void 0:_.data]}):h();const j=()=>i(!0),p=()=>i(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:j,onMouseLeave:p,children:[n?e.jsx("a",{...t.attribs,children:h()}):h(),e.jsx(T,{icon:e.jsx(Bs,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:d||a?1:0,transition:"opacity 0.3s"},onClick:v=>{v.preventDefault(),r(s)}})]})})},Tn=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const n=r.children[0];if(n.type==="tag"&&n.name==="img"){const o=t.findIndex(a=>a===n.attribs.src);return e.jsx(pt,{node:r,index:o,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const n=t.findIndex(o=>o===r.attribs.src);return e.jsx(pt,{node:r,index:n,togglePhotoSlider:s})}return r}}),Fn=g.forwardRef(({handleEntryClick:t,entryListRef:s},r)=>{const n=ae(),{activeContent:o}=f(A),{articleWidth:a,fontSize:i}=f(F),{isPhotoSliderVisible:c,setIsPhotoSliderVisible:l,selectedIndex:d,setSelectedIndex:u}=es(),h=()=>{Te("author"),Ie(o.author)},j=I=>{u(I),l(z=>!z),ne(z=>!z)};if(!o)return e.jsxs("div",{ref:r,className:"content-empty",children:[e.jsx(Os,{style:{fontSize:"64px"}}),e.jsx(y.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const p=Jt(o.content),_=Tn(p,j),v=$s(o.content,_),{id:L,title:w}=o.feed.category;return e.jsxs("div",{className:"article-content",onBlur:()=>ne(!1),onFocus:()=>ne(!0),ref:r,children:[e.jsxs(ze,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${a}%`},children:[e.jsx(y.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",children:o.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(y.Text,{children:e.jsx(In,{url:`/feed/${o.feed.id}`,text:o.feed.title})}),e.jsx(y.Text,{onClick:h,style:{cursor:"pointer"},children:` - ${o.author}`}),e.jsx(y.Text,{children:e.jsx(ue,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>n(`/category/${L}`),children:w})})]}),e.jsx(y.Text,{className:"article-date",children:G(o.published_at).format("dddd, MMMM D, YYYY [at] h:mm A")}),e.jsx(K,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${i}rem`,width:`${a}%`},children:[v,e.jsx(zs,{images:p.map(I=>({src:I,key:I})),loop:!1,visible:c,onClose:()=>{l(!1),ne(!0)},index:d,onIndexChange:u})]},o.id)]}),e.jsx(Cn,{handleEntryClick:t,entryListRef:s})]})}),En=({alt:t,borderRadius:s,height:r,src:n,status:o,width:a})=>{const[i,c]=g.useState(!1),{ref:l}=Ee({triggerOnce:!0,onChange:(d,u)=>{if(d&&!i){const h=new Image;h.onload=()=>c(!0),h.onerror=()=>{u.target.style.display="none"},h.src=n}}});return e.jsx("div",{className:"image-container",ref:l,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:i?e.jsx("img",{className:o==="unread"?"":"read",src:n,alt:t,style:{width:a,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(ve,{text:{rows:0},image:{style:{width:a,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},An=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(En,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},Nn=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:o}=f(F),a=Fe({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:a,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:t.imgSrc?r?"0 10px 0 0":"0 0 10px 0":"0"},children:e.jsx(An,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(y.Text,{className:"article-card-title",children:t.title}),e.jsxs(y.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(Ht,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Rt(t.published_at,o)]}),t.starred&&e.jsx(Be,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},Rn=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:o,showFeedIcon:a}=f(F),{activeContent:i}=f(A),c=i&&t.id===i.id,{handleToggleStarred:l,handleToggleStatus:d}=Ye(),[u,h]=g.useState(0),j=100,p=.5,_=t.starred,v=t.status==="unread",L=Hs({preventScrollOnSwipe:!0,delta:j/2,onSwiping:x=>{const C=Math.min(Math.abs(x.deltaX*p),j)*Math.sign(x.deltaX);h(C)},onSwiped:async x=>{try{x.deltaX>j?(await l(t),b.success(_?"Unmarked as starred":"Marked as starred")):x.deltaX<-j&&(await d(t),b.success(v?"Marked as read":"Marked as unread"))}catch{b.error("Failed to update, please try again")}h(0)}}),[w,I]=g.useState(!1),[z,V]=g.useState(!1),k=()=>d(t),M=20,{ref:U}=Ee({skip:z,onChange:async(x,C)=>{if(!(!o||!v)){if(x)I(!0);else if(w){const{top:D}=C.boundingClientRect;D<M&&(await k(),V(!0))}}}}),m=qs({x:u});return g.createElement("div",{...L,className:"article-card",key:t.id},e.jsxs("div",{ref:U,children:[e.jsx(Ws.div,{className:"swipe-card",style:m,children:e.jsx(Ce,{className:Fe("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":c}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Ce.Meta,{description:e.jsx(Nn,{entry:t,showFeedIcon:a,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:_?e.jsx(Be,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(Ue,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:v?e.jsx(kt,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(Ct,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},Ln=()=>{const{layout:t}=f(F),{isArticleListReady:s}=f(A),r=t==="large"?2:4,n=o=>e.jsx(Ce,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Ce.Meta,{description:e.jsx(ve,{loading:!s,animation:!0,text:{rows:3,width:150}})})},o);return!s&&Array.from({length:r},(o,a)=>n(a))},Mn=()=>{const{orderDirection:t}=f(F),{filterString:s,filterType:r}=f(A),{polyglot:n}=f(W),{isBelowMedium:o}=he(),a=()=>{H({orderDirection:t==="desc"?"asc":"desc"})};return g.useEffect(()=>{Te("title"),Ie("")},[]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(q.Search,{allowClear:!0,onChange:Ie,placeholder:n.t("article_list.search_placeholder"),style:{width:o?"100%":278,marginLeft:8},value:s,addBefore:e.jsxs(N,{onChange:Te,style:{width:100},value:r,children:[e.jsx(N.Option,{value:"title",children:n.t("article_list.search_type_title")}),e.jsx(N.Option,{value:"content",children:n.t("article_list.search_type_content")}),e.jsx(N.Option,{value:"author",children:n.t("article_list.search_type_author")})]})}),e.jsx(Se,{mini:!0,content:t==="desc"?n.t("article_list.sort_direction_desc"):n.t("article_list.sort_direction_asc"),children:e.jsx(T,{shape:"circle",size:"small",style:{margin:"0 8px",flexShrink:0},icon:t==="desc"?e.jsx(Ks,{}):e.jsx(Gs,{}),onClick:a})})]})},Dn=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},Pn=(t,s,r)=>{g.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},Vn=({duration:t,color:s})=>{const[r,n]=g.useState([]);Pn(r.length,t,()=>{n([])});const o=a=>{const i=a.currentTarget.getBoundingClientRect(),c=i.width>i.height?i.width:i.height,l=a.pageX-i.x-c/2,d=a.pageY-i.y-c/2,u={x:l,y:d,size:c,id:`${new Date().getTime()}-${l}-${d}`};n([...r,u])};return e.jsx("div",{className:"ripple-container",onMouseDown:o,children:r.length>0&&r.map(a=>e.jsx("span",{className:"ripple-span",style:{top:a.y,left:a.x,width:a.size,height:a.size,backgroundColor:s,animationDuration:`${t}ms`}},a.id))})},On=({getEntries:t})=>{const{isArticleListReady:s}=f(A),r=f(Xe),{loadingMore:n,handleLoadMore:o}=Ze(),{ref:a}=Ee({skip:!r,onChange:async i=>{!i||!s||n||await o(t)}});return s&&r&&e.jsxs("div",{className:"load-more-container",ref:a,children:[e.jsx(Xs,{loading:n,style:{paddingRight:"10px"}}),"Loading more ..."]})},$n=g.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:o,pageSize:a}=f(F),i=o==="small",{isArticleListReady:c}=f(A),l=f(Je),d=l.length-Math.ceil(a*.2)-1,u=f(Xe),{loadingMore:h,handleLoadMore:j}=Ze(),{ref:p}=Ee({skip:!u,onChange:async w=>{!w||!c||h||await j(t)}}),_=Ys({count:l.length,getScrollElement:()=>r.current,estimateSize:()=>i?120:280}),v=_.getVirtualItems(),L=g.useCallback(w=>w===d?Dn(_.measureElement,p):_.measureElement,[d,_.measureElement,p]);return e.jsxs(e.Fragment,{children:[e.jsx(Mn,{}),e.jsxs(ze,{className:"entry-list",ref:n,children:[e.jsx(Ln,{}),c&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:_.getTotalSize(),width:"100%",position:"relative"},children:v.map(w=>e.jsx("div",{"data-index":w.index,ref:L(w.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${w.start}px)`},children:e.jsx(Rn,{entry:l[w.index],handleEntryClick:s,mini:i,children:e.jsx(Vn,{color:"var(--color-text-4)",duration:1e3})})},w.key))})}),e.jsx(On,{getEntries:t})]})]})}),zn=()=>{fe(t=>t.map(s=>({...s,status:"read"})))},Un=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:n}=f(A),{showStatus:o}=f(F),{polyglot:a}=f(W),{fetchAppData:i}=Qe(),c=async()=>{try{await r(),zn(),await i(),b.success(a.t("article_list.mark_all_as_read_success"))}catch{b.error(a.t("article_list.mark_all_as_read_error"))}},l=d=>{H({showStatus:d})};return g.useEffect(()=>{Te("title"),Ie("")},[o]),e.jsxs("div",{className:"entry-panel",children:[!["starred","history"].includes(t.from)&&e.jsx(wt,{focusLock:!0,title:a.t("article_list.mark_all_as_read_confirm"),onOk:c,children:e.jsx(T,{icon:e.jsx(_t,{}),shape:"circle"})}),e.jsx(Js.Group,{disabled:t.from==="history",onChange:l,options:[{label:a.t("article_list.filter_status_all"),value:"all"},{label:a.t("article_list.filter_status_unread"),value:"unread"}],type:"button",value:t.from==="history"?"all":o}),e.jsx(T,{icon:e.jsx(ke,{}),loading:!n,shape:"circle",onClick:s})]})},de=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleFocused:o,isArticleListReady:a}=f(A),{isAppDataReady:i}=f($),{orderBy:c,orderDirection:l,showAllFeeds:d,showStatus:u}=f(F),h=f(Je),{handleFetchContent:j,handleToggleStarred:p,handleToggleStatus:_,handleEntryStatusUpdate:v}=Ye(),{fetchAppData:L}=Qe(),{fetchArticleList:w}=wn(s),I=g.useRef(null),z=g.useRef(null),V=g.useRef(null);g.useEffect(()=>{Xr(t.from),n&&Y(null),J(s)},[t]),g.useEffect(()=>{["starred","history"].includes(t.from)||J(s)},[c,d]),g.useEffect(()=>{J(s)},[l,u]);const k=async B=>{if(Y(null),B.status!=="unread"){setTimeout(()=>{Y({...B,status:"read"})},200);return}try{setTimeout(()=>{Y({...B,status:"read"}),v(B,"read")},200),await Ae([B.id],"read")}catch{b.error("Failed to mark entry as read, please try again later"),v(B,"unread")}},{exitDetailView:M,fetchOriginalArticle:U,navigateToNextArticle:m,navigateToPreviousArticle:x,openLinkExternally:C,openPhotoSlider:D,toggleReadStatus:P,toggleStarStatus:te}=ts(k,I);g.useEffect(()=>{const B={ArrowLeft:()=>x(),ArrowRight:()=>m(),Escape:()=>M(),b:C,d:()=>U(j),m:()=>P(()=>_(n)),s:()=>te(()=>p(n)),v:D},se=oe=>{const tt=B[oe.key];tt&&(oe.key==="ArrowLeft"?x(oe.ctrlKey):oe.key==="ArrowRight"?m(oe.ctrlKey):tt())};return o?document.addEventListener("keydown",se):document.removeEventListener("keydown",se),()=>{document.removeEventListener("keydown",se)}},[n,h,o]);const J=async B=>{Bt(0),i?await w(B):await L()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(ot,{in:a,timeout:200,nodeRef:z,classNames:"fade",children:e.jsx($n,{cardsRef:z,getEntries:s,handleEntryClick:k,ref:I})}),e.jsx(Un,{info:t,refreshArticleList:()=>J(s),markAllAsRead:r})]}),e.jsx(ot,{in:n!==null,timeout:200,nodeRef:V,classNames:"fade",unmountOnExit:!0,children:e.jsx(Fn,{handleEntryClick:k,entryListRef:I,ref:V})})]})},Bn=()=>e.jsx(de,{info:{from:"all",id:""},getEntries:Er,markAllAsRead:zr}),Hn=()=>{const{id:t}=It(),s=O("orderBy"),r=O("pageSize"),n=O("showAllFeeds"),o=async(a=0,i=null)=>{const c={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:a,limit:r,status:i},l={globally_visible:!n};return S.get(ce(c,l))};return e.jsx(de,{info:{from:"category",id:t},getEntries:o,markAllAsRead:()=>Sr(t)})},qn=()=>{const t=ae(),s=Qs();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(Zs,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(T,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},Wn=()=>{const{id:t}=It(),s=O("orderBy"),r=O("pageSize"),n=async(o=0,a=null)=>{const i={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:o,limit:r,status:a};return S.get(ce(i))};return e.jsx(de,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>Pr(t)})},Kn=()=>e.jsx(de,{info:{from:"history",id:""},getEntries:Mt}),Gn=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,o]of Object.entries(s))if(n!=="password"){const a=o==null?void 0:o.trim();t.setFieldValue(n,a),a||(r=!1)}else o||(r=!1);return r},ye=(t,s)=>{t.key==="Enter"&&s.submit()},Yn=()=>{Et(),Xt();const{polyglot:t}=f(W),[s]=er(),[r,n]=g.useState(!1),[o,a]=g.useState("token"),i=ae(),c=async()=>{n(!0);const{server:d,token:u,username:h,password:j}=s.getFieldsValue();try{(await xt.raw("v1/me",{baseURL:d,headers:u?{"X-Auth-Token":u}:{Authorization:`Basic ${btoa(`${h}:${j}`)}`}})).status===200&&(b.success(t.t("login.success")),Nt({server:d,token:u,username:h,password:j}),i("/"))}catch(p){console.error(p),b.error(p.message)}n(!1)},l=async()=>{const d=s.getFieldsValue();if(!Ke(d)){b.error(t.t("login.auth_error"));return}await c()};return t?e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(y.Title,{heading:3,children:t.t("login.login_to_your_server")}),e.jsxs(R,{autoComplete:"off",form:s,layout:"vertical",onSubmit:async()=>{Gn(s)?await l():b.error(t.t("login.submit_error"))},children:[e.jsx(R.Item,{field:"server",label:t.t("login.server_label"),rules:[{required:!0}],onKeyDown:d=>{ye(d,s)},children:e.jsx(q,{disabled:r,placeholder:t.t("login.server_placeholder"),prefix:e.jsx(tr,{})})}),o==="token"&&e.jsx(R.Item,{field:"token",label:t.t("login.token_label"),rules:[{required:!0}],onKeyDown:d=>{ye(d,s)},children:e.jsx(q.Password,{disabled:r,placeholder:t.t("login.token_placeholder"),prefix:e.jsx(it,{})})}),o==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(R.Item,{field:"username",label:t.t("login.username_label"),rules:[{required:!0}],onKeyDown:d=>{ye(d,s)},children:e.jsx(q,{disabled:r,placeholder:t.t("login.username_placeholder"),prefix:e.jsx(bt,{})})}),e.jsx(R.Item,{field:"password",label:t.t("login.password_label"),rules:[{required:!0}],onKeyDown:d=>{ye(d,s)},children:e.jsx(q.Password,{disabled:r,placeholder:t.t("login.password_placeholder"),prefix:e.jsx(it,{})})})]})]}),e.jsx(T,{loading:r,type:"primary",long:!0,onClick:()=>s.submit(),style:{marginTop:"20px"},children:t.t("login.login_button")}),e.jsx(K,{orientation:"center",children:t.t("login.another_login_method")}),e.jsx(T,{type:"secondary",long:!0,onClick:()=>a(o==="token"?"user":"token"),style:{marginTop:"20px"},children:o==="token"?t.t("login.another_login_button"):t.t("login.token_label")}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(y.Text,{disabled:!0,children:t.t("login.need_help")}),e.jsx(sr,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:t.t("login.miniflux_offical_website")})]})]})}),e.jsx("div",{className:"background"})]}):null},Xn=({children:t})=>{const s=f(We);return Ke(s)?e.jsx(e.Fragment,{children:t}):e.jsx(Tt,{to:"/login"})},Jn=()=>e.jsx(de,{info:{from:"starred",id:""},getEntries:Lt}),Qn=()=>{const t=async()=>{const s=await je(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=je(0,"unread",r).then(a=>a.entries));const o=n.map(a=>a.id);return Ae(o,"read")};return e.jsx(de,{info:{from:"today",id:""},getEntries:je,markAllAsRead:t})},Zn=O("homePage"),ea=[{path:"/all",element:e.jsx(Bn,{})},{path:"/today",element:e.jsx(Qn,{})},{path:"/starred",element:e.jsx(Jn,{})},{path:"/history",element:e.jsx(Kn,{})},{path:"/category/:id",element:e.jsx(Hn,{})},{path:"/feed/:id",element:e.jsx(Wn,{})}],ss=rr([{path:"/",element:e.jsx(Xn,{children:e.jsx(bn,{})}),errorElement:e.jsx(qn,{}),children:[...ea,{index:!0,element:e.jsx(Tt,{to:`/${Zn}`,replace:!0})}]},{path:"/login",element:e.jsx(Yn,{})}]);nr.createRoot(document.getElementById("root")).render(e.jsx(ar,{locale:navigator.language==="zh-CN"?or:ir,children:e.jsx(lr,{router:ss})}));
