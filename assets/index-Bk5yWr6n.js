import{d as Y,r as yt,a as Re,M as I,g as jt,b as Ct,c as bt,u as de,j as e,B as N,I as vt,S as fe,T as z,e as Le,f as wt,h as St,i as kt,D as Ft,k as Z,l as Tt,m as It,A as Ne,n as Me,o as d,p as b,R as ie,q as W,s as me,t as Et,F as _,v as $,w as _e,x as ge,y as q,z as le,C as At,E as Rt,P as Ue,G as Lt,H as ee,J as oe,K as Nt,L as Mt,N as _t,O as Ut,Q as $t,U as Pt,V as $e,W as Pe,X as Dt,Y as zt,Z as be,_ as Kt,$ as Ot,a0 as Vt,a1 as Gt,a2 as Bt,a3 as De,a4 as ze,a5 as ye,a6 as Ke,a7 as Oe,a8 as Ve,a9 as Ht,aa as Wt,ab as qt,ac as Yt,ad as Jt,ae as Xt,af as J,ag as Ge,ah as Qt,ai as Zt,aj as Te,ak as es,al as ts,am as Be,an as ss,ao as ns,ap as Ie,aq as rs,ar as os,as,at as is,au as ls,av as cs,aw as ds}from"./vendor-BvOeNq_M.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();Y.extend(yt);const us=t=>{const s=Y(t),n=Y();return s.isAfter(n.subtract(24,"hour"))},hs=()=>Y().subtract(24,"hour").unix(),ve=t=>Y(t).fromNow(),xe=()=>{const t=JSON.parse(localStorage.getItem("auth"));return t||(console.log("No auth info found in localStorage"),null)},ps=(t,s)=>{const n={method:t,secret:s};localStorage.setItem("auth",JSON.stringify(n))},R=Re.create({timeout:5e3});R.interceptors.request.use(t=>{const s=xe(),{server:n,token:r,username:o,password:i}=(s==null?void 0:s.secret)||{};return t.baseURL=n,r&&(t.headers["X-Auth-Token"]=r),o&&i&&(t.auth={username:o,password:i}),t},t=>Promise.reject(t));R.interceptors.response.use(t=>t,t=>{var n,r,o;console.error(t);const s=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.error_message)||t.message;return I.error(s),((o=t.response)==null?void 0:o.status)===401&&(localStorage.removeItem("auth"),rt.navigate("/login")),Promise.reject(t)});const He=async(t,s)=>R.put("/v1/entries",{entry_ids:t,status:s}),We=async(t,s)=>He([t],s),ms=async t=>R.put(`/v1/entries/${t}/bookmark`),xs=async t=>R.get(`/v1/entries/${t}/fetch-content`),fs=async()=>R.get("/v1/me"),gs=async()=>R.get("/v1/feeds/counters"),qe=async()=>R.get("/v1/feeds"),Ye=async()=>R.get("/v1/categories"),ys=async t=>R.delete(`/v1/categories/${t}`),js=async t=>R.post("/v1/categories",{title:t}),Cs=async(t,s)=>R.put(`/v1/categories/${t}`,{title:s}),bs=async(t,s,n,r,o)=>R.put(`/v1/feeds/${t}`,{feed_url:s,title:n,category_id:r,crawler:o}),vs=async t=>R.put(`/v1/feeds/${t}/refresh`),ws=async t=>R.delete(`/v1/feeds/${t}`),Ss=async(t,s,n)=>R.post("/v1/feeds",{feed_url:t,category_id:s,crawler:n}),ks=async(t=0,s=null)=>{const n=`/v1/entries?order=published_at&direction=desc&offset=${t}`,r=s?`${n}&status=${s}`:n;return R.get(r)},Je=async(t=0)=>{const s=`/v1/entries?order=changed_at&direction=desc&status=read&offset=${t}`;return R.get(s)},Xe=async(t=0,s=null)=>{const n=`/v1/entries?order=published_at&direction=desc&starred=true&offset=${t}`,r=s?`${n}&status=${s}`:n;return R.get(r)},pe=async(t=0,s=null,n=null)=>{let o=`/v1/entries?order=published_at&direction=desc&published_after=${hs()}&offset=${t}`;return s&&(o+=`&status=${s}`),n&&(o+=`&limit=${n}`),R.get(o)},G=t=>{const s=JSON.parse(localStorage.getItem("config"));if(!s)return console.log("No config found in localStorage"),null;const n=s[t];return typeof n>"u"?(console.log(`Config for "${t}" not found`),null):n},X=(t,s)=>{const r={...JSON.parse(localStorage.getItem("config"))||{},[t]:s};localStorage.setItem("config",JSON.stringify(r))},Qe=[{name:"Red",valueLight:"#F53F3F",valueDark:"#F76965"},{name:"Orange",valueLight:"#F77234",valueDark:"#F9925A"},{name:"Green",valueLight:"#00B42A",valueDark:"#27C346"},{name:"Blue",valueLight:"#165DFF",valueDark:"#3C7EFF"},{name:"Purple",valueLight:"#722ED1",valueDark:"#8E51DA"}],Ce=t=>{const s=Qe.find(r=>r.name===t),n=G("theme")||"light";return s?n==="light"?s.valueLight:s.valueDark:"#165DFF"},ce=t=>{jt(Ce(t),{list:!0}).map(n=>Ct(n)).forEach((n,r)=>{document.body.style.setProperty(`--primary-${r+1}`,n)})},Fs=(t,s)=>s==="read"?Math.max(0,t-1):t+1,Ee=(t,s,n)=>t.map(r=>{if(r.id===s){let o;return typeof n=="string"?o=Fs(r.unreadCount,n):o=n,{...r,unreadCount:o}}return r}),p=bt((t,s)=>({feeds:[],groups:[],unreadTotal:0,unreadToday:0,starredCount:0,readCount:0,loading:!0,visible:{settings:!1,addFeed:!1},theme:G("theme")||"light",layout:G("layout")||"large",fontSize:G("fontSize")||1.05,showFeedIcon:G("showFeedIcon")||!0,collapsed:window.innerWidth<=992,activeContent:null,setUnreadTotal:n=>t(r=>({unreadTotal:n(r.unreadTotal)})),setUnreadToday:n=>t(r=>({unreadToday:n(r.unreadToday)})),setStarredCount:n=>t(r=>({starredCount:n(r.starredCount)})),setReadCount:n=>t(r=>({readCount:n(r.readCount)})),setActiveContent:n=>{t({activeContent:n})},initData:async()=>{t({loading:!0});const[n,r,o,i,l,h]=await Promise.all([qe(),Ye(),gs(),Je(),Xe(),pe(0,"unread")]);if(n&&o&&r&&i&&l&&h){const u=o.data.unreads,y=Object.values(u).reduce((m,f)=>m+f,0);t({unreadTotal:y});const a=n.data.map(m=>({...m,unreadCount:u[m.id]||0}));t({feeds:a.sort((m,f)=>m.title.localeCompare(f.title,"en"))});const g=r.data.map(m=>{let f=0,v=0;for(const F of a)F.category.id===m.id&&(f+=F.unreadCount,v+=1);return{...m,unreadCount:f,feed:v}});t({groups:g.sort((m,f)=>m.title.localeCompare(f.title,"en"))}),t({readCount:i.data.total}),t({starredCount:l.data.total}),t({unreadToday:h.data.total}),t({loading:!1})}},updateFeedUnreadCount:(n,r)=>{t(o=>({feeds:Ee(o.feeds,n,r)}))},updateGroupUnreadCount:(n,r)=>{t(o=>({groups:Ee(o.groups,n,r)}))},toggleTheme:()=>{const n=s().theme==="dark"?"light":"dark";t({theme:n}),X("theme",n),n==="dark"?(document.body.setAttribute("arco-theme","dark"),document.body.style.colorScheme="dark"):(document.body.removeAttribute("arco-theme"),document.body.style.colorScheme="light"),ce(G("themeColor")||"Blue")},toggleLayout:()=>{const n=s().layout==="large"?"small":"large";t({layout:n}),X("layout",n)},setFontSize:n=>{t({fontSize:n}),X("fontSize",n)},setShowFeedIcon:n=>{t({showFeedIcon:n}),X("showFeedIcon",n)},setVisible:(n,r)=>{t(o=>({visible:{...o.visible,[n]:r}}))},setCollapsed:n=>{t({collapsed:n})}})),Ts=()=>{const t=de(),s=p(h=>h.setVisible),n=p(h=>h.theme),r=p(h=>h.toggleTheme),o=p(h=>h.collapsed),i=p(h=>h.setCollapsed),l=()=>{localStorage.clear(),document.body.removeAttribute("arco-theme"),ce("Blue"),t("/login"),I.success("logout")};return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",style:{marginLeft:"10px",display:"flex",alignItems:"center"},children:e.jsx(N,{shape:"circle",size:"small",className:"trigger",style:{marginRight:"5px",display:"none"},onClick:()=>i(!o),children:e.jsx(vt,{})})}),e.jsx("div",{className:"button-group",style:{marginRight:"10px"},children:e.jsxs(fe,{size:16,children:[e.jsx(z,{content:"Add feed",mini:!0,children:e.jsx(N,{shape:"circle",size:"small",type:"primary",icon:e.jsx(Le,{}),onClick:()=>s("addFeed",!0)})}),e.jsx(N,{shape:"circle",size:"small",icon:e.jsx(wt,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(N,{shape:"circle",size:"small",icon:n==="dark"?e.jsx(St,{}):e.jsx(kt,{}),onClick:r}),e.jsx(Ft,{droplist:e.jsxs(Z,{children:[e.jsxs(Z.Item,{onClick:()=>s("settings",!0),children:[e.jsx(Tt,{style:{marginRight:8,fontSize:16,transform:"translateY(1px)"}}),"Settings"]},"0"),e.jsxs(Z.Item,{onClick:l,children:[e.jsx(It,{style:{marginRight:8,fontSize:16,transform:"translateY(1px)"}}),"Logout"]},"1")]}),trigger:"click",position:"br",children:e.jsx(Ne,{size:28,style:{cursor:"pointer"},children:e.jsx(Me,{})})})]})})]})},Is="/assets/dark-E0XitTFg.png",Es="/assets/light-CsqESGYr.png",As=()=>{const t=p(a=>a.theme),s=p(a=>a.toggleTheme),n=p(a=>a.toggleLayout),r=p(a=>a.layout),o=p(a=>a.fontSize),i=p(a=>a.setFontSize),l=p(a=>a.showFeedIcon),h=p(a=>a.setShowFeedIcon),[u,y]=d.useState(G("themeColor")||"Blue");return e.jsxs(e.Fragment,{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Theme"}),e.jsx(b.Text,{type:"secondary",children:"Customize your UI theme"}),e.jsx("div",{children:e.jsx(ie.Group,{name:"card-radio-group",style:{marginTop:"16px"},defaultValue:t,onChange:()=>s(),children:["light","dark"].map(a=>e.jsx(ie,{value:a,children:({checked:g})=>e.jsx("div",{className:`custom-radio-card ${g?"custom-radio-card-checked":""}`,children:e.jsx("img",{className:"theme-preview",src:a==="light"?Es:Is,alt:a})})},a))})}),e.jsx(W,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Accent color"}),e.jsx(b.Text,{type:"secondary",children:"Choose your accent color"})]}),e.jsx("div",{style:{display:"flex"},children:Qe.map(a=>e.jsx(z,{content:a.name,children:e.jsx("button",{type:"button",style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:Ce(a.name),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:a.name===u?`1px solid ${Ce(a.name)}`:"none"},onClick:()=>{y(a.name),X("themeColor",a.name),ce(a.name)},onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(y(a.name),X("themeColor",a.name),ce(a.name))}})},a.name))})]}),e.jsx(W,{}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Compact article list"}),e.jsx(b.Text,{type:"secondary",children:"Use small thumbnail in article list"})]}),e.jsx("div",{children:e.jsx(me,{checked:r==="small",onChange:()=>n()})})]}),e.jsx(W,{}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Show feed icon"}),e.jsx(b.Text,{type:"secondary",children:"Show feed icon in feed list and article list"})]}),e.jsx("div",{children:e.jsx(me,{checked:l,onChange:()=>h(!l)})})]}),e.jsx(W,{}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Font size"}),e.jsx(b.Text,{type:"secondary",children:"Adjust article text size"})]}),e.jsx("div",{children:e.jsxs(fe,{children:[e.jsx(b.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(Et,{value:o,showTicks:!0,min:.75,max:1.25,step:.05,formatTooltip:a=>`${a}rem`,onChange:i,style:{width:200}}),e.jsx(b.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]})]})},Q=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),Ze=(t,s,n,r)=>s==="0"?n==="all"?t.filter(o=>Q(o.title,r)):t.filter(o=>Q(o.title,r)&&o.status===n):n==="all"?t.filter(o=>Q(o.content,r)):t.filter(o=>Q(o.content,r)&&o.status===n),Ae=t=>t.slice().sort((s,n)=>s.parsing_error_count>0&&n.parsing_error_count===0?-1:s.parsing_error_count===0&&n.parsing_error_count>0?1:0),Rs=({feeds:t,groups:s,loading:n,setFeeds:r,setShowFeeds:o,showFeeds:i})=>{const l=p(c=>c.initData),[h,u]=d.useState(!1),[y,a]=d.useState(!1),[g]=_.useForm(),[m,f]=d.useState({}),[v,F]=d.useState(window.innerWidth);let E=Ae(i);const U=E.map(c=>({key:c.id,title:c.title,feed_url:c.feed_url,category:c.category,checked_at:c.checked_at,parsing_error_count:c.parsing_error_count,feed:c}));d.useEffect(()=>{const c=()=>F(window.innerWidth);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]);const S=c=>{f(c.feed),u(!0),g.setFieldsValue({url:c.feed.feed_url,title:c.feed.title,group:c.feed.category.id,crawler:c.feed.crawler})},x=async c=>{vs(c.feed.id).then(()=>{I.success("Refreshed"),c.feed.parsing_error_count=0,l()}).catch(()=>{I.error("Failed to refresh"),c.feed.parsing_error_count++}).finally(()=>{r(t),E=Ae(E),o(E)})},A=async c=>{ws(c.feed.id).then(()=>{I.success("Unfollowed"),r(t.filter(k=>k.id!==c.feed.id)),o(E.filter(k=>k.id!==c.feed.id)),l()})},T=v<=700,j=[{title:"Title",dataIndex:"title",sorter:(c,k)=>c.title.localeCompare(k.title,"en"),render:(c,k)=>{const B=k.parsing_error_count>0?`⚠️ ${c}`:c,O=k.parsing_error_count>0?`${c} ⚠️ Parsing error count: ${k.parsing_error_count}`:c;return e.jsx(b.Ellipsis,{expandable:!1,children:e.jsx(z,{mini:!0,content:O,position:"left",children:B})})}},!T&&{title:"Url",dataIndex:"feed_url",sorter:(c,k)=>c.feed_url.localeCompare(k.feed_url,"en"),render:c=>e.jsx(b.Ellipsis,{expandable:!1,children:e.jsx(z,{mini:!0,content:c,position:"left",children:c})})},{title:"Group",dataIndex:"category.title",sorter:(c,k)=>c.category.title.localeCompare(k.category.title,"en"),render:c=>e.jsx(le,{children:c})},!T&&{title:"Checked at",dataIndex:"checked_at",sorter:(c,k)=>c.checked_at.localeCompare(k.checked_at,"en"),render:c=>e.jsx(b.Ellipsis,{expandable:!1,showTooltip:!0,children:ve(c)})},{title:"Actions",dataIndex:"op",fixed:"right",width:100,render:(c,k)=>e.jsxs(fe,{children:[e.jsx("button",{"aria-label":"Edit this feed",className:"list-item-action",onClick:()=>S(k),type:"button",children:e.jsx(At,{})}),e.jsx("button",{"aria-label":"Refresh this feed",className:"list-item-action",onClick:()=>x(k),type:"button",children:e.jsx(Rt,{})}),e.jsx(Ue,{position:"left",focusLocka:!0,title:"Unfollow？",onOk:async()=>{await A(k)},children:e.jsx("span",{className:"list-item-action",children:e.jsx(Lt,{})})})]})}].filter(Boolean),w=async(c,k,B,O,L)=>{a(!0),bs(c,k,B,O,L).then(ue=>{r(t.map(H=>H.id===c?ue.data:H)),o(E.map(H=>H.id===c?ue.data:H)),I.success("Feed updated successfully"),u(!1),l()}).catch(()=>{I.error("Failed to update feed")}),a(!1),g.resetFields()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx($.Search,{searchButton:!0,placeholder:"Search feed title or url",onChange:c=>o(E.filter(k=>Q(k.title,c)||Q(k.feed_url,c))),style:{width:300,marginBottom:"24px"}})}),e.jsx(_e,{columns:j,data:U,loading:n,pagePosition:"bottomCenter",scroll:{x:!0},size:"small",style:{width:"100%"},borderCell:!0}),m&&e.jsx(ge,{title:"Edit Feed",visible:h,unmountOnExit:!0,onOk:g.submit,style:{width:"400px"},confirmLoading:y,onCancel:()=>{u(!1),g.resetFields()},children:e.jsxs(_,{form:g,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:c=>{c.url.trim()?w(m.id,c.url,c.title,c.group,c.crawler):I.error("Feed URL cannot be empty")},children:[e.jsx(_.Item,{label:"Feed URL",field:"url",rules:[{required:!0}],children:e.jsx($,{placeholder:"Please input feed URL"})}),e.jsx(_.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx($,{placeholder:"Please input feed title"})}),e.jsx(_.Item,{label:"Group",required:!0,field:"group",rules:[{required:!0}],children:e.jsx(q,{placeholder:"Please select",children:s.map(c=>e.jsx(q.Option,{value:c.id,children:c.title},c.id))})}),e.jsx(_.Item,{label:"Fetch original content",field:"crawler",tooltip:e.jsx("div",{children:"Only affects newly retrieved articles"}),style:{marginBottom:0},triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(me,{})})]})})]})},Ls=({groups:t,loading:s,setGroups:n})=>{const r=p(S=>S.initData),[o,i]=d.useState(!1),[l,h]=d.useState(""),[u,y]=d.useState(!1),[a,g]=d.useState(!1),[m]=_.useForm(),[f,v]=d.useState({}),F=async()=>{l&&js(l).then(S=>{n(x=>[...x,{...S.data,feedCount:0}]),h(""),I.success("Group added successfully"),r()}).catch(()=>{I.error("Failed to add group")}),h(""),i(!1)},E=async(S,x)=>{g(!0),Cs(S,x).then(A=>{n(t.map(T=>T.id===S?A.data:T)),I.success("Group updated successfully"),y(!1),r()}).catch(()=>{I.error("Failed to update group")}),g(!1),m.resetFields()},U=async S=>{ys(S).then(x=>{x.status===204?(n(t.filter(A=>A.id!==S)),I.success("Group deleted successfully"),r()):I.error("Failed to delete group")}).catch(()=>{I.error("Failed to delete group")})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs(ee,{loading:s,animation:!0,text:{rows:3},children:[t.map(S=>e.jsx(le,{size:"medium",closable:S.feedCount===0,onClick:()=>{v(S),y(!0),m.setFieldsValue({title:S.title})},onClose:async x=>{x.stopPropagation(),await U(S.id)},style:{marginRight:"10px",marginBottom:"10px",cursor:"pointer"},children:S.title},S.id)),o?e.jsx($,{autoFocus:!0,size:"small",value:l,style:{width:84},onPressEnter:F,onBlur:F,onChange:h}):e.jsx(le,{icon:e.jsx(Le,{}),style:{width:84,backgroundColor:"var(--color-fill-2)",border:"1px dashed var(--color-fill-3)",cursor:"pointer"},size:"medium",className:"add-group",tabIndex:0,onClick:()=>i(!0),children:"Add"})]})}),f&&e.jsx(ge,{title:"Edit Group",visible:u,unmountOnExit:!0,style:{width:"400px"},onOk:m.submit,confirmLoading:a,onCancel:()=>{y(!1),m.resetFields()},children:e.jsx(_,{form:m,layout:"vertical",onSubmit:S=>E(f.id,S.title),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:e.jsx(_.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx($,{placeholder:"Please input group title"})})})})]})},Ns=[{title:"Key",dataIndex:"keyName",render:t=>e.jsx(le,{children:t})},{title:"Function",dataIndex:"description"}],Ms=[{key:"1",keyName:"Esc",description:"Dismiss article"},{key:"2",keyName:"←",description:"Previous article"},{key:"3",keyName:"→",description:"Next article"},{key:"4",keyName:"B",description:"Open link externally"},{key:"5",keyName:"D",description:"Fetch original article"},{key:"6",keyName:"M",description:"Mark as read / unread"},{key:"7",keyName:"S",description:"Star / Unstar"}],_s=()=>e.jsx(_e,{columns:Ns,data:Ms,pagination:!1,size:"small"}),Us=()=>{const[t,s]=d.useState([]),[n,r]=d.useState([]),[o,i]=d.useState([]),[l,h]=d.useState(!1),u=async()=>{h(!0);const y=await qe(),a=await Ye();if(y&&a){const g=y.data,m=a.data.map(v=>({...v,feedCount:g.filter(F=>F.category.id===v.id).length})),f=g.sort((v,F)=>v.title.localeCompare(F.title,"en"));s(f),r(m.sort((v,F)=>v.title.localeCompare(F.title,"en"))),i(f),h(!1)}};return d.useEffect(()=>{u()},[]),e.jsxs(oe,{defaultActiveTab:"1",tabPosition:"top",children:[e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Nt,{style:{marginRight:6}}),"Feeds"]}),children:e.jsx(Rs,{feeds:t,groups:n,loading:l,setFeeds:s,setShowFeeds:i,showFeeds:o})},"1"),e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Mt,{style:{marginRight:6}}),"Groups"]}),children:e.jsx(Ls,{groups:n,loading:l,setGroups:r})},"2"),e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(_t,{style:{marginRight:6}}),"Appearance"]}),children:e.jsx(As,{})},"3"),e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Ut,{style:{marginRight:6}}),"Hotkeys"]}),children:e.jsx(_s,{})},"4")]})},$s=({activeContent:t,setActiveContent:s,setVisible:n,visible:r})=>{const[o,i]=d.useState("720px"),[l,h]=d.useState("10%");return d.useEffect(()=>{const u=()=>{const y=window.innerWidth<=700?"100%":"720px",a=window.innerWidth<=700?"5%":"10%";i(y),h(a)};return window.addEventListener("resize",u),u(),()=>{window.removeEventListener("resize",u)}},[]),e.jsx(ge,{visible:r.settings,alignCenter:!1,title:"Settings",footer:null,unmountOnExit:!0,style:{width:o,top:l},onFocus:()=>{t&&s(null)},onCancel:()=>n("settings",!1),autoFocus:!1,focusLock:!0,children:e.jsx(Us,{})})},Ps=({activeContent:t,setActiveContent:s,setVisible:n,visible:r})=>{const o=p(a=>a.initData),i=p(a=>a.groups),[l,h]=d.useState(!1),[u]=_.useForm(),y=async(a,g,m)=>{h(!0),Ss(a,g,m).then(()=>{o(),I.success("Added a feed successfully"),n("addFeed",!1)}).catch(()=>{I.error("Failed to add a feed")}),h(!1),u.resetFields()};return e.jsx(ge,{title:"Add Feed",visible:r.addFeed,unmountOnExit:!0,style:{width:"400px"},onFocus:()=>{t&&s(null)},onOk:u.submit,confirmLoading:l,onCancel:()=>{n("addFeed",!1),u.resetFields()},children:e.jsxs(_,{form:u,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:a=>{a.url.trim()?y(a.url.trim(),a.group,a.crawler):I.error("Feed URL cannot be empty")},children:[e.jsx(_.Item,{label:"Feed URL",field:"url",rules:[{required:!0}],children:e.jsx($,{placeholder:"Please input feed URL"})}),e.jsx(_.Item,{label:"Group",required:!0,field:"group",rules:[{required:!0}],children:e.jsx(q,{placeholder:"Please select",children:i.map(a=>e.jsx(q.Option,{value:a.id,children:a.title},a.id))})}),e.jsx(_.Item,{label:"Fetch original content",initialValue:!1,field:"crawler",style:{marginBottom:0},triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(me,{})})]})})},Ds=()=>{const t=p(l=>l.visible),s=p(l=>l.setVisible),n=p(l=>l.activeContent),r=p(l=>l.setActiveContent),[o,i]=d.useState(0);return d.useEffect(()=>{const l=()=>{const h=document.querySelector(".entry-panel"),u=h?h.offsetHeight:49,y=window.innerHeight;i(y-u)};return window.addEventListener("resize",l),l(),()=>window.removeEventListener("resize",l)},[]),e.jsxs("div",{className:"main",style:{height:`${o}px`},children:[e.jsx($t,{}),e.jsx($s,{activeContent:n,setActiveContent:r,setVisible:s,visible:t}),e.jsx(Ps,{activeContent:n,setActiveContent:r,setVisible:s,visible:t})]})},et=t=>{const s=new URL(t);return`${s.protocol}//${s.hostname}`},ae=Z.Item,{Sider:zs}=Ot,Ks=({group:t,isOpen:s})=>e.jsxs("div",{className:"group-title",children:[e.jsxs(b.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:t.unreadCount?"80%":"100%"},children:[s?e.jsx(Vt,{}):e.jsx(Gt,{}),t.title]}),t.unreadCount>0&&e.jsx(b.Ellipsis,{className:"unread-count",expandable:!1,showTooltip:!0,children:t.unreadCount})]}),Os=()=>{const t=Pt(),s=de(),n=p(x=>x.collapsed),r=p(x=>x.feeds),o=p(x=>x.groups),i=p(x=>x.loading),l=p(x=>x.unreadTotal),h=p(x=>x.unreadToday),u=p(x=>x.starredCount),y=p(x=>x.readCount),a=p(x=>x.showFeedIcon),g=p(x=>x.setCollapsed),[m,f]=d.useState([]),[v,F]=d.useState([]),E=t.pathname,U=(x,A)=>{F(A)},S=r.reduce((x,A)=>{$e(A.site_url)||(A.site_url=et(A.feed_url));const{id:T}=A.category;return x[T]=x[T]||[],x[T].push(A),x},{});return d.useEffect(()=>{f([E]),n||window.innerWidth<=992&&g(!0)},[E]),d.useEffect(()=>{i||F([])},[i]),e.jsx(zs,{className:"sidebar",trigger:null,width:240,collapsedWidth:0,breakpoint:"lg",onCollapse:g,collapsed:n,collapsible:!0,style:{height:"100%",borderRight:n?"none":"1px solid var(--color-border-2)",position:"fixed",top:0,zIndex:999},children:e.jsxs(Z,{autoScrollIntoView:!0,collapse:n,defaultSelectedKeys:[E],hasCollapseButton:!0,onClickSubMenu:U,onCollapseChange:()=>g(!n),selectedKeys:m,style:{width:"240px",height:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0 28px 0 10px",height:"48px",marginTop:"-4px",visibility:n?"hidden":"visible"},children:[e.jsx(Ne,{size:32,style:{marginRight:"10px",backgroundColor:"var(--color-text-1)"},children:e.jsx(Pe,{style:{color:"var(--color-bg-1)"}})}),e.jsx(b.Title,{heading:6,style:{margin:"0"},children:"ReactFlux"})]}),e.jsx(W,{style:{marginTop:0,marginBottom:"4px"}}),e.jsx(b.Title,{heading:6,style:{fontStyle:"italic",color:"var(--color-text-3)"},children:"Articles"}),e.jsx(ee,{loading:i,animation:!0,text:{rows:3}}),i?null:e.jsxs("div",{children:[e.jsx(ae,{onClick:()=>s("/"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(Dt,{}),"All"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:l||""})]})},"/"),e.jsx(ae,{onClick:()=>s("/today"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(zt,{}),"Today"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:h||""})]})},"/today"),e.jsx(ae,{onClick:()=>s("/starred"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(be,{}),"Starred"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:u||""})]})},"/starred"),e.jsx(ae,{onClick:()=>s("/history"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(Kt,{}),"History"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:y||""})]})},"/history")]}),e.jsx(b.Title,{heading:6,style:{fontStyle:"italic",color:"var(--color-text-3)"},children:"Feeds"}),e.jsx(ee,{loading:i,animation:!0,text:{rows:6}}),i?null:o.map(x=>{var A;return e.jsx(Z.SubMenu,{selectable:!0,title:e.jsx(Ks,{group:x,isOpen:v.includes(`/group/${x.id}`)}),onClick:T=>{f([`/group/${x.id}`]),!(T.target.tagName==="svg"||T.target.tagName==="path")&&E!==`/group/${x.id}`&&s(`/group/${x.id}`)},children:(A=S[x.id])==null?void 0:A.map(T=>e.jsx(ae,{onClick:j=>{j.stopPropagation(),f([`/group/${x.id}`]),s(`/feed/${T.id}`)},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(b.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:T.unreadCount!==0?"80%":"100%"},children:[a&&e.jsx("img",{src:`https://icons.duckduckgo.com/ip3/${new URL(T.site_url).hostname}.ico`,alt:"Icon",style:{marginRight:"8px",width:"16px",height:"16px"}}),T.title]}),T.unreadCount!==0&&e.jsx(b.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:"20%",color:"var(--color-text-4)",display:"flex",justifyContent:"flex-end"},children:T.unreadCount})]})},`/feed/${T.id}`))},`/group/${x.id}`)})]})})},Vs=()=>{const t=p(r=>r.initData),s=p(r=>r.theme),n=()=>{s==="dark"?(document.body.setAttribute("arco-theme","dark"),document.body.style.colorScheme="dark"):(document.body.removeAttribute("arco-theme"),document.body.style.colorScheme="light"),ce(G("themeColor")||"Blue")};return d.useEffect(()=>{t(),n()},[]),e.jsxs("div",{className:"app",style:{display:"flex",backgroundColor:"var(--color-bg-1)"},children:[e.jsx(Ts,{}),e.jsx(Os,{}),e.jsx(Ds,{})]})},K=d.createContext(null),te=({children:t})=>{const[s,n]=d.useState(0),[r,o]=d.useState(0),[i,l]=d.useState(0),[h,u]=d.useState(!1),[y,a]=d.useState(!1),[g,m]=d.useState([]),[f,v]=d.useState([]),[F,E]=d.useState("all"),[U,S]=d.useState("0"),[x,A]=d.useState(""),[T,j]=d.useState(!0),w=d.useMemo(()=>({entries:g,filteredEntries:f,filterStatus:F,filterString:x,filterType:U,loading:T,loadMoreUnreadVisible:y,loadMoreVisible:h,offset:i,setEntries:m,setFilteredEntries:v,setFilterStatus:E,setFilterString:A,setFilterType:S,setLoading:j,setLoadMoreUnreadVisible:a,setLoadMoreVisible:u,setOffset:l,setTotal:n,setUnreadCount:o,total:s,unreadCount:r}),[g,f,F,x,U,T,y,h,i,s,r]);return e.jsx(K.Provider,{value:w,children:t})},we=()=>{const t=p(j=>j.setUnreadTotal),s=p(j=>j.setUnreadToday),n=p(j=>j.setReadCount),r=p(j=>j.setStarredCount),o=p(j=>j.activeContent),i=p(j=>j.setActiveContent),l=p(j=>j.updateFeedUnreadCount),h=p(j=>j.updateGroupUnreadCount),{entries:u,filteredEntries:y,setEntries:a,setFilteredEntries:g,setUnreadCount:m}=d.useContext(K),f=(j,w,c)=>j.map(k=>k.id===w.id?c(k):k),v=(j,w,c)=>{i({...j,...w}),a(f(u,j,c)),g(f(y,j,c))},F=(j,w)=>{const{feed:c}=j,k=c.id,B=c.category.id,O=us(j.published_at);l(k,w),h(B,w),w==="read"?(t(L=>Math.max(0,L-1)),m(L=>Math.max(0,L-1)),n(L=>L+1),O&&s(L=>Math.max(0,L-1))):(t(L=>L+1),m(L=>L+1),n(L=>Math.max(0,L-1)),O&&s(L=>L+1)),v(j,{status:w},L=>({...L,status:w}))},E=(j,w)=>{w?(r(c=>c+1),Bt({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):r(c=>Math.max(0,c-1)),v(j,{starred:w},c=>({...c,starred:w}))},U=async()=>{const j=o.status,w=j==="read"?"unread":"read";F(o,w),We(o.id,w).catch(()=>{I.error(`Failed to mark entry as ${w}, please try again later`),F(o,j)})},S=async()=>{const{id:j}=o,w=!o.starred;E(o,w),ms(j).catch(()=>{I.error(`Failed to ${w?"star":"unstar"} entry, please try again later`),E(o,!w)})};return{handleEntryStatusUpdate:F,handleFetchContent:async()=>{xs(o.id).then(j=>{I.success("Fetched content successfully"),i({...o,content:j.data.content})}).catch(()=>{I.error("Failed to fetch content, please try again later")})},toggleEntryStarred:()=>{S()},toggleEntryStatus:()=>{U()}}},Se=()=>{const{filteredEntries:t}=d.useContext(K),s=p(a=>a.activeContent),n=p(a=>a.setActiveContent);return{handleEscapeKey:a=>{s&&(n(null),a.current&&(a.current.setAttribute("tabIndex","-1"),a.current.focus()))},handleLeftKey:a=>{const g=t.findIndex(m=>m.id===(s==null?void 0:s.id));if(g>0){const m=t[g-1];a(m);const f=document.querySelector(".card-custom-selected-style");f&&f.scrollIntoView({behavior:"smooth",block:"end"})}},handleRightKey:a=>{const g=t.findIndex(m=>m.id===(s==null?void 0:s.id));if(g<t.length-1){const m=t[g+1];a(m);const f=document.querySelector(".card-custom-selected-style");f&&f.scrollIntoView({behavior:"smooth",block:"start"})}},handleBKey:()=>{s&&window.open(s.url,"_blank")},handleDKey:a=>{s&&a()},handleMKey:a=>{s&&a()},handleSKey:a=>{s&&a()}}},tt=()=>{const{entries:t,filterStatus:s,filterString:n,filterType:r,offset:o,setEntries:i,setFilteredEntries:l,setLoadMoreUnreadVisible:h,setLoadMoreVisible:u,setOffset:y,total:a,unreadCount:g}=d.useContext(K),[m,f]=d.useState(!1),v=E=>{const x=new DOMParser().parseFromString(E.content,"text/html").querySelector("img");return x&&(E.imgSrc=x.getAttribute("src")),E};return{getFirstImage:v,handleLoadMore:async E=>{var U;f(!0);try{const S=await E(o+100);if((U=S==null?void 0:S.data)!=null&&U.entries){y(w=>w+100);const x=S.data.entries.map(v),A=[...new Map([...t,...x].map(w=>[w.id,w])).values()];i(A);const T=s==="all"?A:A.filter(w=>w.status==="unread"),j=n?Ze(T,r,s,n):T;l(j),u(A.length<a),h(T.length<g&&s==="unread")}}catch(S){console.error("Error fetching more articles:",S)}f(!1)},loadingMore:m}},Gs=({handleEntryClick:t})=>{const s=p(y=>y.activeContent),{handleFetchContent:n,toggleEntryStarred:r,toggleEntryStatus:o}=we(),{handleLeftKey:i,handleRightKey:l}=Se();if(!s)return null;const h=s.status==="unread",u=s.starred;return e.jsx("div",{className:"action-buttons",style:{position:"fixed",bottom:"20px",right:"10px",borderRadius:"50%",boxShadow:"0 4px 10px rgba(var(--primary-6), 0.4)"},children:e.jsxs(fe,{size:0,direction:"vertical",children:[e.jsx(z,{mini:!0,position:"left",content:h?"Mark as Read":"Mark as Unread",children:e.jsx(N,{type:"primary",size:"mini",style:{borderBottom:"1px solid rgb(var(--primary-5))",borderRadius:"50% 50% 0 0"},onClick:o,icon:h?e.jsx(De,{}):e.jsx(ze,{})})}),e.jsx(z,{mini:!0,position:"left",content:u?"Unstar":"Star",children:e.jsx(N,{type:"primary",size:"mini",style:{borderRadius:"0"},onClick:r,icon:u?e.jsx(ye,{style:{color:"#ffcd00"}}):e.jsx(be,{})})}),e.jsx(z,{mini:!0,position:"left",content:"Fetch original article",children:e.jsx(N,{type:"primary",size:"mini",style:{borderTop:"1px solid rgb(var(--primary-5))",borderRadius:"0"},onClick:n,icon:e.jsx(Ke,{})})}),e.jsx(z,{mini:!0,position:"left",content:"Previous Article",children:e.jsx(N,{type:"primary",size:"mini",style:{borderTop:"1px solid rgb(var(--primary-5))",borderRadius:"0"},onClick:()=>i(t),icon:e.jsx(Oe,{})})}),e.jsx(z,{mini:!0,position:"left",content:"Next Article",children:e.jsx(N,{type:"primary",size:"mini",style:{borderTop:"1px solid rgb(var(--primary-5))",borderRadius:"0 0 50% 50%"},onClick:()=>l(t),icon:e.jsx(Ve,{})})})]})})},Bs=({handleEntryClick:t})=>{const s=p(a=>a.activeContent),{handleFetchContent:n,toggleEntryStarred:r,toggleEntryStatus:o}=we(),{handleLeftKey:i,handleRightKey:l,handleEscapeKey:h}=Se();if(!s)return null;const u=s.status==="unread",y=s.starred;return e.jsxs(N.Group,{className:"action-buttons-mobile",style:{display:"none",justifyContent:"center",position:"fixed",bottom:"40px",left:"50%",transform:"translateX(-50%)",borderRadius:"50%",boxShadow:"0 4px 10px rgba(var(--primary-6), 0.4)"},children:[e.jsx(N,{type:"primary",shape:"round",onClick:()=>h(t),icon:e.jsx(Ht,{})}),e.jsx(N,{type:"primary",onClick:()=>o(),icon:u?e.jsx(De,{}):e.jsx(ze,{})}),e.jsx(N,{type:"primary",onClick:()=>r(),icon:y?e.jsx(ye,{style:{color:"#ffcd00"}}):e.jsx(be,{})}),e.jsx(N,{type:"primary",onClick:()=>n(),icon:e.jsx(Ke,{})}),e.jsx(N,{type:"primary",onClick:()=>i(t),icon:e.jsx(Oe,{})}),e.jsx(N,{type:"primary",shape:"round",onClick:()=>l(t),icon:e.jsx(Ve,{})})]})},Hs=({url:t,text:s})=>{const[n,r]=d.useState(!1);return e.jsx(Jt,{to:t,style:{color:"inherit",textDecoration:n?"underline":"none"},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:s})},Ws={replace:t=>{var r,o;const s=t.name==="a"&&((o=(r=t.children)==null?void 0:r[0])==null?void 0:o.name)==="img",n=t.name==="img";if(s||n){const i=s?t.children[0]:t,{src:l,alt:h}=i.attribs;return e.jsx(Xt,{src:l,children:e.jsx("img",{src:l,alt:h})})}}},qs=d.forwardRef((t,s)=>{const n=de(),r=p(u=>u.activeContent),o=p(u=>u.fontSize);if(!r)return e.jsxs("div",{ref:s,className:"content-empty",style:{display:"flex",flexDirection:"column",backgroundColor:"var(--color-fill-1)",color:"var(--color-text-3)",alignItems:"center",justifyContent:"center",flex:"1",padding:"40px 16px"},children:[e.jsx(Wt,{style:{fontSize:"64px"}}),e.jsx(b.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const i=qt(r.content,Ws),l=r.feed.category.id,h=r.feed.category.title;return e.jsxs("div",{ref:s,className:"article-content",style:{padding:"40px 5%",flex:"1",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{className:"article-title",style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsx(b.Title,{heading:3,style:{margin:0},children:e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",children:r.title})}),e.jsx(b.Text,{style:{color:"var(--color-text-3)",fontSize:"0.75 rem"},children:e.jsx(Hs,{url:`/feed/${r.feed.id}`,text:r.feed.title})}),e.jsx(b.Text,{style:{color:"var(--color-text-3)",fontSize:"0.75 rem"},children:` - ${r.author}`}),e.jsx(b.Text,{children:e.jsx(le,{size:"small",onClick:()=>{n(`/group/${l}`)},style:{marginLeft:"10px",cursor:"pointer"},children:h})}),e.jsx("br",{}),e.jsxs(b.Text,{style:{color:"var(--color-text-3)",fontSize:"0.75 rem"},children:[Y(r.published_at).format("MMMM D, YYYY")," AT"," ",Y(r.published_at).format("hh:mm")]}),e.jsx(W,{})]}),e.jsx("div",{className:"article-body",style:{fontSize:`${o}rem`,maxWidth:"600px",margin:"0 auto",overflowWrap:"break-word"},children:e.jsx(Yt,{maskOpacity:.7,children:i})},r.id)]})}),st=({src:t,alt:s,width:n,height:r,status:o,borderRadius:i})=>{const[l,h]=d.useState(!1),u=d.useRef(null);return d.useEffect(()=>{const y=new IntersectionObserver(g=>{for(const m of g)if(m.isIntersecting){const f=new Image;f.onload=()=>h(!0),f.src=t,u.current&&y.unobserve(u.current)}}),a=u.current;return a&&y.observe(a),()=>y.disconnect()},[t]),e.jsxs("div",{className:"image-container",ref:u,children:[!l&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(ee,{text:{rows:0},image:{style:{width:n,height:r,margin:"0",borderRadius:i}},animation:!0})}),l&&e.jsx("img",{className:o!=="unread"?"read":"",src:t,alt:s,style:{width:n,height:r,objectFit:"cover",borderRadius:i}})]})},Ys=({url:t})=>e.jsx("img",{className:"feed-icon",src:`https://icons.duckduckgo.com/ip3/${new URL(t).hostname}.ico`,alt:"Icon"}),Js=({entry:t,showFeedIcon:s})=>e.jsxs("div",{children:[e.jsx(b.Text,{className:t.status==="unread"?"title-unread":"title-read",children:t.title}),e.jsxs(b.Text,{className:"article-info",children:[e.jsx("br",{}),s&&e.jsx(Ys,{url:t.feed.site_url}),t.feed.title,e.jsx("br",{}),ve(t.published_at)]}),t.starred&&e.jsx(ye,{className:"icon-starred"})]}),Xs=({entry:t,handleEntryClick:s})=>{const n=p(h=>h.activeContent),r=p(h=>h.showFeedIcon),o=n&&t.id===n.id,i=()=>s(t),l=t.imgSrc?e.jsx("div",{className:"cover-image",children:e.jsx(st,{width:"100%",height:"160px",alt:t.id,src:t.imgSrc,status:t.status})}):null;return e.jsx("div",{className:"article-card",children:e.jsx(J,{className:Ge("card-custom-hover-style",{"card-custom-selected-style":o}),hoverable:!0,"data-entry-id":t.id,style:{width:"100%",cursor:"pointer"},onClick:i,cover:l,children:e.jsx(J.Meta,{description:e.jsx(Js,{entry:t,showFeedIcon:r})})})},t.id)},Qs=({url:t})=>e.jsx("img",{className:"feed-icon-mini",src:`https://icons.duckduckgo.com/ip3/${new URL(t).hostname}.ico`,alt:"Icon"}),Zs=({entry:t,showFeedIcon:s})=>e.jsxs("div",{style:{display:"flex",paddingLeft:s?"22px":"0"},children:[e.jsxs("div",{style:{marginRight:"10px",flex:1},children:[e.jsx(b.Text,{className:t.status==="unread"?"title-unread":"title-read",children:t.title}),e.jsxs(b.Text,{className:"article-info",children:[e.jsx("br",{}),s&&e.jsx(Qs,{url:t.feed.site_url}),t.feed.title,e.jsx("br",{}),ve(t.published_at)]}),t.starred&&e.jsx(ye,{className:"icon-starred"})]}),t.imgSrc&&e.jsx("div",{className:"thumbnail",children:e.jsx(st,{width:"100px",height:"100px",alt:t.id,src:t.imgSrc,status:t.status,borderRadius:"4px"})})]}),en=({entry:t,handleEntryClick:s})=>{const n=p(l=>l.activeContent),r=p(l=>l.showFeedIcon),o=n&&t.id===n.id,i=()=>s(t);return e.jsx("div",{className:"article-card",children:e.jsx(J,{className:Ge("card-custom-hover-style",{"card-custom-selected-style":o}),hoverable:!0,"data-entry-id":t.id,style:{width:"100%",cursor:"pointer"},onClick:i,cover:null,children:e.jsx(J.Meta,{description:e.jsx(Zs,{entry:t,showFeedIcon:r})})})},t.id)},tn=({loading:t})=>{const s=p(o=>o.layout),n=s==="large"?2:4,r=o=>e.jsx(J,{style:{width:"100%",marginBottom:"10px"},cover:s==="large"&&e.jsx(ee,{loading:t,animation:!0,text:{rows:0},image:{style:{width:"100%",height:160}}}),children:e.jsx(J.Meta,{description:e.jsx(ee,{loading:t,animation:!0,text:{rows:3,width:150}})})},o);return t?Array.from({length:n},(o,i)=>r(i)):null},nt=()=>{const{entries:t,filteredEntries:s,filterStatus:n,filterString:r,filterType:o,loadMoreUnreadVisible:i,setFilteredEntries:l,setFilterStatus:h,setFilterString:u,setFilterType:y,setLoadMoreUnreadVisible:a,unreadCount:g}=d.useContext(K);return d.useEffect(()=>{l([]);const f=Ze(t,o,n,r);if(l(f),n==="unread"){const v=t.filter(F=>F.status==="unread");a(v.length<g)}},[n,r,o,i]),{filteredEntries:s,handleFilter:(f,v,F)=>{y(f),h(v),u(F)},loadMoreUnreadVisible:i}},sn=()=>{const{filterStatus:t,filterString:s,filterType:n}=d.useContext(K),r=p(l=>l.activeContent),o=p(l=>l.setActiveContent),{handleFilter:i}=nt();return e.jsx($.Search,{allowClear:!0,placeholder:"Search...",value:s,addBefore:e.jsxs(q,{placeholder:"Select type",onChange:l=>{i(l,t,s)},style:{width:100},value:n,children:[e.jsx(q.Option,{value:"0",children:"Title"}),e.jsx(q.Option,{value:"1",children:"Content"})]}),onFocus:()=>r&&o(null),onChange:l=>i(n,t,l),style:{marginBottom:"10px",width:"100%"}})},nn=d.forwardRef(({loading:t,getEntries:s,handleEntryClick:n,cardsRef:r},o)=>{const{filteredEntries:i,filterStatus:l,loadMoreUnreadVisible:h,loadMoreVisible:u}=d.useContext(K),{loadingMore:y,handleLoadMore:a}=tt(),g=p(m=>m.layout);return e.jsxs("div",{className:"entry-list",ref:o,style:{overflowY:"auto",padding:"10px 10px 0 10px",width:"302px",backgroundColor:"var(--color-fill-1)",flex:"1"},children:[e.jsx(sn,{}),e.jsx(tn,{loading:t}),t?null:e.jsx("div",{ref:r,children:i.map(m=>{$e(m.feed.site_url)||(m.feed.site_url=et(m.feed.feed_url));const f=g==="small"?en:Xs;return e.jsx(f,{entry:m,handleEntryClick:n},m.id)})}),!t&&(l==="all"?u:h)&&e.jsxs(N,{onClick:()=>a(s),loading:y,long:!0,style:{margin:"10px auto",display:"block"},children:[!y&&e.jsx(Qt,{}),"Load more"]})]})}),rn=d.forwardRef(({info:t,markAllAsRead:s},n)=>{const{entries:r,filteredEntries:o,filterStatus:i,filterString:l,filterType:h,setEntries:u,setFilteredEntries:y,setUnreadCount:a}=d.useContext(K),{handleFilter:g}=nt(),m=p(v=>v.initData),f=d.useCallback(async()=>{s().then(()=>{I.success("Marked all as read successfully"),m(),u(r.map(v=>({...v,status:"read"}))),y(o.map(v=>({...v,status:"read"}))),a(0)}).catch(()=>{I.error("Failed to mark all as read")})},[r,o,m,s,u,y,a]);return t.from!=="history"?e.jsxs("div",{className:"entry-panel",style:{backgroundColor:"var(--color-bg-2)",bottom:"0",display:"flex",flexDirection:"row",padding:"8px 10px",zIndex:"2",justifyContent:"space-between",borderTop:"1px solid var(--color-border-2)"},children:[e.jsxs(ie.Group,{type:"button",name:"lang",value:i,onChange:v=>{n.current&&n.current.scrollTo(0,0),g(h,v,l)},children:[e.jsx(ie,{value:"all",children:"ALL"}),e.jsx(ie,{value:"unread",children:"UNREAD"})]}),t.from!=="starred"&&e.jsx(Ue,{focusLock:!0,title:"Mark All As Read?",onOk:f,children:e.jsx(N,{icon:e.jsx(Zt,{}),shape:"circle"})})]}):null}),se=({info:t,getEntries:s,markAllAsRead:n})=>{const r=p(C=>C.activeContent),o=p(C=>C.setActiveContent),i=p(C=>C.setReadCount),l=p(C=>C.setStarredCount),h=p(C=>C.setUnreadToday),u=p(C=>C.setUnreadTotal),y=p(C=>C.updateFeedUnreadCount),a=p(C=>C.updateGroupUnreadCount),{filteredEntries:g,filterStatus:m,loading:f,offset:v,setEntries:F,setFilteredEntries:E,setLoading:U,setLoadMoreUnreadVisible:S,setLoadMoreVisible:x,setOffset:A,setTotal:T,setUnreadCount:j,total:w,unreadCount:c}=d.useContext(K),{handleFetchContent:k,toggleEntryStarred:B,toggleEntryStatus:O,handleEntryStatusUpdate:L}=we(),{handleBKey:ue,handleDKey:H,handleEscapeKey:ot,handleLeftKey:at,handleMKey:it,handleRightKey:lt,handleSKey:ct}=Se(),{getFirstImage:dt}=tt(),[je,ke]=d.useState(!1),ne=d.useRef(null),V=d.useRef(null),Fe=d.useRef(null);d.useEffect(()=>{ke(r!==null)},[r]),d.useEffect(()=>{if(!(c===0||w===0))switch(t.from){case"all":u(()=>c);break;case"today":h(()=>c);break;case"starred":l(()=>w);break;case"history":i(()=>w);break;case"feed":{const C=Number.parseInt(t.id);y(C,c);break}case"group":{const C=Number.parseInt(t.id);a(C,c);break}}},[w,c]);const re=async C=>{ke(!1),setTimeout(()=>{o({...C,status:"read"})},200),C.status==="unread"&&(setTimeout(()=>{L(C,"read")},200),We(C.id,"read").catch(()=>{I.error("Failed to mark entry as read, please try again later"),L(C,"unread")})),V.current&&(V.current.setAttribute("tabIndex","-1"),V.current.focus(),V.current.scrollTo(0,0))};d.useEffect(()=>{const C={27:()=>ot(ne),37:()=>at(re),39:()=>lt(re),66:()=>ue(),68:()=>H(k),77:()=>it(O),83:()=>ct(B)},M=D=>{const P=C[D.keyCode];P&&P()};return je?document.addEventListener("keydown",M):document.removeEventListener("keydown",M),()=>{document.removeEventListener("keydown",M)}},[r,g,je]);const ut=async()=>{const C=await s(),M=await s(v,"unread");return{responseAll:C,responseUnread:M}},ht=C=>{const M=C.data.entries.map(dt),D=m==="all"?M:M.filter(P=>P.status==="unread");return{fetchedArticles:M,filteredArticles:D}},pt=(C,M,D,P)=>{F(C),E(M),T(D.data.total),x(C.length<D.data.total),j(P.data.total),S(M.length<P.data.total)},mt=(C,M)=>{var D,P;if((D=C==null?void 0:C.data)!=null&&D.entries&&((P=M==null?void 0:M.data)==null?void 0:P.total)>=0){const{fetchedArticles:ft,filteredArticles:gt}=ht(C);pt(ft,gt,C,M)}},xt=async()=>{U(!0);try{const{responseAll:C,responseUnread:M}=await ut();mt(C,M)}catch(C){console.error("Error fetching articles:",C)}finally{U(!1)}};return d.useEffect(()=>{xt(),o(null),ne.current&&ne.current.scrollTo(0,0),V.current&&V.current.scrollTo(0,0),A(0)},[t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",borderRight:"1px solid var(--color-border-2)"},className:"entry-col",children:[e.jsx(Te,{in:!f,timeout:200,nodeRef:Fe,classNames:"fade",children:e.jsx(nn,{cardsRef:Fe,loading:f,getEntries:s,handleEntryClick:re,ref:ne})}),e.jsx(rn,{info:t,markAllAsRead:n,ref:ne})]}),e.jsx(Te,{in:je,timeout:200,nodeRef:V,classNames:"fade",unmountOnExit:!0,children:e.jsx(qs,{ref:V})}),e.jsx(Gs,{handleEntryClick:re}),e.jsx(Bs,{handleEntryClick:re})]})},on=()=>{const t=async()=>{const s=await fs();return R.put(`/v1/users/${s.data.id}/mark-all-as-read`)};return e.jsx(te,{children:e.jsx(se,{info:{from:"all",id:""},getEntries:ks,markAllAsRead:t})})},an=()=>{const t=de(),s=es();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx("div",{children:e.jsx(ts,{status:"404",subTitle:"Whoops, that page is gone. ",extra:[e.jsx(N,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})})},ln=()=>{const{f_id:t}=Be(),s=async(r=0,o=null)=>{const i=`/v1/feeds/${t}/entries?order=published_at&direction=desc&offset=${r}`,l=o?`${i}&status=${o}`:i;return R.get(l)},n=async()=>R.put(`/v1/feeds/${t}/mark-all-as-read`);return e.jsx(te,{children:e.jsx(se,{info:{from:"feed",id:t},getEntries:s,markAllAsRead:n})})},cn=()=>{const{c_id:t}=Be(),s=async(r=0,o=null)=>{const i=`/v1/categories/${t}/entries?order=published_at&direction=desc&offset=${r}`,l=o?`${i}&status=${o}`:i;return R.get(l)},n=async()=>R.put(`/v1/categories/${t}/mark-all-as-read`);return e.jsx(te,{children:e.jsx(se,{info:{from:"group",id:t},getEntries:s,markAllAsRead:n})})},dn=()=>e.jsx(te,{children:e.jsx(se,{info:{from:"history",id:""},getEntries:Je})}),un=t=>{var r;const s=t.getFieldsValue();let n=!0;for(const o of Object.keys(s))if(o!=="password"){const i=(r=s[o])==null?void 0:r.trim();t.setFieldValue(o,i),i||(n=!1)}else s[o]||(n=!1);return n},he=(t,s)=>{t.key==="Enter"&&s.submit()},hn=()=>{const[t]=ss(),[s,n]=d.useState(!1),[r,o]=d.useState(xe()||"token"),i=de();d.useEffect(()=>{xe()&&i("/")},[]);const l=async()=>{n(!0);try{(await Re({url:"/v1/me",method:"get",baseURL:t.getFieldsValue().server,headers:{"X-Auth-Token":t.getFieldsValue().token},auth:{username:t.getFieldsValue().username,password:t.getFieldsValue().password},timeout:5e3})).status===200&&(I.success("Success"),ps(r,t.getFieldsValue()),i("/"))}catch(u){console.error(u),I.error(u.message)}n(!1)},h=()=>{l()};return e.jsx("div",{style:{backgroundColor:"var(--color-bg-1)",height:"100%"},children:e.jsx("div",{style:{backgroundColor:"var(--color-fill-1)",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",overflowY:"auto"},children:[e.jsx(Pe,{style:{fontSize:48,color:"rgb(var(--primary-6))",marginTop:"20px"}}),e.jsx(b.Title,{heading:3,children:"Connect to your server"}),e.jsxs(J,{style:{boxShadow:"0 4px 10px rgb(var(--color-bg-3))",padding:"20px",width:"380px",marginTop:"20px"},children:[e.jsxs(_,{autoComplete:"off",form:t,layout:"vertical",onSubmit:()=>{un(t)?h():I.error("Please fill in all required fields")},children:[e.jsx(_.Item,{field:"server",label:"Server address",rules:[{required:!0}],onKeyDown:u=>{he(u,t)},children:e.jsx($,{disabled:s,placeholder:"Please input server address",prefix:e.jsx(ns,{})})}),r==="token"&&e.jsx(_.Item,{field:"token",label:"API Token",rules:[{required:!0}],onKeyDown:u=>{he(u,t)},children:e.jsx($,{disabled:s,placeholder:"Please input api token",prefix:e.jsx(Ie,{})})}),r==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{field:"username",label:"Username",rules:[{required:!0}],onKeyDown:u=>{he(u,t)},children:e.jsx($,{disabled:s,prefix:e.jsx(Me,{}),placeholder:"Please input username"})}),e.jsx(_.Item,{field:"password",label:"Password",rules:[{required:!0}],onKeyDown:u=>{he(u,t)},children:e.jsx($.Password,{disabled:s,prefix:e.jsx(Ie,{}),placeholder:"Please input password"})})]})]}),e.jsx(N,{loading:s,type:"primary",long:!0,onClick:()=>t.submit(),style:{marginTop:"20px"},children:"Connect"}),e.jsx(W,{orientation:"center",children:"Or connect with"}),e.jsx(N,{type:"secondary",long:!0,onClick:()=>o(r==="token"?"user":"token"),style:{marginTop:"20px"},children:r==="token"?"Username and password":"API Token"})]}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(b.Text,{disabled:!0,children:"Need more information?"}),e.jsx(rs,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:"Go to Miniflux official website"})]})]})})})},pn=({children:t})=>xe()?e.jsx(e.Fragment,{children:t}):e.jsx(os,{to:"/login"}),mn=()=>e.jsx(te,{children:e.jsx(se,{info:{from:"starred",id:""},getEntries:Xe})}),xn=()=>{const t=async()=>{const s=await pe(0,"unread"),n=s.data.entries.map(r=>r.id);if(s.data.total>n.length){const r=s.data.total-n.length,o=Math.ceil(r/100)*100,i=await pe(n.length,"unread",o);n.push(...i.data.entries.map(l=>l.id))}return He(n,"read")};return e.jsx(te,{children:e.jsx(se,{info:{from:"today",id:""},getEntries:pe,markAllAsRead:t})})},fn=as([{path:"/",element:e.jsx(pn,{children:e.jsx(Vs,{})}),errorElement:e.jsx(an,{}),children:[{index:!0,element:e.jsx(on,{})},{path:"/today",element:e.jsx(xn,{})},{path:"/starred",element:e.jsx(mn,{})},{path:"/history",element:e.jsx(dn,{})},{path:"/group/:c_id",element:e.jsx(cn,{})},{path:"/feed/:f_id",element:e.jsx(ln,{})}]},{path:"/login",element:e.jsx(hn,{})}]),rt=fn;is.createRoot(document.getElementById("root")).render(e.jsx(ls,{locale:cs,children:e.jsx(ds,{router:rt})}));
