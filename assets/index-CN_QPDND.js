import{m as de,u as g,r as p,p as mt,i as Zt,o as ft,d as B,a as es,b as ts,c as ss,e as K,M as w,C as rs,j as e,f as Y,g as Ue,h as se,A as pt,I as ns,T as y,S as ve,k as Ve,l as et,n as as,q as os,s as $e,t as is,v as ls,w as Te,B as T,x as cs,D as ds,y as Se,z as le,E as gt,F as us,G as hs,H as ms,J as tt,K as xt,L as fs,N as Ce,O as ps,P as yt,Q as J,R as gs,U as xs,V as ys,W as js,X as bs,Y as H,Z as X,_ as st,$ as N,a0 as ce,a1 as z,a2 as jt,a3 as rt,a4 as bt,a5 as P,a6 as wt,a7 as ws,a8 as vs,a9 as ne,aa as Ss,ab as Cs,ac as ks,ad as Fs,ae as Is,af as Ts,ag as As,ah as Es,ai as vt,aj as St,ak as Oe,al as Ns,am as Rs,an as Ls,ao as Ms,ap as Ds,aq as Ps,ar as _s,as as Us,at as Ae,au as Vs,av as $s,aw as Os,ax as ke,ay as zs,az as Bs,aA as Hs,aB as qs,aC as Ws,aD as nt,aE as Ct,aF as Ks,aG as Gs,aH as Ys,aI as Xs,aJ as at,aK as Js,aL as kt,aM as Qs,aN as Zs,aO as er,aP as tr,aQ as sr}from"./vendor-BjxXMnfZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();const L=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},ze=de({addFeedModalVisible:!1,settingsModalVisible:!1}),rr=L(ze,"addFeedModalVisible"),nr=L(ze,"settingsModalVisible"),Be=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=g(ze);return{addFeedModalVisible:t,setAddFeedModalVisible:rr,settingsModalVisible:s,setSettingsModalVisible:nr}},ue=()=>{const[t,s]=p.useState(window.innerWidth),r=t<=768,n=t<=992;return p.useEffect(()=>{const a=()=>s(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},Ft={server:"",token:"",username:"",password:""},He=mt("auth",Ft,{encode:JSON.stringify,decode:JSON.parse}),It=t=>He.set(t),ar=()=>It(Ft),or=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},qe=t=>{const{server:s,token:r,username:n,password:a}=t;return!s||!Zt(s,{require_protocol:!0})&&!or(s)?!1:r||n&&a},ir=()=>ft.create({retry:3,onRequest({_request:t,options:s}){const r=He.get();if(!qe(r))throw new Error("Invalid auth");const{server:n,token:a,username:o,password:i}=r;s.baseURL=n,s.headers=a?{"X-Auth-Token":a}:{Authorization:`Basic ${btoa(`${o}:${i}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var o;s.status===401&&(localStorage.removeItem("auth"),await Qt.navigate("/login"));const a=((o=s._data)==null?void 0:o.error_message)??s.statusText;throw console.error("Response error: ",a),new Error(a)}}),k=ir();k.get=t=>k(t,{method:"GET"});k.post=(t,s)=>k(t,{method:"POST",body:s});k.put=(t,s)=>k(t,{method:"PUT",body:s});const lr=async()=>k.get("/v1/categories"),cr=async t=>k.post("/v1/categories",{title:t}),dr=async t=>k.raw(`/v1/categories/${t}`,{method:"DELETE"}),ur=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return k.put(`/v1/categories/${t}`,n)},hr=async t=>k.put(`/v1/categories/${t}/mark-all-as-read`),Tt={articleWidth:90,fontSize:1.05,homePage:"all",layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},R=mt("settings",Tt,{encode:JSON.stringify,decode:JSON.parse}),U=t=>R.get()[t],q=t=>R.set({...R.get(),...t}),mr=()=>R.set(Tt);B.extend(es);B.extend(ts);B.extend(ss);const fr=t=>B(t).isAfter(B().subtract(24,"hour")),pr=()=>B().subtract(24,"hour").unix(),At=(t,s)=>{if(!s){const f=B(t).fromNow();return f==="a few seconds ago"?"just now":f}const r=B(),a=B(t).diff(r),o=B.duration(Math.abs(a)),i=o.years(),l=o.months(),c=o.days(),d=o.hours(),u=o.minutes(),m=[];if(i>0&&m.push(`${i} year${i>1?"s":""}`),l>0&&m.push(`${l} month${l>1?"s":""}`),c>0&&m.push(`${c} day${c>1?"s":""}`),d>0&&m.push(`${d} hour${d>1?"s":""}`),u>0&&m.push(`${u} minute${u>1?"s":""}`),m.length===0)return"just now";const j=m.join(" ");return a>0?`in ${j}`:`${j} ago`},gr=()=>B().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),Ee=async(t,s)=>k.put("/v1/entries",{entry_ids:t,status:s}),xr=async t=>k.put(`/v1/entries/${t}/bookmark`),yr=async t=>k.get(`/v1/entries/${t}/fetch-content`),ae=(t,s={})=>{const{baseUrl:r,orderField:n,offset:a,limit:o,status:i}=t,l=U("orderDirection"),c=new URLSearchParams({order:n,direction:l,offset:a,limit:o,...s});return i&&c.append("status",i),`${r}?${c}`},jr=async(t=0,s=null)=>{const r=U("orderBy"),n=U("pageSize"),a=U("showAllFeeds"),o={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s},i={globally_visible:!a};return k.get(ae(o,i))},je=async(t=0,s=null,r=null)=>{const n=U("orderBy"),a=r??U("pageSize"),o=U("showAllFeeds"),i=pr(),l={baseUrl:"/v1/entries",orderField:n,offset:t,limit:a,status:s},c={globally_visible:!o,published_after:i};return k.get(ae(l,c))},Et=async(t=0,s=null)=>{const r=U("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},a={starred:"true"};return k.get(ae(n,a))},Nt=async(t=0)=>{const s=U("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return k.get(ae(r))},br=async()=>k.get("/v1/feeds"),wr=async()=>k.get("/v1/feeds/counters"),vr=async t=>k.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),Sr=async()=>k.raw("/v1/feeds/refresh",{method:"PUT"}),Cr=async(t,s,r)=>k.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),kr=async t=>k.raw(`/v1/feeds/${t}`,{method:"DELETE"}),ot=async(t,s)=>{const{categoryId:r,title:n,siteUrl:a,feedUrl:o,hidden:i,disabled:l,isFullText:c}=s;return k.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:a,feed_url:o,hide_globally:i,disabled:l,crawler:c})},Fr=async t=>k.put(`/v1/feeds/${t}/mark-all-as-read`),Ir=async()=>k.get("/v1/me"),Tr=async t=>k.get(`/v1/icons/${t}`),Ar=async()=>k.get("/v1/version"),Er=async()=>{const t=await Ir();return k.put(`/v1/users/${t.data.id}/mark-all-as-read`)},V=de({isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1}),We=K(V,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(a=>({...a,unreadCount:s[a.id]??0})).sort((a,o)=>a.title.localeCompare(o.title,"en"))}),he=K([V,We],(t,s)=>{const{categoriesData:r}=t;return r.map(a=>{const o=s.filter(i=>i.category.id===a.id);return{...a,unreadCount:o.reduce((i,l)=>i+(l.unreadCount??0),0),feedCount:o.length}}).sort((a,o)=>a.title.localeCompare(o.title,"en"))}),Rt=K(he,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),Lt=K([We,Rt],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Mt=K([We,Lt,R],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),Dt=K(Mt,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),Nr=K([V,Mt],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[a,o])=>s.some(i=>i.id===Number(a))?n+o:n,0)}),be=L(V,"categoriesData"),ee=L(V,"feedsData"),Ne=L(V,"historyCount"),Re=L(V,"isAppDataReady"),Le=L(V,"starredCount"),Pt=L(V,"unreadInfo"),_t=L(V,"unreadTodayCount"),Rr=L(V,"isVersionAtLeast2_2_0"),Ut=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(o=>o.id===n.id)||n)},Me=(t,s)=>{const r={};let n=0;const a=t.filter(c=>c.status!==s);if(a.length===0)return;Ne(s==="read"?c=>c+a.length:c=>Math.max(0,c-a.length));for(const c of a){const d=c.feed.id,u=fr(c.published_at),m=s==="read"?-1:1;r[d]=(r[d]??0)+m,n+=u?m:0}_t(c=>Math.max(0,c+n)),Pt(c=>{const d={...c};for(const[u,m]of Object.entries(r))d[u]=Math.max(0,(d[u]??0)+m);return d});const o=a.map(c=>({...c,status:s})),{activeContent:i}=A.get(),l=o.find(c=>c.id===(i==null?void 0:i.id));l&&W(l),me(c=>Ut(c,o))},Ke=()=>{const{activeContent:t}=g(A),s=(i,l)=>{Me([i],l)},r=(i,l)=>{l?(Le(d=>d+1),rs({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):Le(d=>Math.max(0,d-1));const c={...i,starred:l};t&&W(c),me(d=>Ut(d,[c]))};return{handleEntryStatusUpdate:s,handleFetchContent:async()=>{try{const i=await yr(t.id);w.success("Fetched content successfully"),W({...t,content:i.content})}catch{w.error("Failed to fetch content, please try again later")}},handleToggleStarred:async i=>{const l=!i.starred;r(i,l),xr(i.id).catch(()=>{w.error(`Failed to ${l?"star":"unstar"} entry, please try again later`),r(i,!l)})},handleToggleStatus:async i=>{const l=i.status,c=l==="read"?"unread":"read";s(i,c),Ee([i.id],c).catch(()=>{w.error(`Failed to mark entry as ${c}, please try again later`),s(i,l)})}}},Lr=(t,s)=>{if(t.length===0||s==="none")return t;const r=t.map((d,u)=>({id:d.id,index:u})),n=new Map,a=new Map,o=new Map,i=[],l=t.slice().sort((d,u)=>d.id-u.id).filter(d=>{const{hash:u,title:m,url:j,id:f}=d;switch(s){case"hash":if(n.has(u))return i.push(d),!1;n.set(u,f);break;case"title":if(a.has(m))return i.push(d),!1;a.set(m,f);break;case"url":if(o.has(j))return i.push(d),!1;o.set(j,f);break;default:return!0}return!0}),c=i.filter(d=>d.status==="unread").map(d=>d.id);return c.length>0&&(Me(i,"read"),Ee(c,"read").catch(()=>{w.error("Failed to mark duplicate entries as read"),Me(i,"unread")})),l.sort((d,u)=>{const m=r.find(f=>f.id===d.id).index,j=r.find(f=>f.id===u.id).index;return m-j})},Mr=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},pe=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,a=r?s.toLowerCase():s;if(a.length===0)return 0;const o=Mr(a);let i=0,l=0;for(;i<n.length;)if(n[i]===a[l]?(i++,l++):l!==0?l=o[l-1]:i++,l===a.length)return i-l;return-1},Dr=t=>{const s=[],r=[];let n=[];const a=[],o=t.match(/([-+|]?)\s*"([^"]+)"/g);let i=t;o&&(n=o.map(c=>{const d=c.trim()[0],u=c.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(u);break;case"+":s.push(u);break;case"|":a.push([u]);break;default:s.push(u);break}return u}),i=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const l=i.split(/\s+/);for(const c of l){const d=c.replace(/^-|\+|\|$/,"");if(c.startsWith("-")&&d)r.push(d);else if(c.startsWith("+")&&d)s.push(d);else if(c.includes("|")){const u=c.split("|").filter(m=>m);u.length>0&&a.push(u)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:a}},Pr=(t,s,r=[],n=!0)=>{const{includeTerms:a,excludeTerms:o,exactPhrases:i,orConditions:l}=Dr(s);return t.filter(c=>r.some(d=>{const u=c[d];if(typeof u!="string")return!1;const m=n?u.toLowerCase():u;if(o.some(b=>pe(m,b,n)!==-1)||i.length>0&&!i.some(b=>pe(m,b,n)!==-1))return!1;const j=a.every(b=>pe(m,b,n)!==-1),f=l.length===0||l.some(b=>b.some(S=>pe(m,S,n)!==-1));return j&&f}))},_r=(t,s,r=[],n=!0)=>{try{if(!Array.isArray(t)||t.length===0)throw new Error("Invalid data input");if(typeof s!="string"||s.trim().length===0)throw new Error("Invalid query input");return Pr(t,s,r,n)}catch(a){return console.error(a.message),[]}},we=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),Ur=(t,s,r)=>r?_r(t,r,[s]):t,A=de({activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:U("homePage"),isArticleFocused:!1,isArticleListReady:!1,offset:0,total:0}),Ge=K(A,t=>{const{entries:s,total:r}=t;return s.length<r}),Ye=K([A,V,Lt,R],(t,s,r,n)=>{const{entries:a,filterString:o,filterType:i,infoFrom:l}=t,c=Ur(a,i,o),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:u,showAllFeeds:m}=n,j=!["starred","history"].includes(l),f=S=>d||m||!r.includes(S.feed.id),b=j?c.filter(f):c;return u==="none"||["starred","history"].includes(l)?b:Lr(b,u)}),W=L(A,"activeContent"),me=L(A,"entries"),Fe=L(A,"filterString"),Ie=L(A,"filterType"),Vr=L(A,"infoFrom"),te=L(A,"isArticleFocused"),De=L(A,"isArticleListReady"),Vt=L(A,"offset"),$r=L(A,"total"),it=de(),ge=new Set,Or=t=>{const s=g(it);return p.useEffect(()=>{s[t]||ge.has(t)||(ge.add(t),Tr(t).then(r=>{const n=`data:${r.data}`;it.setKey(t,n),ge.delete(t)}).catch(()=>{ge.delete(t)}))},[t,s]),s[t]},zr=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},lt=t=>{const s=zr(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},Br=t=>`https://icons.duckduckgo.com/ip3/${lt(t.site_url)??lt(t.feed_url)}.ico`,$t=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,n=Br(t);if(r===0)return e.jsx("img",{className:s,src:n,alt:""});const[a,o]=p.useState(n),i=Or(r);return p.useEffect(()=>{i&&o(i)},[i]),e.jsx("img",{className:s,src:a,alt:"",onError:()=>o(n)})},Ot=Y.Item,Hr=({category:t,path:s})=>{var i;const n=(i=g(Dt)[t.id])==null?void 0:i.reduce((l,c)=>l+c.unreadCount,0),a=se(),o=()=>{a(`/category/${t.id}`),W(null)};return e.jsxs("div",{className:Te("category-title",{"active-subMenu":s===`/category/${t.id}`,"inactive-subMenu":s!==`/category/${t.id}`}),onClick:o,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&o()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(y.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},qr=({count:t})=>e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),xe=({path:t,Icon:s,label:r,count:n})=>{const a=Ue(),o=se(),i=a.pathname===t,l=()=>{o(t),W(null)};return e.jsx(Ot,{onClick:l,className:Te("arco-menu-item",{"arco-menu-selected":i}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(qr,{count:n})]})},t)},zt=()=>{const{homePage:t,showAllFeeds:s,showFeedIcon:r}=g(R),{historyCount:n,isAppDataReady:a,starredCount:o,unreadTodayCount:i}=g(V),l=g(he),c=g(Dt),d=g(Rt),u=g(Nr),m=Ue(),j=se(),[f,b]=p.useState([`/${t}`]),S=m.pathname;p.useEffect(()=>{b([S])},[S]);const D=()=>e.jsxs(e.Fragment,{children:[e.jsx(xe,{path:"/all",Icon:as,label:"All",count:u}),e.jsx(xe,{path:"/today",Icon:os,label:"Today",count:i}),e.jsx(xe,{path:"/starred",Icon:$e,label:"Starred",count:o}),e.jsx(xe,{path:"/history",Icon:is,label:"History",count:n})]}),C=_=>{var G;return(G=c[_])==null?void 0:G.map(I=>e.jsx(Ot,{style:{position:"relative",overflow:"hidden"},onClick:$=>{$.stopPropagation(),j(`/feed/${I.id}`),W(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:I.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[r&&e.jsx($t,{feed:I,className:"feed-icon-sidebar"}),I.title]}),I.unreadCount!==0&&e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:I.unreadCount})]})},`/feed/${I.id}`))},F=()=>l.filter(_=>s||!d.includes(_.id)).map(_=>e.jsx(et.Item,{name:`/category/${_.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(Hr,{category:_,path:S}),expandIcon:e.jsx(ls,{}),children:C(_.id)},_.id));return e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(Y,{hasCollapseButton:!1,selectedKeys:f,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(pt,{className:"avatar",size:32,children:e.jsx(ns,{style:{color:"var(--color-bg-1)"}})}),e.jsx(y.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:"Articles"}),e.jsx(ve,{loading:!a,animation:!0,text:{rows:3}}),a&&D(),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:"Feeds"})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx(Ve,{style:{maxHeight:"100%"},autoHide:!0,children:e.jsxs(Y,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:f,children:[e.jsx(ve,{loading:!a,animation:!0,text:{rows:6}}),a&&e.jsx(et,{triggerRegion:"icon",bordered:!1,children:F()})]})})})]})},Wr=()=>{const{showAllFeeds:t,theme:s}=g(R),r=se(),n=Ue().pathname,{setAddFeedModalVisible:a,setSettingsModalVisible:o}=Be(),{isBelowLarge:i}=ue(),[l,c]=p.useState(!1),[d,u]=p.useState(!1),[m,j]=p.useState(!1);p.useEffect(()=>{i||c(!1)},[i]),p.useEffect(()=>{n&&c(!1)},[n]);const f=()=>{q({showAllFeeds:!t})},b=()=>{q({theme:s==="light"?"dark":"light"})},S=()=>{mr(),u(!1)},D=()=>{ar(),Re(!1),De(!1),r("/login"),w.success("Successfully logged out")},C=()=>s==="dark"?e.jsx(gs,{}):s==="system"?e.jsx(xs,{}):e.jsx(ys,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(T,{className:"trigger",onClick:()=>c(!l),shape:"circle",size:"small",children:e.jsx(cs,{})})}),e.jsx(ds,{className:"sidebar-drawer",visible:l,title:null,footer:null,closable:!1,onCancel:()=>c(!1),placement:"left",width:240,children:e.jsx(zt,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(Se,{size:16,children:[e.jsx(le,{content:"Add a feed",mini:!0,children:e.jsx(T,{shape:"circle",size:"small",type:"primary",icon:e.jsx(gt,{}),onClick:()=>a(!0)})}),e.jsx(le,{content:t?"Hide some feeds":"Show all feeds",mini:!0,children:e.jsx(T,{shape:"circle",size:"small",icon:t?e.jsx(us,{}):e.jsx(hs,{}),onClick:f})}),e.jsx(T,{shape:"circle",size:"small",icon:e.jsx(ms,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(tt,{droplist:e.jsx(Y,{defaultSelectedKeys:[s],className:"theme-menu",children:["light","dark","system"].map(F=>e.jsxs(Y.Item,{className:"theme-menu-item",onClick:()=>q({theme:F}),children:[F.charAt(0).toUpperCase()+F.slice(1),s===F&&e.jsx(xt,{style:{marginLeft:8}})]},F))}),trigger:"hover",position:"bottom",children:e.jsx(T,{icon:C(),shape:"circle",size:"small",onClick:b})}),e.jsx(tt,{droplist:e.jsxs(Y,{children:[e.jsxs(Y.Item,{onClick:()=>o(!0),children:[e.jsx(fs,{className:"icon-right"}),"Settings"]},"0"),e.jsxs(Y.Item,{onClick:()=>u(!0),children:[e.jsx(Ce,{className:"icon-right"}),"Reset Settings"]},"1"),e.jsxs(Y.Item,{onClick:()=>j(!0),children:[e.jsx(ps,{className:"icon-right"}),"Logout"]},"2")]}),trigger:"click",position:"br",children:e.jsx(pt,{size:28,style:{cursor:"pointer"},children:e.jsx(yt,{})})})]})}),e.jsx(J,{title:"Confirm Reset",visible:d,onOk:S,onCancel:()=>u(!1),children:e.jsx("p",{children:"Are you sure you want to reset your settings? This action cannot be undone."})}),e.jsx(J,{title:"Confirm Logout",visible:m,onOk:D,onCancel:()=>j(!1),children:e.jsx("p",{children:"Are you sure you want to logout?"})})]})},Kr=(t,s)=>{const r=t.split("."),n=s.split(".");for(let a=0;a<Math.max(r.length,n.length);a++){const o=r[a]||"0",i=n[a]||"0",l=o.localeCompare(i,void 0,{numeric:!0});if(l!==0)return l}return 0},Xe=()=>{const t=p.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,Re(!1);try{const r=await Promise.all([wr(),je(0,"unread"),Et(),Nt(),br(),lr(),Ar()]),[n,a,o,i,l,c,d]=r,u=l.reduce((m,j)=>(m[j.id]=n.unreads[j.id]??0,m),{});Pt(u),_t(a.total??0),Le(o.total??0),Ne(i.total??0),ee(l),be(c),Rr(Kr(d.version,"2.2.0")>=0),Re(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},Pe={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Green:{light:"#00B42A",dark:"#27C346"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Magenta:{light:"#F5319D",dark:"#F756A9"}},_e=t=>{const s=Pe[t]||Pe.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=U("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},Bt=t=>{js(_e(t),{list:!0}).map(bs).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},Gr=()=>{const{articleWidth:t,fontSize:s,layout:r,showDetailedRelativeTime:n,showFeedIcon:a,themeColor:o}=g(R),i=l=>{q(l),l.themeColor&&Bt(l.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Accent color"}),e.jsx(y.Text,{type:"secondary",children:"Choose your accent color"})]}),e.jsx("div",{style:{display:"flex"},children:Object.keys(Pe).map(l=>e.jsx(le,{content:l,children:e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:_e(l),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:l===o?`1px solid ${_e(l)}`:"none"},onClick:()=>i({themeColor:l}),onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&i({themeColor:l})},"aria-label":`Change theme color to ${l}`})},l))})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Compact article list"}),e.jsx(y.Text,{type:"secondary",children:"Use small thumbnail in article list"})]}),e.jsx("div",{children:e.jsx(X,{checked:r==="small",onChange:l=>i({layout:l?"small":"large"})})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Show detailed relative time"}),e.jsx(y.Text,{type:"secondary",children:"Show detailed relative time in article list"})]}),e.jsx("div",{children:e.jsx(X,{checked:n,onChange:l=>i({showDetailedRelativeTime:l})})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Show feed icon"}),e.jsx(y.Text,{type:"secondary",children:"Show feed icon in feed list and article list"})]}),e.jsx("div",{children:e.jsx(X,{checked:a,onChange:l=>i({showFeedIcon:l})})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Font size"}),e.jsx(y.Text,{type:"secondary",children:"Adjust article text size"})]}),e.jsx("div",{children:e.jsxs(Se,{children:[e.jsx(y.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(st,{formatTooltip:l=>`${l}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:l=>i({fontSize:l})}),e.jsx(y.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Article width"}),e.jsx(y.Text,{type:"secondary",children:"Adjust article width"})]}),e.jsx("div",{children:e.jsxs(Se,{children:[e.jsx(y.Text,{children:"60%"}),e.jsx(st,{formatTooltip:l=>`${l}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:l=>i({articleWidth:l})}),e.jsx(y.Text,{children:"90%"})]})})]})]})},Yr=()=>{const t=g(he),[s]=N.useForm(),[r,n]=p.useState(!1),[a,o]=p.useState(""),[i,l]=p.useState({}),[c,d]=p.useState(!1),u=async()=>{if(a.trim()){try{const f=await cr(a);be(b=>[...b,{...f}]),w.success("Category added successfully")}catch(f){console.error("Failed to add category: ",f),w.error("Failed to add category")}o(""),d(!1)}},m=async(f,b,S)=>{try{const D=await ur(f,b,S);ee(C=>C.map(F=>F.category.id===f?{...F,category:{...F.category,title:b,hide_globally:S}}:F)),be(C=>C.map(F=>F.id===f?{...F,...D}:F)),w.success("Category updated successfully")}catch{w.error("Failed to update category")}n(!1),s.resetFields()},j=async f=>{try{(await dr(f.id)).status===204?(be(S=>S.filter(D=>D.id!==f.id)),w.success(`Deleted category: ${f.title}`)):w.error(`Failed to delete category: ${f.title}`)}catch(b){console.error(`Failed to delete category: ${f.title}`,b),w.error(`Failed to delete category: ${f.title}`)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(f=>e.jsx(ce,{className:"tag-style",closable:f.feedCount===0,size:"medium",onClick:()=>{l(f),n(!0),s.setFieldsValue({title:f.title})},onClose:async b=>{b.stopPropagation(),await j(f)},children:f.title},f.id)),c?e.jsx(z,{autoFocus:!0,className:"input-style",onBlur:u,onChange:o,onPressEnter:u,size:"small",value:a}):e.jsx(ce,{className:"add-category-tag",icon:e.jsx(gt,{}),onClick:()=>d(!0),size:"medium",tabIndex:0,children:"Add"})]}),i&&e.jsx(J,{className:"modal-style",onOk:s.submit,title:"Edit Category",unmountOnExit:!0,visible:r,onCancel:()=>{n(!1),s.resetFields()},children:e.jsxs(N,{form:s,layout:"vertical",onSubmit:f=>m(i.id,f.title,f.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(N.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(z,{placeholder:"Please input category title"})}),e.jsx(N.Item,{label:"Hidden",field:"hidden",initialValue:i.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(X,{})})]})})]})},Xr=t=>new Promise(s=>setTimeout(s,t)),{Paragraph:Jr}=y,Ht=jt(""),ct=L(Ht),qt=K([V,Ht],(t,s)=>{const{feedsData:r}=t;return[...r].sort((n,a)=>n.disabled&&!a.disabled?1:!n.disabled&&a.disabled?-1:0).sort((n,a)=>a.parsing_error_count-n.parsing_error_count).filter(n=>we(n.title,s)||we(n.site_url,s)||we(n.feed_url,s))}),Qr=K(qt,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),dt=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:gr()}:t,Zr=()=>{const t=g(he),{isAppDataReady:s}=g(V),{showDetailedRelativeTime:r}=g(R),n=g(qt),a=g(Qr),[o,i]=p.useState(!1),[l]=N.useForm(),[c,d]=p.useState(!1),[u,m]=p.useState(""),[j,f]=p.useState(null),{isBelowMedium:b}=ue();p.useEffect(()=>{ct("")},[]);const S=h=>{f(h),d(!0),l.setFieldsValue({category:h.category.id,title:h.title,siteUrl:h.site_url,feedUrl:h.feed_url,hidden:h.hidden,disabled:h.disabled,crawler:h.crawler})},D=async(h,x,v=!0)=>{try{const M=(await h()).status===204;return v&&(M?w.success("Refreshed"):w.error("Failed to refresh")),ee(Q=>Q.map(re=>x(re,M))),M}catch{return v&&w.error("Failed to refresh"),ee(M=>M.map(Q=>x(Q,!1))),!1}},C=async(h,x=!0)=>{const v=h.id||h.key;return D(()=>vr(v),(E,M)=>dt(E,M,v),x)},F=async()=>{try{const h=await Promise.all(n.map(async x=>{const v=new URL(x.feed_url).hostname,E=x.feed_url.replace(v,u),M=await ot(x.id,{feedUrl:E});return{...x,...M}}));ee(x=>x.map(v=>h.find(E=>E.id===v.id)||v)),w.success("Bulk update successfully"),i(!1)}catch{w.error("Failed to bulk update, please try again")}},_=()=>{const[h,x]=p.useState(!1),v=async()=>{x(!1),await D(Sr,dt)},E=async()=>{x(!1);const Q=n.filter(O=>O.parsing_error_count>0);w.success("Starting refresh of error feeds, please wait");let re=0,Z=0;for(const O of Q)await C(O,!1)?re++:Z++,await Xr(500);w.success(`Feeds refreshed. Success: ${re}, Failure: ${Z}`)},M=()=>x(!1);return e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:e.jsx(Ce,{}),shape:"circle",onClick:()=>x(!0)}),e.jsx(J,{className:"edit-modal",onCancel:M,title:"Refresh Feeds",visible:h,footer:[e.jsx(T,{onClick:M,children:"Cancel"},"cancel"),e.jsx(T,{type:"outline",onClick:E,children:"Error Feeds"},"error"),e.jsx(T,{type:"primary",onClick:v,children:"All Feeds"},"all")],children:e.jsx("p",{children:"Do you want to refresh all feeds or just the ones with errors?"})})]})},G=async h=>{try{(await kr(h.key)).status===204?(ee(v=>v.filter(E=>E.id!==h.key)),w.success(`Unfollowed feed: ${h.title}`)):w.error(`Failed to unfollow feed: ${h.title}`)}catch(x){console.error(`Failed to unfollow feed: ${h.title}`,x),w.error(`Failed to unfollow feed: ${h.title}`)}},I=[{title:"Title",dataIndex:"title",sorter:(h,x)=>h.title.localeCompare(x.title,"en"),render:(h,x)=>{const v=x.parsing_error_count;let E=x.disabled?`🚫 ${h}`:h;v>0&&(E=`⚠️ ${h}`);const M=e.jsxs("div",{children:[h,v>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"⚠️ Parsing error count: ",v]})]});return e.jsx(y.Ellipsis,{expandable:!1,children:e.jsx(le,{mini:!0,content:M,children:E})})}},!b&&{title:"Feed URL",dataIndex:"feed_url",sorter:(h,x)=>h.feed_url.localeCompare(x.feed_url,"en"),render:h=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:h})},{title:"Category",dataIndex:"category.title",sorter:(h,x)=>h.category.title.localeCompare(x.category.title,"en"),render:h=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(ce,{children:h})})},!b&&{title:"Checked at",dataIndex:"checked_at",sorter:(h,x)=>h.checked_at.localeCompare(x.checked_at,"en"),render:h=>e.jsx(y.Ellipsis,{expandable:!1,children:At(h,r)})},{title:"Actions",dataIndex:"op",fixed:"right",width:100,render:(h,x)=>e.jsxs(Se,{children:[e.jsx("button",{"aria-label":"Edit this feed",className:"list-item-action",onClick:()=>S(x),type:"button",children:e.jsx(rt,{})}),e.jsx("button",{"aria-label":"Refresh this feed",className:"list-item-action",onClick:()=>C(x),type:"button",children:e.jsx(Ce,{})}),e.jsx(wt,{focusLock:!0,position:"left",title:"Unfollow？",onOk:()=>G(x),children:e.jsx("span",{className:"list-item-action",children:e.jsx(ws,{})})})]})}].filter(Boolean),$=async(h,x)=>{try{const v=await ot(h,x);ee(E=>E.map(M=>M.id===h?{...M,...v}:M)),w.success("Feed updated successfully"),d(!1),l.resetFields()}catch{w.error("Failed to update feed")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{alignItems:"center",display:"flex",width:"100%"},children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(z.Search,{className:"search-input",placeholder:"Search title or site URL or feed URL",searchButton:!0,onChange:ct})}),e.jsxs("div",{style:{display:"flex",gap:16,paddingBottom:16,paddingLeft:16},children:[e.jsx(T,{icon:e.jsx(rt,{}),shape:"circle",onClick:()=>i(!0)}),e.jsxs(J,{className:"edit-modal",onOk:F,title:"Bulk Update Hosts",visible:o,onCancel:()=>{i(!1),m("")},children:[e.jsxs(Jr,{children:["This will bulk update filtered feeds' hosts.",e.jsx("br",{}),"Only recommended for RssHub."]}),e.jsx(z,{placeholder:"rsshub.app",value:u,onChange:h=>m(h)})]}),e.jsx(_,{})]})]}),e.jsx(bt,{borderCell:!0,className:"feed-table",columns:I,data:a,loading:!s,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),j&&e.jsx(J,{className:"edit-modal",onOk:l.submit,title:"Edit Feed",unmountOnExit:!0,visible:c,onCancel:()=>{d(!1),l.resetFields()},children:e.jsxs(N,{form:l,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async h=>{const x={categoryId:h.category,title:h.title,siteUrl:h.siteUrl.trim(),feedUrl:h.feedUrl.trim(),hidden:h.hidden,disabled:h.disabled,isFullText:h.crawler};x.feedUrl?await $(j.key,x):w.error("Feed URL cannot be empty")},children:[e.jsx(N.Item,{label:"Category",required:!0,field:"category",rules:[{required:!0}],children:e.jsx(P,{placeholder:"Please select",children:t.map(h=>e.jsx(P.Option,{value:h.id,children:h.title},h.id))})}),e.jsx(N.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(z,{placeholder:"Please input feed title"})}),e.jsx(N.Item,{label:"Site URL",field:"siteUrl",rules:[{required:!0}],children:e.jsx(z,{placeholder:"Please input site URL"})}),e.jsx(N.Item,{label:"Feed URL",field:"feedUrl",rules:[{required:!0}],children:e.jsx(z,{placeholder:"Please input feed URL"})}),e.jsx(N.Item,{label:"Hidden",field:"hidden",initialValue:j.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(X,{})}),e.jsx(N.Item,{label:"Disabled",field:"disabled",initialValue:j.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(X,{})}),e.jsx(N.Item,{label:"Fetch original content",field:"crawler",tooltip:e.jsx("div",{children:"Only affects newly retrieved articles"}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(X,{})})]})})]})},en=()=>{const{homePage:t,markReadOnScroll:s,orderBy:r,pageSize:n,removeDuplicates:a}=g(R);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Default home page"}),e.jsx(y.Text,{type:"secondary",children:"Which page to show by default:"})]}),e.jsx("div",{children:e.jsxs(P,{className:"input-select",onChange:o=>q({homePage:o}),placeholder:"Select page",value:t,children:[e.jsx(P.Option,{value:"all",children:"All"}),e.jsx(P.Option,{value:"today",children:"Today"}),e.jsx(P.Option,{value:"starred",children:"Starred"}),e.jsx(P.Option,{value:"history",children:"History"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Entries order"}),e.jsx(y.Text,{type:"secondary",children:"What order to show entries:"})]}),e.jsx("div",{children:e.jsxs(P,{className:"input-select",onChange:o=>q({orderBy:o}),placeholder:"Select order",value:r,children:[e.jsx(P.Option,{value:"published_at",children:"Published at"}),e.jsx(P.Option,{value:"created_at",children:"Created at"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Entries per page"}),e.jsx(y.Text,{type:"secondary",children:"Show how many entries per page:"})]}),e.jsx("div",{children:e.jsx(vs,{className:"input-select",defaultValue:n,min:1,mode:"button",onChange:o=>q({pageSize:o}),size:"small"})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Remove duplicate articles"}),e.jsx(y.Text,{type:"secondary",children:"Automatically remove duplicate articles based on:"})]}),e.jsx("div",{children:e.jsxs(P,{className:"input-select",onChange:o=>q({removeDuplicates:o}),placeholder:"Select option",value:a,children:[e.jsx(P.Option,{value:"none",children:"None"}),e.jsx(P.Option,{value:"hash",children:"Hash"}),e.jsx(P.Option,{value:"title",children:"Title"}),e.jsx(P.Option,{value:"url",children:"URL"})]})})]}),e.jsx(H,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:"Mark articles as read when scrolled off screen"}),e.jsx(y.Text,{type:"secondary",children:"Automatically mark articles as read when they are scrolled out of the visible screen area"})]}),e.jsx("div",{children:e.jsx(X,{checked:s,onChange:o=>q({markReadOnScroll:o})})})]})]})},tn=[{title:"Key",dataIndex:"keyName",render:t=>e.jsx(ce,{children:t})},{title:"Function",dataIndex:"description"}],sn=[{key:"1",keyName:"Esc",description:"Exit the article view and return to the list."},{key:"2",keyName:"←",description:"Navigate to the previous article in the list."},{key:"3",keyName:"Ctrl + ←",description:"Navigate to the previous unread article in the list."},{key:"4",keyName:"→",description:"Navigate to the next article in the list."},{key:"5",keyName:"Ctrl + →",description:"Navigate to the next unread article in the list."},{key:"6",keyName:"B",description:"Open the current article's link in a new browser tab."},{key:"7",keyName:"D",description:"Fetch and display the original content of the current article."},{key:"8",keyName:"M",description:"Toggle the read status of the current article."},{key:"9",keyName:"S",description:"Toggle the star status (bookmark) of the current article."},{key:"10",keyName:"V",description:"Open the photo slider for viewing all images in the current article."}],rn=()=>e.jsx(bt,{borderCell:!0,columns:tn,data:sn,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}}),nn=()=>{const t=(s,r)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[s,e.jsx("div",{style:{fontSize:"12px"},children:r})]});return e.jsxs(ne,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(ne.TabPane,{title:t(e.jsx(Ss,{style:{fontSize:"20px"}}),"Feeds"),children:e.jsx(Zr,{})},"1"),e.jsx(ne.TabPane,{title:t(e.jsx(Cs,{style:{fontSize:"20px"}}),"Categories"),children:e.jsx(Yr,{})},"2"),e.jsx(ne.TabPane,{title:t(e.jsx(ks,{style:{fontSize:"20px"}}),"General"),children:e.jsx(en,{})},"3"),e.jsx(ne.TabPane,{title:t(e.jsx(Fs,{style:{fontSize:"20px"}}),"Appearance"),children:e.jsx(Gr,{})},"4"),e.jsx(ne.TabPane,{title:t(e.jsx(Is,{style:{fontSize:"20px"}}),"Hotkeys"),children:e.jsx(rn,{})},"5")]})},an=[{required:!0}],on=[{required:!0}],ln=[{type:"boolean"}],cn=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=Be();return e.jsx(J,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(nn,{})})},dn=()=>{const t=g(he),{addFeedModalVisible:s,setAddFeedModalVisible:r}=Be(),[n,a]=p.useState(!1),[o]=N.useForm(),{fetchAppData:i}=Xe(),l=async(c,d,u)=>{a(!0);try{await Cr(c,d,u),await i(),w.success("Added a feed successfully"),r(!1),o.resetFields()}catch{w.error("Failed to add a feed")}finally{a(!1)}};return e.jsx(J,{title:"Add Feed",visible:s,unmountOnExit:!0,style:{width:"400px"},onOk:o.submit,confirmLoading:n,onCancel:()=>{r(!1),o.resetFields()},children:e.jsxs(N,{form:o,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async c=>{const d=c.url.trim();d?await l(d,c.category,c.crawler):w.error("Feed URL cannot be empty")},children:[e.jsx(N.Item,{label:"Feed URL",field:"url",rules:an,children:e.jsx(z,{placeholder:"Please input a feed URL"})}),e.jsx(N.Item,{field:"category",label:"Category",required:!0,rules:on,children:e.jsx(P,{placeholder:"Please select a category",showSearch:!0,filterOption:(c,d)=>we(d.props.children,c),children:t.map(c=>e.jsx(P.Option,{value:c.id,children:c.title},c.id))})}),e.jsx(N.Item,{field:"crawler",initialValue:!1,label:"Fetch original content",rules:ln,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(X,{})})]})})},un=()=>e.jsxs("div",{className:"main",children:[e.jsx(Ts,{}),e.jsx(cn,{}),e.jsx(dn,{})]}),Wt=()=>{const{theme:t,themeColor:s}=g(R),[r,n]=p.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);p.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),o=i=>n(i.matches);return a.addEventListener("change",o),()=>a.removeEventListener("change",o)},[]),p.useEffect(()=>{const a=o=>{const i=o?"dark":"light";document.body.setAttribute("arco-theme",i),document.body.style.colorScheme=i};Bt(s),a(t==="system"?r:t==="dark")},[r,t,s])},hn=()=>{Wt();const{isBelowLarge:t}=ue();return e.jsxs("div",{className:"app",children:[t?null:e.jsx(As.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(zt,{})}),e.jsx(Wr,{}),e.jsx(un,{})]})},Kt=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},Gt=t=>{var a;const n=(a=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:a.getAttribute("src");return{...t,imgSrc:n}},mn=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(Gt);me(s),$r(t.total)}},fn=t=>{const{isAppDataReady:s}=g(V),{showStatus:r}=g(R),n=p.useRef(!1),a=async o=>{if(!n.current){n.current=!0,De(!1);try{const i=r==="unread"?await o(0,"unread"):await o();De(!0),te(!0),mn(i)}catch(i){console.error("Error fetching articles: ",i),te(!1)}finally{n.current=!1}}};return p.useEffect(()=>{s&&a(t)},[s]),{fetchArticleList:a}},Yt=jt(!1),ut=L(Yt),Je=()=>{const{offset:t}=g(A),{pageSize:s,showStatus:r}=g(R),n=g(Yt),a=i=>{const l=(c,d)=>d.filter(u=>!c.some(m=>m.id===u.id));me(c=>[...c,...l(c,i)]),Vt(c=>c+s)};return{handleLoadMore:async i=>{ut(!0);try{const l=r==="unread"?await i(t+s,"unread"):await i(t+s);if(l!=null&&l.entries){const c=l.entries.map(Gt);a(c)}}catch(l){console.error("Error fetching more articles: ",l)}finally{ut(!1)}},loadingMore:n}},Qe=de({isPhotoSliderVisible:!1,selectedIndex:0}),pn=L(Qe,"isPhotoSliderVisible"),gn=L(Qe,"selectedIndex"),Xt=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=g(Qe);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:pn,selectedIndex:s,setSelectedIndex:gn}},Jt=(t,s)=>{const{activeContent:r}=g(A),n=g(Ye),a=g(Ge),{isPhotoSliderVisible:o,setIsPhotoSliderVisible:i,setSelectedIndex:l}=Xt(),{loadingMore:c}=Je(),[d,u]=p.useState(!1),[m,j]=p.useState(!1);p.useEffect(()=>{m&&!c&&(u(!1),j(!1),S())},[c,m]),p.useEffect(()=>{var I;r&&((I=document.querySelector(".card-custom-selected-style"))==null||I.scrollIntoView({behavior:"smooth",block:"nearest"}))},[r]);const f=()=>{r&&(W(null),s.current&&s.current.contentWrapperEl.focus())},b=(I=!1)=>{const $=n.findIndex(h=>h.id===(r==null?void 0:r.id));if($>0){const h=I?n.slice(0,$).toReversed().find(x=>x.status==="unread"):n[$-1];h&&t(h)}},S=(I=!1)=>{if(d)return;const $=n.findIndex(v=>v.id===(r==null?void 0:r.id));if($===n.length-1&&a){u(!0),j(!0);return}if($===-1){s.current.contentWrapperEl.scrollTo({top:0,left:0,behavior:"smooth"});return}const x=I?n.slice($+1).find(v=>v.status==="unread"):n[$+1];x&&(t(x),j(!1))};return{exitDetailView:f,fetchOriginalArticle:I=>{r&&I()},navigateToNextArticle:S,navigateToPreviousArticle:b,openLinkExternally:()=>{r&&window.open(r.url,"_blank")},openPhotoSlider:()=>{!r||!Kt(r.content).length||o||(l(0),i(!0),te(!1))},toggleReadStatus:I=>{r&&I()},toggleStarStatus:I=>{r&&I()}}},xn=({handleEntryClick:t,entryListRef:s})=>{const{activeContent:r}=g(A),{handleFetchContent:n,handleToggleStarred:a,handleToggleStatus:o}=Ke(),{exitDetailView:i,navigateToNextArticle:l,navigateToPreviousArticle:c}=Jt(t,s);if(!r)return null;const d=r.status==="unread",u=r.starred;return e.jsxs(T.Group,{className:"action-buttons",children:[e.jsx(T,{icon:e.jsx(Es,{}),onClick:()=>i(),shape:"round",type:"primary"}),e.jsx(T,{icon:d?e.jsx(vt,{}):e.jsx(St,{}),onClick:()=>o(r),type:"primary"}),e.jsx(T,{icon:u?e.jsx(Oe,{style:{color:"#ffcd00"}}):e.jsx($e,{}),onClick:()=>a(r),type:"primary"}),e.jsx(T,{icon:e.jsx(Ns,{}),onClick:()=>c(),type:"primary"}),e.jsx(T,{icon:e.jsx(Rs,{}),onClick:()=>l(),type:"primary"}),e.jsx(T,{icon:e.jsx(Ls,{}),onClick:n,shape:"round",type:"primary"})]})},yn=({url:t,text:s})=>{const[r,n]=p.useState(!1),a=()=>n(!r);return e.jsx(_s,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:a,onMouseLeave:a,children:s})},ht=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var b;const{fontSize:a}=g(R),[o,i]=p.useState(!1),[l,c]=p.useState(!1),{isBelowMedium:d}=ue();p.useEffect(()=>{const D=(n?t.children[0]:t).attribs.src,C=new Image;C.src=D,C.onload=()=>c(C.width<=100&&C.height<=100)},[t,n]);const u=n?t.children[0]:t,m=()=>e.jsx("img",{...u.attribs,alt:u.attribs.alt??"image",style:l?{display:"inline-block",width:"auto",height:`${a}rem`,margin:0}:{}});if(l)return n?e.jsxs("a",{...t.attribs,children:[m(),(b=t.children[1])==null?void 0:b.data]}):m();const j=()=>i(!0),f=()=>i(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:j,onMouseLeave:f,children:[n?e.jsx("a",{...t.attribs,children:m()}):m(),e.jsx(T,{icon:e.jsx(Us,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:d||o?1:0,transition:"opacity 0.3s"},onClick:S=>{S.preventDefault(),r(s)}})]})})},jn=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const n=r.children[0];if(n.type==="tag"&&n.name==="img"){const a=t.findIndex(o=>o===n.attribs.src);return e.jsx(ht,{node:r,index:a,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const n=t.findIndex(a=>a===r.attribs.src);return e.jsx(ht,{node:r,index:n,togglePhotoSlider:s})}return r}}),bn=p.forwardRef(({handleEntryClick:t,entryListRef:s},r)=>{const n=se(),{activeContent:a}=g(A),{articleWidth:o,fontSize:i}=g(R),{isPhotoSliderVisible:l,setIsPhotoSliderVisible:c,selectedIndex:d,setSelectedIndex:u}=Xt(),m=()=>{Ie("author"),Fe(a.author)},j=F=>{u(F),c(_=>!_),te(_=>!_)};if(!a)return e.jsxs("div",{ref:r,className:"content-empty",children:[e.jsx(Ms,{style:{fontSize:"64px"}}),e.jsx(y.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const f=Kt(a.content),b=jn(f,j),S=Ds(a.content,b),{id:D,title:C}=a.feed.category;return e.jsxs("div",{className:"article-content",onBlur:()=>te(!1),onFocus:()=>te(!0),ref:r,children:[e.jsxs(Ve,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${o}%`},children:[e.jsx(y.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(y.Text,{children:e.jsx(yn,{url:`/feed/${a.feed.id}`,text:a.feed.title})}),e.jsx(y.Text,{onClick:m,style:{cursor:"pointer"},children:` - ${a.author}`}),e.jsx(y.Text,{children:e.jsx(ce,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>n(`/category/${D}`),children:C})})]}),e.jsx(y.Text,{className:"article-date",children:B(a.published_at).format("dddd, MMMM D, YYYY [at] h:mm A")}),e.jsx(H,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${i}rem`,width:`${o}%`},children:[S,e.jsx(Ps,{images:f.map(F=>({src:F,key:F})),loop:!1,visible:l,onClose:()=>{c(!1),te(!0)},index:d,onIndexChange:u})]},a.id)]}),e.jsx(xn,{handleEntryClick:t,entryListRef:s})]})}),wn=({alt:t,borderRadius:s,height:r,src:n,status:a,width:o})=>{const[i,l]=p.useState(!1),{ref:c}=Ae({triggerOnce:!0,onChange:(d,u)=>{if(d&&!i){const m=new Image;m.onload=()=>l(!0),m.onerror=()=>{u.target.style.display="none"},m.src=n}}});return e.jsx("div",{className:"image-container",ref:c,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:i?e.jsx("img",{className:a==="unread"?"":"read",src:n,alt:t,style:{width:o,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(ve,{text:{rows:0},image:{style:{width:o,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},vn=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(wn,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},Sn=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:a}=g(R),o=Te({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:o,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:t.imgSrc?r?"0 10px 0 0":"0 0 10px 0":"0"},children:e.jsx(vn,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(y.Text,{className:"article-card-title",children:t.title}),e.jsxs(y.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx($t,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),At(t.published_at,a)]}),t.starred&&e.jsx(Oe,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},Cn=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:a,showFeedIcon:o}=g(R),{activeContent:i}=g(A),l=i&&t.id===i.id,{handleToggleStarred:c,handleToggleStatus:d}=Ke(),[u,m]=p.useState(0),j=100,f=.5,b=t.starred,S=t.status==="unread",D=Vs({preventScrollOnSwipe:!0,delta:j/2,onSwiping:v=>{const E=Math.min(Math.abs(v.deltaX*f),j)*Math.sign(v.deltaX);m(E)},onSwiped:async v=>{try{v.deltaX>j?(await c(t),w.success(b?"Unmarked as starred":"Marked as starred")):v.deltaX<-j&&(await d(t),w.success(S?"Marked as read":"Marked as unread"))}catch{w.error("Failed to update, please try again")}m(0)}}),[C,F]=p.useState(!1),[_,G]=p.useState(!1),I=()=>d(t),$=20,{ref:h}=Ae({skip:_,onChange:async(v,E)=>{if(!(!a||!S)){if(v)F(!0);else if(C){const{top:M}=E.boundingClientRect;M<$&&(await I(),G(!0))}}}}),x=$s({x:u});return p.createElement("div",{...D,className:"article-card",key:t.id},e.jsxs("div",{ref:h,children:[e.jsx(Os.div,{className:"swipe-card",style:x,children:e.jsx(ke,{className:Te("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":l}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(ke.Meta,{description:e.jsx(Sn,{entry:t,showFeedIcon:o,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:b?e.jsx(Oe,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx($e,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:S?e.jsx(vt,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(St,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},kn=()=>{const{layout:t}=g(R),{isArticleListReady:s}=g(A),r=t==="large"?2:4,n=a=>e.jsx(ke,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(ke.Meta,{description:e.jsx(ve,{loading:!s,animation:!0,text:{rows:3,width:150}})})},a);return!s&&Array.from({length:r},(a,o)=>n(o))},Fn=()=>{const{orderDirection:t}=g(R),{filterString:s,filterType:r}=g(A),{isBelowMedium:n}=ue(),a=()=>{q({orderDirection:t==="desc"?"asc":"desc"})};return p.useEffect(()=>{Ie("title"),Fe("")},[]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(z.Search,{allowClear:!0,onChange:Fe,placeholder:"Search...",style:{width:n?"100%":278,marginLeft:8},value:s,addBefore:e.jsxs(P,{placeholder:"Select type",onChange:Ie,style:{width:100},value:r,children:[e.jsx(P.Option,{value:"title",children:"Title"}),e.jsx(P.Option,{value:"content",children:"Content"}),e.jsx(P.Option,{value:"author",children:"Author"})]})}),e.jsx(le,{mini:!0,content:t==="desc"?"Newest first":"Oldest first",children:e.jsx(T,{shape:"circle",size:"small",style:{margin:"0 8px",flexShrink:0},icon:t==="desc"?e.jsx(zs,{}):e.jsx(Bs,{}),onClick:a})})]})},In=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},Tn=(t,s,r)=>{p.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},An=({duration:t,color:s})=>{const[r,n]=p.useState([]);Tn(r.length,t,()=>{n([])});const a=o=>{const i=o.currentTarget.getBoundingClientRect(),l=i.width>i.height?i.width:i.height,c=o.pageX-i.x-l/2,d=o.pageY-i.y-l/2,u={x:c,y:d,size:l,id:`${new Date().getTime()}-${c}-${d}`};n([...r,u])};return e.jsx("div",{className:"ripple-container",onMouseDown:a,children:r.length>0&&r.map(o=>e.jsx("span",{className:"ripple-span",style:{top:o.y,left:o.x,width:o.size,height:o.size,backgroundColor:s,animationDuration:`${t}ms`}},o.id))})},En=({getEntries:t})=>{const{isArticleListReady:s}=g(A),r=g(Ge),{loadingMore:n,handleLoadMore:a}=Je(),{ref:o}=Ae({skip:!r,onChange:async i=>{!i||!s||n||await a(t)}});return s&&r&&e.jsxs("div",{className:"load-more-container",ref:o,children:[e.jsx(qs,{loading:n,style:{paddingRight:"10px"}}),"Loading more ..."]})},Nn=p.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:a,pageSize:o}=g(R),i=a==="small",{isArticleListReady:l}=g(A),c=g(Ye),d=c.length-Math.ceil(o*.2)-1,u=g(Ge),{loadingMore:m,handleLoadMore:j}=Je(),{ref:f}=Ae({skip:!u,onChange:async C=>{!C||!l||m||await j(t)}}),b=Hs({count:c.length,getScrollElement:()=>r.current,estimateSize:()=>i?120:280}),S=b.getVirtualItems(),D=p.useCallback(C=>C===d?In(b.measureElement,f):b.measureElement,[d,b.measureElement,f]);return e.jsxs(e.Fragment,{children:[e.jsx(Fn,{}),e.jsxs(Ve,{className:"entry-list",ref:n,children:[e.jsx(kn,{}),l&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:b.getTotalSize(),width:"100%",position:"relative"},children:S.map(C=>e.jsx("div",{"data-index":C.index,ref:D(C.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${C.start}px)`},children:e.jsx(Cn,{entry:c[C.index],handleEntryClick:s,mini:i,children:e.jsx(An,{color:"var(--color-text-4)",duration:1e3})})},C.key))})}),e.jsx(En,{getEntries:t})]})]})}),Rn=()=>{me(t=>t.map(s=>({...s,status:"read"})))},Ln=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:n}=g(A),{showStatus:a}=g(R),{fetchAppData:o}=Xe(),i=async()=>{try{await r(),Rn(),await o(),w.success("All articles marked as read")}catch{w.error("Failed to mark all as read")}},l=c=>{q({showStatus:c})};return p.useEffect(()=>{Ie("title"),Fe("")},[a]),e.jsxs("div",{className:"entry-panel",children:[!["starred","history"].includes(t.from)&&e.jsx(wt,{focusLock:!0,title:"Mark All As Read?",onOk:i,children:e.jsx(T,{icon:e.jsx(xt,{}),shape:"circle"})}),e.jsx(Ws.Group,{disabled:t.from==="history",onChange:l,options:[{label:"ALL",value:"all"},{label:"UNREAD",value:"unread"}],type:"button",value:t.from==="history"?"all":a}),e.jsx(T,{icon:e.jsx(Ce,{}),loading:!n,shape:"circle",onClick:s})]})},oe=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleFocused:a,isArticleListReady:o}=g(A),{isAppDataReady:i}=g(V),{orderBy:l,orderDirection:c,showAllFeeds:d,showStatus:u}=g(R),m=g(Ye),{handleFetchContent:j,handleToggleStarred:f,handleToggleStatus:b,handleEntryStatusUpdate:S}=Ke(),{fetchAppData:D}=Xe(),{fetchArticleList:C}=fn(s),F=p.useRef(null),_=p.useRef(null),G=p.useRef(null);p.useEffect(()=>{Vr(t.from),n&&W(null),Z(s)},[t]),p.useEffect(()=>{["starred","history"].includes(t.from)||Z(s)},[l,d]),p.useEffect(()=>{Z(s)},[c,u]);const I=async O=>{if(W(null),O.status!=="unread"){setTimeout(()=>{W({...O,status:"read"})},200);return}try{setTimeout(()=>{W({...O,status:"read"}),S(O,"read")},200),await Ee([O.id],"read")}catch{w.error("Failed to mark entry as read, please try again later"),S(O,"unread")}},{exitDetailView:$,fetchOriginalArticle:h,navigateToNextArticle:x,navigateToPreviousArticle:v,openLinkExternally:E,openPhotoSlider:M,toggleReadStatus:Q,toggleStarStatus:re}=Jt(I,F);p.useEffect(()=>{const O={ArrowLeft:()=>v(),ArrowRight:()=>x(),Escape:()=>$(),b:E,d:()=>h(j),m:()=>Q(()=>b(n)),s:()=>re(()=>f(n)),v:M},fe=ie=>{const Ze=O[ie.key];Ze&&(ie.key==="ArrowLeft"?v(ie.ctrlKey):ie.key==="ArrowRight"?x(ie.ctrlKey):Ze())};return a?document.addEventListener("keydown",fe):document.removeEventListener("keydown",fe),()=>{document.removeEventListener("keydown",fe)}},[n,m,a]);const Z=async O=>{Vt(0),i?await C(O):await D()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(nt,{in:o,timeout:200,nodeRef:_,classNames:"fade",children:e.jsx(Nn,{cardsRef:_,getEntries:s,handleEntryClick:I,ref:F})}),e.jsx(Ln,{info:t,refreshArticleList:()=>Z(s),markAllAsRead:r})]}),e.jsx(nt,{in:n!==null,timeout:200,nodeRef:G,classNames:"fade",unmountOnExit:!0,children:e.jsx(bn,{handleEntryClick:I,entryListRef:F,ref:G})})]})},Mn=()=>e.jsx(oe,{info:{from:"all",id:""},getEntries:jr,markAllAsRead:Er}),Dn=()=>{const{id:t}=Ct(),s=U("orderBy"),r=U("pageSize"),n=U("showAllFeeds"),a=async(o=0,i=null)=>{const l={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:o,limit:r,status:i},c={globally_visible:!n};return k.get(ae(l,c))};return e.jsx(oe,{info:{from:"category",id:t},getEntries:a,markAllAsRead:()=>hr(t)})},Pn=()=>{const t=se(),s=Ks();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(Gs,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(T,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},_n=()=>{const{id:t}=Ct(),s=U("orderBy"),r=U("pageSize"),n=async(a=0,o=null)=>{const i={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:a,limit:r,status:o};return k.get(ae(i))};return e.jsx(oe,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>Fr(t)})},Un=()=>e.jsx(oe,{info:{from:"history",id:""},getEntries:Nt}),Vn=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,a]of Object.entries(s))if(n!=="password"){const o=a==null?void 0:a.trim();t.setFieldValue(n,o),o||(r=!1)}else a||(r=!1);return r},ye=(t,s)=>{t.key==="Enter"&&s.submit()},$n=()=>{Wt();const[t]=Ys(),[s,r]=p.useState(!1),[n,a]=p.useState("token"),o=se(),i=async()=>{r(!0);const{server:c,token:d,username:u,password:m}=t.getFieldsValue();try{(await ft.raw("v1/me",{baseURL:c,headers:d?{"X-Auth-Token":d}:{Authorization:`Basic ${btoa(`${u}:${m}`)}`}})).status===200&&(w.success("Login successfully"),It({server:c,token:d,username:u,password:m}),o("/"))}catch(j){console.error(j),w.error(j.message)}r(!1)},l=async()=>{const c=t.getFieldsValue();if(!qe(c)){w.error("Please check your server address and credentials");return}await i()};return e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(y.Title,{heading:3,children:"Connect to your server"}),e.jsxs(N,{autoComplete:"off",form:t,layout:"vertical",onSubmit:async()=>{Vn(t)?await l():w.error("Please fill in all required fields")},children:[e.jsx(N.Item,{field:"server",label:"Server address",rules:[{required:!0}],onKeyDown:c=>{ye(c,t)},children:e.jsx(z,{disabled:s,placeholder:"Please input server address",prefix:e.jsx(Xs,{})})}),n==="token"&&e.jsx(N.Item,{field:"token",label:"API Token",rules:[{required:!0}],onKeyDown:c=>{ye(c,t)},children:e.jsx(z.Password,{disabled:s,placeholder:"Please input API token",prefix:e.jsx(at,{})})}),n==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(N.Item,{field:"username",label:"Username",rules:[{required:!0}],onKeyDown:c=>{ye(c,t)},children:e.jsx(z,{disabled:s,placeholder:"Please input username",prefix:e.jsx(yt,{})})}),e.jsx(N.Item,{field:"password",label:"Password",rules:[{required:!0}],onKeyDown:c=>{ye(c,t)},children:e.jsx(z.Password,{disabled:s,placeholder:"Please input password",prefix:e.jsx(at,{})})})]})]}),e.jsx(T,{loading:s,type:"primary",long:!0,onClick:()=>t.submit(),style:{marginTop:"20px"},children:"Connect"}),e.jsx(H,{orientation:"center",children:"Or connect with"}),e.jsx(T,{type:"secondary",long:!0,onClick:()=>a(n==="token"?"user":"token"),style:{marginTop:"20px"},children:n==="token"?"Username and password":"API Token"}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(y.Text,{disabled:!0,children:"Need more info?"}),e.jsx(Js,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:"Go to Miniflux official website"})]})]})}),e.jsx("div",{className:"background"})]})},On=({children:t})=>{const s=g(He);return qe(s)?e.jsx(e.Fragment,{children:t}):e.jsx(kt,{to:"/login"})},zn=()=>e.jsx(oe,{info:{from:"starred",id:""},getEntries:Et}),Bn=()=>{const t=async()=>{const s=await je(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=je(0,"unread",r).then(o=>o.entries));const a=n.map(o=>o.id);return Ee(a,"read")};return e.jsx(oe,{info:{from:"today",id:""},getEntries:je,markAllAsRead:t})},Hn=U("homePage"),qn=[{path:"/all",element:e.jsx(Mn,{})},{path:"/today",element:e.jsx(Bn,{})},{path:"/starred",element:e.jsx(zn,{})},{path:"/history",element:e.jsx(Un,{})},{path:"/category/:id",element:e.jsx(Dn,{})},{path:"/feed/:id",element:e.jsx(_n,{})}],Qt=Qs([{path:"/",element:e.jsx(On,{children:e.jsx(hn,{})}),errorElement:e.jsx(Pn,{}),children:[...qn,{index:!0,element:e.jsx(kt,{to:`/${Hn}`,replace:!0})}]},{path:"/login",element:e.jsx($n,{})}]);Zs.createRoot(document.getElementById("root")).render(e.jsx(er,{locale:tr,children:e.jsx(sr,{router:Qt})}));
