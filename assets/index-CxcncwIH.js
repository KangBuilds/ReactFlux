import{d as q,r as vt,a as Le,M as F,c as bt,g as Ct,b as wt,u as ce,j as e,B as M,I as Et,S as fe,T as z,e as Me,f as St,D as Ie,h as H,i as Ne,k as kt,l as It,m as Ft,n as Tt,o as At,A as De,p as Pe,q as b,R as ie,s as K,t as pe,v as Rt,w as u,F as D,x as U,y as Ue,z as ge,C as $,E as le,G as Lt,H as Mt,P as Be,J as Nt,K as ee,L as oe,N as Dt,O as Pt,Q as Ut,U as Bt,V as zt,W as Gt,X as ze,Y as Ge,Z as Yt,_ as _t,$ as be,a0 as Vt,a1 as Ht,a2 as Ot,a3 as Wt,a4 as Kt,a5 as Ye,a6 as _e,a7 as ye,a8 as Ve,a9 as He,aa as Oe,ab as Qt,ac as $t,ad as qt,ae as Jt,af as Xt,ag as Zt,ah as J,ai as We,aj as es,ak as Fe,al as ts,am as ss,an as Ke,ao as ns,ap as rs,aq as Te,ar as os,as,at as is,au as ls,av as cs,aw as ds,ax as us}from"./vendor-DeABhpsE.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();q.extend(vt);const hs=t=>{const s=q(t),n=q();return s.isAfter(n.subtract(24,"hour"))},ps=()=>q().subtract(24,"hour").unix(),Ce=t=>q(t).fromNow(),xe=()=>{const t=JSON.parse(localStorage.getItem("auth"));return t||(console.log("No auth info found in localStorage"),null)},xs=(t,s)=>{const n={method:t,secret:s};localStorage.setItem("auth",JSON.stringify(n))},R=Le.create({timeout:5e3});R.interceptors.request.use(t=>{const s=xe(),{server:n,token:r,username:o,password:i}=(s==null?void 0:s.secret)||{};return t.baseURL=n,r&&(t.headers["X-Auth-Token"]=r),o&&i&&(t.auth={username:o,password:i}),t},t=>Promise.reject(t));R.interceptors.response.use(t=>t,t=>{var n,r,o;console.error(t);const s=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.error_message)||t.message;return F.error(s),((o=t.response)==null?void 0:o.status)===401&&(localStorage.removeItem("auth"),at.navigate("/login")),Promise.reject(t)});const Qe=async(t,s)=>R.put("/v1/entries",{entry_ids:t,status:s}),$e=async(t,s)=>Qe([t],s),ms=async t=>R.put(`/v1/entries/${t}/bookmark`),fs=async t=>R.get(`/v1/entries/${t}/fetch-content`),gs=async()=>R.get("/v1/me"),ys=async()=>R.get("/v1/feeds/counters"),qe=async()=>R.get("/v1/feeds"),Je=async()=>R.get("/v1/categories"),js=async t=>R.delete(`/v1/categories/${t}`),vs=async t=>R.post("/v1/categories",{title:t}),bs=async(t,s)=>R.put(`/v1/categories/${t}`,{title:s}),Cs=async(t,s,n,r,o)=>R.put(`/v1/feeds/${t}`,{feed_url:s,title:n,category_id:r,crawler:o}),ws=async t=>R.put(`/v1/feeds/${t}/refresh`),Es=async t=>R.delete(`/v1/feeds/${t}`),Ss=async(t,s,n)=>R.post("/v1/feeds",{feed_url:t,category_id:s,crawler:n}),ks=async(t=0,s=null)=>{const n=`/v1/entries?order=published_at&direction=desc&offset=${t}`,r=s?`${n}&status=${s}`:n;return R.get(r)},Xe=async(t=0)=>{const s=`/v1/entries?order=changed_at&direction=desc&status=read&offset=${t}`;return R.get(s)},Ze=async(t=0,s=null)=>{const n=`/v1/entries?order=published_at&direction=desc&starred=true&offset=${t}`,r=s?`${n}&status=${s}`:n;return R.get(r)},he=async(t=0,s=null,n=null)=>{let o=`/v1/entries?order=published_at&direction=desc&published_after=${ps()}&offset=${t}`;return s&&(o+=`&status=${s}`),n&&(o+=`&limit=${n}`),R.get(o)},X=t=>{const s=JSON.parse(localStorage.getItem("config"));if(!s)return console.log("No config found in localStorage"),null;const n=s[t];return typeof n>"u"?(console.log(`Config for "${t}" not found`),null):n},Q=(t,s)=>{const r={...JSON.parse(localStorage.getItem("config"))||{},[t]:s};localStorage.setItem("config",JSON.stringify(r))},Is=(t,s)=>s==="read"?Math.max(0,t-1):t+1,Ae=(t,s,n)=>t.map(r=>{if(r.id===s){let o;return typeof n=="string"?o=Is(r.unreadCount,n):o=n,{...r,unreadCount:o}}return r}),h=bt((t,s)=>({feeds:[],groups:[],unreadTotal:0,unreadToday:0,starredCount:0,readCount:0,loading:!0,visible:{settings:!1,addFeed:!1},theme:X("theme")||"system",layout:X("layout")||"large",fontSize:X("fontSize")||1.05,showFeedIcon:X("showFeedIcon")||!0,collapsed:window.innerWidth<=992,activeContent:null,isSysDarkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,color:X("themeColor")||"Blue",setUnreadTotal:n=>t(r=>({unreadTotal:n(r.unreadTotal)})),setUnreadToday:n=>t(r=>({unreadToday:n(r.unreadToday)})),setStarredCount:n=>t(r=>({starredCount:n(r.starredCount)})),setReadCount:n=>t(r=>({readCount:n(r.readCount)})),setActiveContent:n=>{t({activeContent:n})},setIsSysDarkMode:n=>t({isSysDarkMode:n}),setColor:n=>{t({color:n})},setTheme:n=>{t({theme:n})},initData:async()=>{t({loading:!0});const[n,r,o,i,l,d]=await Promise.all([qe(),Je(),ys(),Xe(),Ze(),he(0,"unread")]);if(n&&o&&r&&i&&l&&d){const p=o.data.unreads,y=Object.values(p).reduce((x,f)=>x+f,0);t({unreadTotal:y});const a=n.data.map(x=>({...x,unreadCount:p[x.id]||0}));t({feeds:a.sort((x,f)=>x.title.localeCompare(f.title,"en"))});const g=r.data.map(x=>{let f=0,C=0;for(const k of a)k.category.id===x.id&&(f+=k.unreadCount,C+=1);return{...x,unreadCount:f,feed:C}});t({groups:g.sort((x,f)=>x.title.localeCompare(f.title,"en"))}),t({readCount:i.data.total}),t({starredCount:l.data.total}),t({unreadToday:d.data.total}),t({loading:!1})}},updateFeedUnreadCount:(n,r)=>{t(o=>({feeds:Ae(o.feeds,n,r)}))},updateGroupUnreadCount:(n,r)=>{t(o=>({groups:Ae(o.groups,n,r)}))},toggleTheme:n=>{t({theme:n}),Q("theme",n)},toggleLayout:()=>{const n=s().layout==="large"?"small":"large";t({layout:n}),Q("layout",n)},setFontSize:n=>{t({fontSize:n}),Q("fontSize",n)},setShowFeedIcon:n=>{t({showFeedIcon:n}),Q("showFeedIcon",n)},setVisible:(n,r)=>{t(o=>({visible:{...o.visible,[n]:r}}))},setCollapsed:n=>{t({collapsed:n})}})),et=[{name:"Red",valueLight:"#F53F3F",valueDark:"#F76965"},{name:"Orange",valueLight:"#F77234",valueDark:"#F9925A"},{name:"Green",valueLight:"#00B42A",valueDark:"#27C346"},{name:"Blue",valueLight:"#165DFF",valueDark:"#3C7EFF"},{name:"Purple",valueLight:"#722ED1",valueDark:"#8E51DA"}];function ve(t){const s=et.find(i=>i.name===t),n=window.matchMedia("(prefers-color-scheme: dark)").matches,r=X("theme")||"light",o=r==="system"?n:r==="dark";return s?o?s.valueDark:s.valueLight:"#165DFF"}const me=t=>{Ct(ve(t),{list:!0}).map(n=>wt(n)).forEach((n,r)=>{document.body.style.setProperty(`--primary-${r+1}`,n)})},Fs=()=>{const t=ce(),s=h(d=>d.setVisible),n=h(d=>d.theme),r=h(d=>d.toggleTheme),o=h(d=>d.collapsed),i=h(d=>d.setCollapsed),l=()=>{localStorage.clear(),document.body.removeAttribute("arco-theme"),me("Blue"),t("/login"),F.success("logout")};return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",style:{marginLeft:"10px",display:"flex",alignItems:"center"},children:e.jsx(M,{shape:"circle",size:"small",className:"trigger",style:{marginRight:"5px",display:"none"},onClick:()=>i(!o),children:e.jsx(Et,{})})}),e.jsx("div",{className:"button-group",style:{marginRight:"10px"},children:e.jsxs(fe,{size:16,children:[e.jsx(z,{content:"Add feed",mini:!0,children:e.jsx(M,{shape:"circle",size:"small",type:"primary",icon:e.jsx(Me,{}),onClick:()=>s("addFeed",!0)})}),e.jsx(M,{shape:"circle",size:"small",icon:e.jsx(St,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(Ie,{droplist:e.jsx(H,{defaultSelectedKeys:[n],className:"theme-menu",children:["light","dark","system"].map(d=>e.jsxs(H.Item,{className:n===d?"selected-menu":"",onClick:()=>r(d),style:{display:"flex",width:100,justifyContent:"space-between",alignItems:"center"},children:[d.charAt(0).toUpperCase()+d.slice(1),n===d&&e.jsx(Ne,{style:{marginLeft:8}})]},d))}),trigger:"hover",position:"bottom",children:e.jsx(M,{shape:"circle",size:"small",icon:n==="dark"?e.jsx(kt,{}):n==="light"?e.jsx(It,{}):e.jsx(Ft,{})})}),e.jsx(Ie,{droplist:e.jsxs(H,{children:[e.jsxs(H.Item,{onClick:()=>s("settings",!0),children:[e.jsx(Tt,{style:{marginRight:8,fontSize:16,transform:"translateY(1px)"}}),"Settings"]},"0"),e.jsxs(H.Item,{onClick:l,children:[e.jsx(At,{style:{marginRight:8,fontSize:16,transform:"translateY(1px)"}}),"Logout"]},"1")]}),trigger:"click",position:"br",children:e.jsx(De,{size:28,style:{cursor:"pointer"},children:e.jsx(Pe,{})})})]})})]})},Ts="/assets/dark-E0XitTFg.png",As="/assets/light-CsqESGYr.png",Rs="data:image/png;base64,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",Ls=()=>{const t=h(a=>a.theme),s=h(a=>a.setTheme),n=h(a=>a.toggleLayout),r=h(a=>a.layout),o=h(a=>a.fontSize),i=h(a=>a.setFontSize),l=h(a=>a.showFeedIcon),d=h(a=>a.setShowFeedIcon),p=h(a=>a.color),y=h(a=>a.setColor);return e.jsxs(e.Fragment,{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Theme"}),e.jsx(b.Text,{type:"secondary",children:"Customize your UI theme"}),e.jsx("div",{children:e.jsx(ie.Group,{name:"card-radio-group",style:{marginTop:"16px"},defaultValue:t,onChange:a=>{s(a),Q("theme",a)},children:["light","dark","system"].map(a=>e.jsx(z,{content:a.charAt(0).toUpperCase()+a.slice(1),children:e.jsx(ie,{value:a,children:({checked:g})=>e.jsx("div",{className:`custom-radio-card ${g?"custom-radio-card-checked":""}`,children:e.jsx("img",{className:"theme-preview",src:a==="light"?As:a==="dark"?Ts:Rs,alt:a})})})},a))})}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Accent color"}),e.jsx(b.Text,{type:"secondary",children:"Choose your accent color"})]}),e.jsx("div",{style:{display:"flex"},children:et.map(a=>e.jsx(z,{content:a.name,children:e.jsx("button",{type:"button",style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:ve(a.name),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:a.name===p?`1px solid ${ve(a.name)}`:"none"},onClick:()=>{y(a.name),Q("themeColor",a.name),me(a.name)},onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(y(a.name),Q("themeColor",a.name),me(a.name))}})},a.name))})]}),e.jsx(K,{}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Compact article list"}),e.jsx(b.Text,{type:"secondary",children:"Use small thumbnail in article list"})]}),e.jsx("div",{children:e.jsx(pe,{checked:r==="small",onChange:()=>n()})})]}),e.jsx(K,{}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Show feed icon"}),e.jsx(b.Text,{type:"secondary",children:"Show feed icon in feed list and article list"})]}),e.jsx("div",{children:e.jsx(pe,{checked:l,onChange:()=>d(!l)})})]}),e.jsx(K,{}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(b.Title,{heading:6,style:{marginTop:0},children:"Font size"}),e.jsx(b.Text,{type:"secondary",children:"Adjust article text size"})]}),e.jsx("div",{children:e.jsxs(fe,{children:[e.jsx(b.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(Rt,{value:o,showTicks:!0,min:.75,max:1.25,step:.05,formatTooltip:a=>`${a}rem`,onChange:i,style:{width:200}}),e.jsx(b.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]})]})},Z=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),tt=(t,s,n,r)=>s==="0"?n==="all"?t.filter(o=>Z(o.title,r)):t.filter(o=>Z(o.title,r)&&o.status===n):n==="all"?t.filter(o=>Z(o.content,r)):t.filter(o=>Z(o.content,r)&&o.status===n),Re=t=>t.slice().sort((s,n)=>s.parsing_error_count>0&&n.parsing_error_count===0?-1:s.parsing_error_count===0&&n.parsing_error_count>0?1:0),Ms=({feeds:t,groups:s,loading:n,setFeeds:r,setShowFeeds:o,showFeeds:i})=>{const l=h(c=>c.initData),[d,p]=u.useState(!1),[y,a]=u.useState(!1),[g]=D.useForm(),[x,f]=u.useState({}),[C,k]=u.useState(window.innerWidth);let T=Re(i);const P=T.map(c=>({key:c.id,title:c.title,feed_url:c.feed_url,category:c.category,checked_at:c.checked_at,parsing_error_count:c.parsing_error_count,feed:c}));u.useEffect(()=>{const c=()=>k(window.innerWidth);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]);const E=c=>{f(c.feed),p(!0),g.setFieldsValue({url:c.feed.feed_url,title:c.feed.title,group:c.feed.category.id,crawler:c.feed.crawler})},m=async c=>{ws(c.feed.id).then(()=>{F.success("Refreshed"),c.feed.parsing_error_count=0,l()}).catch(()=>{F.error("Failed to refresh"),c.feed.parsing_error_count++}).finally(()=>{r(t),T=Re(T),o(T)})},A=async c=>{Es(c.feed.id).then(()=>{F.success("Unfollowed"),r(t.filter(S=>S.id!==c.feed.id)),o(T.filter(S=>S.id!==c.feed.id)),l()})},I=C<=700,j=[{title:"Title",dataIndex:"title",sorter:(c,S)=>c.title.localeCompare(S.title,"en"),render:(c,S)=>{const O=S.parsing_error_count>0?`⚠️ ${c}`:c,_=S.parsing_error_count>0?`${c} ⚠️ Parsing error count: ${S.parsing_error_count}`:c;return e.jsx(b.Ellipsis,{expandable:!1,children:e.jsx(z,{mini:!0,content:_,position:"left",children:O})})}},!I&&{title:"Url",dataIndex:"feed_url",sorter:(c,S)=>c.feed_url.localeCompare(S.feed_url,"en"),render:c=>e.jsx(b.Ellipsis,{expandable:!1,children:e.jsx(z,{mini:!0,content:c,position:"left",children:c})})},{title:"Group",dataIndex:"category.title",sorter:(c,S)=>c.category.title.localeCompare(S.category.title,"en"),render:c=>e.jsx(le,{children:c})},!I&&{title:"Checked at",dataIndex:"checked_at",sorter:(c,S)=>c.checked_at.localeCompare(S.checked_at,"en"),render:c=>e.jsx(b.Ellipsis,{expandable:!1,showTooltip:!0,children:Ce(c)})},{title:"Actions",dataIndex:"op",fixed:"right",width:100,render:(c,S)=>e.jsxs(fe,{children:[e.jsx("button",{"aria-label":"Edit this feed",className:"list-item-action",onClick:()=>E(S),type:"button",children:e.jsx(Lt,{})}),e.jsx("button",{"aria-label":"Refresh this feed",className:"list-item-action",onClick:()=>m(S),type:"button",children:e.jsx(Mt,{})}),e.jsx(Be,{position:"left",focusLocka:!0,title:"Unfollow？",onOk:async()=>{await A(S)},children:e.jsx("span",{className:"list-item-action",children:e.jsx(Nt,{})})})]})}].filter(Boolean),w=async(c,S,O,_,L)=>{a(!0),Cs(c,S,O,_,L).then(de=>{r(t.map(W=>W.id===c?de.data:W)),o(T.map(W=>W.id===c?de.data:W)),F.success("Feed updated successfully"),p(!1),l()}).catch(()=>{F.error("Failed to update feed")}),a(!1),g.resetFields()};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(U.Search,{searchButton:!0,placeholder:"Search feed title or url",onChange:c=>o(T.filter(S=>Z(S.title,c)||Z(S.feed_url,c))),style:{width:300,marginBottom:"24px"}})}),e.jsx(Ue,{columns:j,data:P,loading:n,pagePosition:"bottomCenter",scroll:{x:!0},size:"small",style:{width:"100%"},borderCell:!0}),x&&e.jsx(ge,{title:"Edit Feed",visible:d,unmountOnExit:!0,onOk:g.submit,style:{width:"400px"},confirmLoading:y,onCancel:()=>{p(!1),g.resetFields()},children:e.jsxs(D,{form:g,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:c=>{c.url.trim()?w(x.id,c.url,c.title,c.group,c.crawler):F.error("Feed URL cannot be empty")},children:[e.jsx(D.Item,{label:"Feed URL",field:"url",rules:[{required:!0}],children:e.jsx(U,{placeholder:"Please input feed URL"})}),e.jsx(D.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(U,{placeholder:"Please input feed title"})}),e.jsx(D.Item,{label:"Group",required:!0,field:"group",rules:[{required:!0}],children:e.jsx($,{placeholder:"Please select",children:s.map(c=>e.jsx($.Option,{value:c.id,children:c.title},c.id))})}),e.jsx(D.Item,{label:"Fetch original content",field:"crawler",tooltip:e.jsx("div",{children:"Only affects newly retrieved articles"}),style:{marginBottom:0},triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(pe,{})})]})})]})},Ns=({groups:t,loading:s,setGroups:n})=>{const r=h(E=>E.initData),[o,i]=u.useState(!1),[l,d]=u.useState(""),[p,y]=u.useState(!1),[a,g]=u.useState(!1),[x]=D.useForm(),[f,C]=u.useState({}),k=async()=>{l&&vs(l).then(E=>{n(m=>[...m,{...E.data,feedCount:0}]),d(""),F.success("Group added successfully"),r()}).catch(()=>{F.error("Failed to add group")}),d(""),i(!1)},T=async(E,m)=>{g(!0),bs(E,m).then(A=>{n(t.map(I=>I.id===E?A.data:I)),F.success("Group updated successfully"),y(!1),r()}).catch(()=>{F.error("Failed to update group")}),g(!1),x.resetFields()},P=async E=>{js(E).then(m=>{m.status===204?(n(t.filter(A=>A.id!==E)),F.success("Group deleted successfully"),r()):F.error("Failed to delete group")}).catch(()=>{F.error("Failed to delete group")})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs(ee,{loading:s,animation:!0,text:{rows:3},children:[t.map(E=>e.jsx(le,{size:"medium",closable:E.feedCount===0,onClick:()=>{C(E),y(!0),x.setFieldsValue({title:E.title})},onClose:async m=>{m.stopPropagation(),await P(E.id)},style:{marginRight:"10px",marginBottom:"10px",cursor:"pointer"},children:E.title},E.id)),o?e.jsx(U,{autoFocus:!0,size:"small",value:l,style:{width:84},onPressEnter:k,onBlur:k,onChange:d}):e.jsx(le,{icon:e.jsx(Me,{}),style:{width:84,backgroundColor:"var(--color-fill-2)",border:"1px dashed var(--color-fill-3)",cursor:"pointer"},size:"medium",className:"add-group",tabIndex:0,onClick:()=>i(!0),children:"Add"})]})}),f&&e.jsx(ge,{title:"Edit Group",visible:p,unmountOnExit:!0,style:{width:"400px"},onOk:x.submit,confirmLoading:a,onCancel:()=>{y(!1),x.resetFields()},children:e.jsx(D,{form:x,layout:"vertical",onSubmit:E=>T(f.id,E.title),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:e.jsx(D.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(U,{placeholder:"Please input group title"})})})})]})},Ds=[{title:"Key",dataIndex:"keyName",render:t=>e.jsx(le,{children:t})},{title:"Function",dataIndex:"description"}],Ps=[{key:"1",keyName:"Esc",description:"Dismiss article"},{key:"2",keyName:"←",description:"Previous article"},{key:"3",keyName:"→",description:"Next article"},{key:"4",keyName:"B",description:"Open link externally"},{key:"5",keyName:"D",description:"Fetch original article"},{key:"6",keyName:"M",description:"Mark as read / unread"},{key:"7",keyName:"S",description:"Star / Unstar"}],Us=()=>e.jsx(Ue,{columns:Ds,data:Ps,pagination:!1,size:"small"}),Bs=()=>{const[t,s]=u.useState([]),[n,r]=u.useState([]),[o,i]=u.useState([]),[l,d]=u.useState(!1),p=async()=>{d(!0);const y=await qe(),a=await Je();if(y&&a){const g=y.data,x=a.data.map(C=>({...C,feedCount:g.filter(k=>k.category.id===C.id).length})),f=g.sort((C,k)=>C.title.localeCompare(k.title,"en"));s(f),r(x.sort((C,k)=>C.title.localeCompare(k.title,"en"))),i(f),d(!1)}};return u.useEffect(()=>{p()},[]),e.jsxs(oe,{defaultActiveTab:"1",tabPosition:"top",children:[e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Dt,{style:{marginRight:6}}),"Feeds"]}),children:e.jsx(Ms,{feeds:t,groups:n,loading:l,setFeeds:s,setShowFeeds:i,showFeeds:o})},"1"),e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Pt,{style:{marginRight:6}}),"Groups"]}),children:e.jsx(Ns,{groups:n,loading:l,setGroups:r})},"2"),e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Ut,{style:{marginRight:6}}),"Appearance"]}),children:e.jsx(Ls,{})},"3"),e.jsx(oe.TabPane,{title:e.jsxs("span",{children:[e.jsx(Bt,{style:{marginRight:6}}),"Hotkeys"]}),children:e.jsx(Us,{})},"4")]})},zs=({activeContent:t,setActiveContent:s,setVisible:n,visible:r})=>{const[o,i]=u.useState("720px"),[l,d]=u.useState("10%");return u.useEffect(()=>{const p=()=>{const y=window.innerWidth<=700?"100%":"720px",a=window.innerWidth<=700?"5%":"10%";i(y),d(a)};return window.addEventListener("resize",p),p(),()=>{window.removeEventListener("resize",p)}},[]),e.jsx(ge,{visible:r.settings,alignCenter:!1,title:"Settings",footer:null,unmountOnExit:!0,style:{width:o,top:l},onFocus:()=>{t&&s(null)},onCancel:()=>n("settings",!1),autoFocus:!1,focusLock:!0,children:e.jsx(Bs,{})})},Gs=({activeContent:t,setActiveContent:s,setVisible:n,visible:r})=>{const o=h(a=>a.initData),i=h(a=>a.groups),[l,d]=u.useState(!1),[p]=D.useForm(),y=async(a,g,x)=>{d(!0),Ss(a,g,x).then(()=>{o(),F.success("Added a feed successfully"),n("addFeed",!1)}).catch(()=>{F.error("Failed to add a feed")}),d(!1),p.resetFields()};return e.jsx(ge,{title:"Add Feed",visible:r.addFeed,unmountOnExit:!0,style:{width:"400px"},onFocus:()=>{t&&s(null)},onOk:p.submit,confirmLoading:l,onCancel:()=>{n("addFeed",!1),p.resetFields()},children:e.jsxs(D,{form:p,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:a=>{a.url.trim()?y(a.url.trim(),a.group,a.crawler):F.error("Feed URL cannot be empty")},children:[e.jsx(D.Item,{label:"Feed URL",field:"url",rules:[{required:!0}],children:e.jsx(U,{placeholder:"Please input feed URL"})}),e.jsx(D.Item,{label:"Group",required:!0,field:"group",rules:[{required:!0}],children:e.jsx($,{placeholder:"Please select",children:i.map(a=>e.jsx($.Option,{value:a.id,children:a.title},a.id))})}),e.jsx(D.Item,{label:"Fetch original content",initialValue:!1,field:"crawler",style:{marginBottom:0},triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(pe,{})})]})})},Ys=()=>{const t=h(l=>l.visible),s=h(l=>l.setVisible),n=h(l=>l.activeContent),r=h(l=>l.setActiveContent),[o,i]=u.useState(0);return u.useEffect(()=>{const l=()=>{const d=document.querySelector(".entry-panel"),p=d?d.offsetHeight:49,y=window.innerHeight;i(y-p)};return window.addEventListener("resize",l),l(),()=>window.removeEventListener("resize",l)},[]),e.jsxs("div",{className:"main",style:{height:`${o}px`},children:[e.jsx(zt,{}),e.jsx(zs,{activeContent:n,setActiveContent:r,setVisible:s,visible:t}),e.jsx(Gs,{activeContent:n,setActiveContent:r,setVisible:s,visible:t})]})},st=t=>{const s=new URL(t);return`${s.protocol}//${s.hostname}`},ae=H.Item,{Sider:_s}=Ht,Vs=({group:t,isOpen:s})=>e.jsxs("div",{className:"group-title",children:[e.jsxs(b.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:t.unreadCount?"80%":"100%"},children:[s?e.jsx(Ot,{}):e.jsx(Wt,{}),t.title]}),t.unreadCount>0&&e.jsx(b.Ellipsis,{className:"unread-count",expandable:!1,showTooltip:!0,children:t.unreadCount})]}),Hs=()=>{const t=Gt(),s=ce(),n=h(m=>m.collapsed),r=h(m=>m.feeds),o=h(m=>m.groups),i=h(m=>m.loading),l=h(m=>m.unreadTotal),d=h(m=>m.unreadToday),p=h(m=>m.starredCount),y=h(m=>m.readCount),a=h(m=>m.showFeedIcon),g=h(m=>m.setCollapsed),[x,f]=u.useState([]),[C,k]=u.useState([]),T=t.pathname,P=(m,A)=>{k(A)},E=r.reduce((m,A)=>{ze(A.site_url)||(A.site_url=st(A.feed_url));const{id:I}=A.category;return m[I]=m[I]||[],m[I].push(A),m},{});return u.useEffect(()=>{f([T]),n||window.innerWidth<=992&&g(!0)},[T]),u.useEffect(()=>{i||k([])},[i]),e.jsx(_s,{className:"sidebar",trigger:null,width:240,collapsedWidth:0,breakpoint:"lg",onCollapse:g,collapsed:n,collapsible:!0,style:{height:"100%",borderRight:n?"none":"1px solid var(--color-border-2)",position:"fixed",top:0,zIndex:999},children:e.jsxs(H,{autoScrollIntoView:!0,collapse:n,defaultSelectedKeys:[T],hasCollapseButton:!0,onClickSubMenu:P,onCollapseChange:()=>g(!n),selectedKeys:x,style:{width:"240px",height:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"0 28px 0 10px",height:"48px",marginTop:"-4px",visibility:n?"hidden":"visible"},children:[e.jsx(De,{size:32,style:{marginRight:"10px",backgroundColor:"var(--color-text-1)"},children:e.jsx(Ge,{style:{color:"var(--color-bg-1)"}})}),e.jsx(b.Title,{heading:6,style:{margin:"0"},children:"ReactFlux"})]}),e.jsx(K,{style:{marginTop:0,marginBottom:"4px"}}),e.jsx(b.Title,{heading:6,style:{fontStyle:"italic",color:"var(--color-text-3)"},children:"Articles"}),e.jsx(ee,{loading:i,animation:!0,text:{rows:3}}),i?null:e.jsxs("div",{children:[e.jsx(ae,{onClick:()=>s("/"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(Yt,{}),"All"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:l||""})]})},"/"),e.jsx(ae,{onClick:()=>s("/today"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(_t,{}),"Today"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:d||""})]})},"/today"),e.jsx(ae,{onClick:()=>s("/starred"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(be,{}),"Starred"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:p||""})]})},"/starred"),e.jsx(ae,{onClick:()=>s("/history"),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(Vt,{}),"History"]}),e.jsx(b.Ellipsis,{className:"item-count",expandable:!1,showTooltip:!0,children:y||""})]})},"/history")]}),e.jsx(b.Title,{heading:6,style:{fontStyle:"italic",color:"var(--color-text-3)"},children:"Feeds"}),e.jsx(ee,{loading:i,animation:!0,text:{rows:6}}),i?null:o.map(m=>{var A;return e.jsx(H.SubMenu,{selectable:!0,title:e.jsx(Vs,{group:m,isOpen:C.includes(`/group/${m.id}`)}),onClick:I=>{f([`/group/${m.id}`]),!(I.target.tagName==="svg"||I.target.tagName==="path")&&T!==`/group/${m.id}`&&s(`/group/${m.id}`)},children:(A=E[m.id])==null?void 0:A.map(I=>e.jsx(ae,{onClick:j=>{j.stopPropagation(),f([`/group/${m.id}`]),s(`/feed/${I.id}`)},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(b.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:I.unreadCount!==0?"80%":"100%"},children:[a&&e.jsx("img",{src:`https://icons.duckduckgo.com/ip3/${new URL(I.site_url).hostname}.ico`,alt:"Icon",style:{marginRight:"8px",width:"16px",height:"16px"}}),I.title]}),I.unreadCount!==0&&e.jsx(b.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:"20%",color:"var(--color-text-4)",display:"flex",justifyContent:"flex-end"},children:I.unreadCount})]})},`/feed/${I.id}`))},`/group/${m.id}`)})]})})},Os=()=>{const t=h(i=>i.initData),s=h(i=>i.theme),n=h(i=>i.isSysDarkMode),r=h(i=>i.setIsSysDarkMode),o=h(i=>i.color);return u.useEffect(()=>{t();const i=l=>{r(l.matches)};return window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",l=>{i(l)}),()=>{window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",l=>{i(l)})}},[]),u.useEffect(()=>{(s==="system"?n:s==="dark")?(document.body.setAttribute("arco-theme","dark"),document.body.style.colorScheme="dark"):(document.body.removeAttribute("arco-theme"),document.body.style.colorScheme="light")},[n,s]),u.useEffect(()=>{me(o)},[o,n,s]),e.jsxs("div",{className:"app",style:{display:"flex",backgroundColor:"var(--color-bg-1)"},children:[e.jsx(Fs,{}),e.jsx(Hs,{}),e.jsx(Ys,{})]})},Y=u.createContext(null),te=({children:t})=>{const[s,n]=u.useState(0),[r,o]=u.useState(0),[i,l]=u.useState(0),[d,p]=u.useState(!1),[y,a]=u.useState(!1),[g,x]=u.useState([]),[f,C]=u.useState([]),[k,T]=u.useState("all"),[P,E]=u.useState("0"),[m,A]=u.useState(""),[I,j]=u.useState(!0),w=u.useMemo(()=>({entries:g,filteredEntries:f,filterStatus:k,filterString:m,filterType:P,loading:I,loadMoreUnreadVisible:y,loadMoreVisible:d,offset:i,setEntries:x,setFilteredEntries:C,setFilterStatus:T,setFilterString:A,setFilterType:E,setLoading:j,setLoadMoreUnreadVisible:a,setLoadMoreVisible:p,setOffset:l,setTotal:n,setUnreadCount:o,total:s,unreadCount:r}),[g,f,k,m,P,I,y,d,i,s,r]);return e.jsx(Y.Provider,{value:w,children:t})},we=()=>{const t=h(j=>j.setUnreadTotal),s=h(j=>j.setUnreadToday),n=h(j=>j.setReadCount),r=h(j=>j.setStarredCount),o=h(j=>j.activeContent),i=h(j=>j.setActiveContent),l=h(j=>j.updateFeedUnreadCount),d=h(j=>j.updateGroupUnreadCount),{entries:p,filteredEntries:y,setEntries:a,setFilteredEntries:g,setUnreadCount:x}=u.useContext(Y),f=(j,w,c)=>j.map(S=>S.id===w.id?c(S):S),C=(j,w,c)=>{i({...j,...w}),a(f(p,j,c)),g(f(y,j,c))},k=(j,w)=>{const{feed:c}=j,S=c.id,O=c.category.id,_=hs(j.published_at);l(S,w),d(O,w),w==="read"?(t(L=>Math.max(0,L-1)),x(L=>Math.max(0,L-1)),n(L=>L+1),_&&s(L=>Math.max(0,L-1))):(t(L=>L+1),x(L=>L+1),n(L=>Math.max(0,L-1)),_&&s(L=>L+1)),C(j,{status:w},L=>({...L,status:w}))},T=(j,w)=>{w?(r(c=>c+1),Kt({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):r(c=>Math.max(0,c-1)),C(j,{starred:w},c=>({...c,starred:w}))},P=async()=>{const j=o.status,w=j==="read"?"unread":"read";k(o,w),$e(o.id,w).catch(()=>{F.error(`Failed to mark entry as ${w}, please try again later`),k(o,j)})},E=async()=>{const{id:j}=o,w=!o.starred;T(o,w),ms(j).catch(()=>{F.error(`Failed to ${w?"star":"unstar"} entry, please try again later`),T(o,!w)})};return{handleEntryStatusUpdate:k,handleFetchContent:async()=>{fs(o.id).then(j=>{F.success("Fetched content successfully"),i({...o,content:j.data.content})}).catch(()=>{F.error("Failed to fetch content, please try again later")})},toggleEntryStarred:()=>{E()},toggleEntryStatus:()=>{P()}}},Ee=()=>{const{filteredEntries:t}=u.useContext(Y),s=h(a=>a.activeContent),n=h(a=>a.setActiveContent);return{handleEscapeKey:a=>{s&&(n(null),a.current&&(a.current.setAttribute("tabIndex","-1"),a.current.focus()))},handleLeftKey:a=>{const g=t.findIndex(x=>x.id===(s==null?void 0:s.id));if(g>0){const x=t[g-1];a(x);const f=document.querySelector(".card-custom-selected-style");f&&f.scrollIntoView({behavior:"smooth",block:"end"})}},handleRightKey:a=>{const g=t.findIndex(x=>x.id===(s==null?void 0:s.id));if(g<t.length-1){const x=t[g+1];a(x);const f=document.querySelector(".card-custom-selected-style");f&&f.scrollIntoView({behavior:"smooth",block:"start"})}},handleBKey:()=>{s&&window.open(s.url,"_blank")},handleDKey:a=>{s&&a()},handleMKey:a=>{s&&a()},handleSKey:a=>{s&&a()}}},nt=()=>{const{entries:t,filterStatus:s,filterString:n,filterType:r,offset:o,setEntries:i,setFilteredEntries:l,setLoadMoreUnreadVisible:d,setLoadMoreVisible:p,setOffset:y,total:a,unreadCount:g}=u.useContext(Y),[x,f]=u.useState(!1),C=T=>{const m=new DOMParser().parseFromString(T.content,"text/html").querySelector("img");return m&&(T.imgSrc=m.getAttribute("src")),T};return{getFirstImage:C,handleLoadMore:async T=>{var P;f(!0);try{const E=await T(o+100);if((P=E==null?void 0:E.data)!=null&&P.entries){y(w=>w+100);const m=E.data.entries.map(C),A=[...new Map([...t,...m].map(w=>[w.id,w])).values()];i(A);const I=s==="all"?A:A.filter(w=>w.status==="unread"),j=n?tt(I,r,s,n):I;l(j),p(A.length<a),d(I.length<g&&s==="unread")}}catch(E){console.error("Error fetching more articles:",E)}f(!1)},loadingMore:x}},Ws=({handleEntryClick:t})=>{const s=h(y=>y.activeContent),{handleFetchContent:n,toggleEntryStarred:r,toggleEntryStatus:o}=we(),{handleLeftKey:i,handleRightKey:l}=Ee();if(!s)return null;const d=s.status==="unread",p=s.starred;return e.jsx("div",{className:"action-buttons",style:{position:"fixed",bottom:"20px",right:"10px",borderRadius:"50%",boxShadow:"0 4px 10px rgba(var(--primary-6), 0.4)"},children:e.jsxs(fe,{size:0,direction:"vertical",children:[e.jsx(z,{mini:!0,position:"left",content:d?"Mark as Read":"Mark as Unread",children:e.jsx(M,{type:"primary",size:"mini",style:{borderBottom:"1px solid rgb(var(--primary-5))",borderRadius:"50% 50% 0 0"},onClick:o,icon:d?e.jsx(Ye,{}):e.jsx(_e,{})})}),e.jsx(z,{mini:!0,position:"left",content:p?"Unstar":"Star",children:e.jsx(M,{type:"primary",size:"mini",style:{borderRadius:"0"},onClick:r,icon:p?e.jsx(ye,{style:{color:"#ffcd00"}}):e.jsx(be,{})})}),e.jsx(z,{mini:!0,position:"left",content:"Fetch original article",children:e.jsx(M,{type:"primary",size:"mini",style:{borderTop:"1px solid rgb(var(--primary-5))",borderRadius:"0"},onClick:n,icon:e.jsx(Ve,{})})}),e.jsx(z,{mini:!0,position:"left",content:"Previous Article",children:e.jsx(M,{type:"primary",size:"mini",style:{borderTop:"1px solid rgb(var(--primary-5))",borderRadius:"0"},onClick:()=>i(t),icon:e.jsx(He,{})})}),e.jsx(z,{mini:!0,position:"left",content:"Next Article",children:e.jsx(M,{type:"primary",size:"mini",style:{borderTop:"1px solid rgb(var(--primary-5))",borderRadius:"0 0 50% 50%"},onClick:()=>l(t),icon:e.jsx(Oe,{})})})]})})},Ks=({handleEntryClick:t})=>{const s=h(a=>a.activeContent),{handleFetchContent:n,toggleEntryStarred:r,toggleEntryStatus:o}=we(),{handleLeftKey:i,handleRightKey:l,handleEscapeKey:d}=Ee();if(!s)return null;const p=s.status==="unread",y=s.starred;return e.jsxs(M.Group,{className:"action-buttons-mobile",style:{display:"none",justifyContent:"center",position:"fixed",bottom:"40px",left:"50%",transform:"translateX(-50%)",borderRadius:"50%",boxShadow:"0 4px 10px rgba(var(--primary-6), 0.4)"},children:[e.jsx(M,{type:"primary",shape:"round",onClick:()=>d(t),icon:e.jsx(Qt,{})}),e.jsx(M,{type:"primary",onClick:()=>o(),icon:p?e.jsx(Ye,{}):e.jsx(_e,{})}),e.jsx(M,{type:"primary",onClick:()=>r(),icon:y?e.jsx(ye,{style:{color:"#ffcd00"}}):e.jsx(be,{})}),e.jsx(M,{type:"primary",onClick:()=>n(),icon:e.jsx(Ve,{})}),e.jsx(M,{type:"primary",onClick:()=>i(t),icon:e.jsx(He,{})}),e.jsx(M,{type:"primary",shape:"round",onClick:()=>l(t),icon:e.jsx(Oe,{})})]})},Qs=({url:t,text:s})=>{const[n,r]=u.useState(!1);return e.jsx(Xt,{to:t,style:{color:"inherit",textDecoration:n?"underline":"none"},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:s})},$s={replace:t=>{var r,o;const s=t.name==="a"&&((o=(r=t.children)==null?void 0:r[0])==null?void 0:o.name)==="img",n=t.name==="img";if(s||n){const i=s?t.children[0]:t,{src:l,alt:d}=i.attribs;return e.jsx(Zt,{src:l,children:e.jsx("img",{src:l,alt:d})})}}},qs=u.forwardRef((t,s)=>{const n=ce(),r=h(p=>p.activeContent),o=h(p=>p.fontSize);if(!r)return e.jsxs("div",{ref:s,className:"content-empty",style:{display:"flex",flexDirection:"column",backgroundColor:"var(--color-fill-1)",color:"var(--color-text-3)",alignItems:"center",justifyContent:"center",flex:"1",padding:"40px 16px"},children:[e.jsx($t,{style:{fontSize:"64px"}}),e.jsx(b.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const i=qt(r.content,$s),l=r.feed.category.id,d=r.feed.category.title;return e.jsxs("div",{ref:s,className:"article-content",style:{padding:"40px 5%",flex:"1",overflowY:"auto",overflowX:"hidden"},children:[e.jsxs("div",{className:"article-title",style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsx(b.Title,{heading:3,style:{margin:0},children:e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",children:r.title})}),e.jsx(b.Text,{style:{color:"var(--color-text-3)",fontSize:"0.75 rem"},children:e.jsx(Qs,{url:`/feed/${r.feed.id}`,text:r.feed.title})}),e.jsx(b.Text,{style:{color:"var(--color-text-3)",fontSize:"0.75 rem"},children:` - ${r.author}`}),e.jsx(b.Text,{children:e.jsx(le,{size:"small",onClick:()=>{n(`/group/${l}`)},style:{marginLeft:"10px",cursor:"pointer"},children:d})}),e.jsx("br",{}),e.jsxs(b.Text,{style:{color:"var(--color-text-3)",fontSize:"0.75 rem"},children:[q(r.published_at).format("MMMM D, YYYY")," AT"," ",q(r.published_at).format("hh:mm")]}),e.jsx(K,{})]}),e.jsx("div",{className:"article-body",style:{fontSize:`${o}rem`,maxWidth:"600px",margin:"0 auto",overflowWrap:"break-word"},children:e.jsx(Jt,{maskOpacity:.7,children:i})},r.id)]})}),rt=({src:t,alt:s,width:n,height:r,status:o,borderRadius:i})=>{const[l,d]=u.useState(!1),p=u.useRef(null);return u.useEffect(()=>{const y=new IntersectionObserver(g=>{for(const x of g)if(x.isIntersecting){const f=new Image;f.onload=()=>d(!0),f.src=t,p.current&&y.unobserve(p.current)}}),a=p.current;return a&&y.observe(a),()=>y.disconnect()},[t]),e.jsxs("div",{className:"image-container",ref:p,children:[!l&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(ee,{text:{rows:0},image:{style:{width:n,height:r,margin:"0",borderRadius:i}},animation:!0})}),l&&e.jsx("img",{className:o!=="unread"?"read":"",src:t,alt:s,style:{width:n,height:r,objectFit:"cover",borderRadius:i}})]})},Js=({url:t})=>e.jsx("img",{className:"feed-icon",src:`https://icons.duckduckgo.com/ip3/${new URL(t).hostname}.ico`,alt:"Icon"}),Xs=({entry:t,showFeedIcon:s})=>e.jsxs("div",{children:[e.jsx(b.Text,{className:t.status==="unread"?"title-unread":"title-read",children:t.title}),e.jsxs(b.Text,{className:"article-info",children:[e.jsx("br",{}),s&&e.jsx(Js,{url:t.feed.site_url}),t.feed.title,e.jsx("br",{}),Ce(t.published_at)]}),t.starred&&e.jsx(ye,{className:"icon-starred"})]}),Zs=({entry:t,handleEntryClick:s})=>{const n=h(d=>d.activeContent),r=h(d=>d.showFeedIcon),o=n&&t.id===n.id,i=()=>s(t),l=t.imgSrc?e.jsx("div",{className:"cover-image",children:e.jsx(rt,{width:"100%",height:"160px",alt:t.id,src:t.imgSrc,status:t.status})}):null;return e.jsx("div",{className:"article-card",children:e.jsx(J,{className:We("card-custom-hover-style",{"card-custom-selected-style":o}),hoverable:!0,"data-entry-id":t.id,style:{width:"100%",cursor:"pointer"},onClick:i,cover:l,children:e.jsx(J.Meta,{description:e.jsx(Xs,{entry:t,showFeedIcon:r})})})},t.id)},en=({url:t})=>e.jsx("img",{className:"feed-icon-mini",src:`https://icons.duckduckgo.com/ip3/${new URL(t).hostname}.ico`,alt:"Icon"}),tn=({entry:t,showFeedIcon:s})=>e.jsxs("div",{style:{display:"flex",paddingLeft:s?"22px":"0"},children:[e.jsxs("div",{style:{marginRight:"10px",flex:1},children:[e.jsx(b.Text,{className:t.status==="unread"?"title-unread":"title-read",children:t.title}),e.jsxs(b.Text,{className:"article-info",children:[e.jsx("br",{}),s&&e.jsx(en,{url:t.feed.site_url}),t.feed.title,e.jsx("br",{}),Ce(t.published_at)]}),t.starred&&e.jsx(ye,{className:"icon-starred"})]}),t.imgSrc&&e.jsx("div",{className:"thumbnail",children:e.jsx(rt,{width:"100px",height:"100px",alt:t.id,src:t.imgSrc,status:t.status,borderRadius:"4px"})})]}),sn=({entry:t,handleEntryClick:s})=>{const n=h(l=>l.activeContent),r=h(l=>l.showFeedIcon),o=n&&t.id===n.id,i=()=>s(t);return e.jsx("div",{className:"article-card",children:e.jsx(J,{className:We("card-custom-hover-style",{"card-custom-selected-style":o}),hoverable:!0,"data-entry-id":t.id,style:{width:"100%",cursor:"pointer"},onClick:i,cover:null,children:e.jsx(J.Meta,{description:e.jsx(tn,{entry:t,showFeedIcon:r})})})},t.id)},nn=({loading:t})=>{const s=h(o=>o.layout),n=s==="large"?2:4,r=o=>e.jsx(J,{style:{width:"100%",marginBottom:"10px"},cover:s==="large"&&e.jsx(ee,{loading:t,animation:!0,text:{rows:0},image:{style:{width:"100%",height:160}}}),children:e.jsx(J.Meta,{description:e.jsx(ee,{loading:t,animation:!0,text:{rows:3,width:150}})})},o);return t?Array.from({length:n},(o,i)=>r(i)):null},ot=()=>{const{entries:t,filteredEntries:s,filterStatus:n,filterString:r,filterType:o,loadMoreUnreadVisible:i,setFilteredEntries:l,setFilterStatus:d,setFilterString:p,setFilterType:y,setLoadMoreUnreadVisible:a,unreadCount:g}=u.useContext(Y);return u.useEffect(()=>{l([]);const f=tt(t,o,n,r);if(l(f),n==="unread"){const C=t.filter(k=>k.status==="unread");a(C.length<g)}},[n,r,o,i]),{filteredEntries:s,handleFilter:(f,C,k)=>{y(f),d(C),p(k)},loadMoreUnreadVisible:i}},rn=()=>{const{filterStatus:t,filterString:s,filterType:n}=u.useContext(Y),r=h(l=>l.activeContent),o=h(l=>l.setActiveContent),{handleFilter:i}=ot();return e.jsx(U.Search,{allowClear:!0,placeholder:"Search...",value:s,addBefore:e.jsxs($,{placeholder:"Select type",onChange:l=>{i(l,t,s)},style:{width:100},value:n,children:[e.jsx($.Option,{value:"0",children:"Title"}),e.jsx($.Option,{value:"1",children:"Content"})]}),onFocus:()=>r&&o(null),onChange:l=>i(n,t,l),style:{marginBottom:"10px",width:"100%"}})},on=u.forwardRef(({loading:t,getEntries:s,handleEntryClick:n,cardsRef:r},o)=>{const{filteredEntries:i,filterStatus:l,loadMoreUnreadVisible:d,loadMoreVisible:p}=u.useContext(Y),{loadingMore:y,handleLoadMore:a}=nt(),g=h(x=>x.layout);return e.jsxs("div",{className:"entry-list",ref:o,style:{overflowY:"auto",padding:"10px 10px 0 10px",width:"302px",backgroundColor:"var(--color-fill-1)",flex:"1"},children:[e.jsx(rn,{}),e.jsx(nn,{loading:t}),t?null:e.jsx("div",{ref:r,children:i.map(x=>{ze(x.feed.site_url)||(x.feed.site_url=st(x.feed.feed_url));const f=g==="small"?sn:Zs;return e.jsx(f,{entry:x,handleEntryClick:n},x.id)})}),!t&&(l==="all"?p:d)&&e.jsxs(M,{onClick:()=>a(s),loading:y,long:!0,style:{margin:"10px auto",display:"block"},children:[!y&&e.jsx(es,{}),"Load more"]})]})}),an=u.forwardRef(({info:t,markAllAsRead:s},n)=>{const{entries:r,filteredEntries:o,filterStatus:i,filterString:l,filterType:d,setEntries:p,setFilteredEntries:y,setUnreadCount:a}=u.useContext(Y),{handleFilter:g}=ot(),x=h(C=>C.initData),f=u.useCallback(async()=>{s().then(()=>{F.success("Marked all as read successfully"),x(),p(r.map(C=>({...C,status:"read"}))),y(o.map(C=>({...C,status:"read"}))),a(0)}).catch(()=>{F.error("Failed to mark all as read")})},[r,o,x,s,p,y,a]);return t.from!=="history"?e.jsxs("div",{className:"entry-panel",style:{backgroundColor:"var(--color-bg-2)",bottom:"0",display:"flex",flexDirection:"row",padding:"8px 10px",zIndex:"2",justifyContent:"space-between",borderTop:"1px solid var(--color-border-2)"},children:[e.jsxs(ie.Group,{type:"button",name:"lang",value:i,onChange:C=>{n.current&&n.current.scrollTo(0,0),g(d,C,l)},children:[e.jsx(ie,{value:"all",children:"ALL"}),e.jsx(ie,{value:"unread",children:"UNREAD"})]}),t.from!=="starred"&&e.jsx(Be,{focusLock:!0,title:"Mark All As Read?",onOk:f,children:e.jsx(M,{icon:e.jsx(Ne,{}),shape:"circle"})})]}):null}),se=({info:t,getEntries:s,markAllAsRead:n})=>{const r=h(v=>v.activeContent),o=h(v=>v.setActiveContent),i=h(v=>v.setReadCount),l=h(v=>v.setStarredCount),d=h(v=>v.setUnreadToday),p=h(v=>v.setUnreadTotal),y=h(v=>v.updateFeedUnreadCount),a=h(v=>v.updateGroupUnreadCount),{filteredEntries:g,filterStatus:x,loading:f,offset:C,setEntries:k,setFilteredEntries:T,setLoading:P,setLoadMoreUnreadVisible:E,setLoadMoreVisible:m,setOffset:A,setTotal:I,setUnreadCount:j,total:w,unreadCount:c}=u.useContext(Y),{handleFetchContent:S,toggleEntryStarred:O,toggleEntryStatus:_,handleEntryStatusUpdate:L}=we(),{handleBKey:de,handleDKey:W,handleEscapeKey:it,handleLeftKey:lt,handleMKey:ct,handleRightKey:dt,handleSKey:ut}=Ee(),{getFirstImage:ht}=nt(),[je,Se]=u.useState(!1),ne=u.useRef(null),V=u.useRef(null),ke=u.useRef(null);u.useEffect(()=>{Se(r!==null)},[r]),u.useEffect(()=>{if(!(c===0||w===0))switch(t.from){case"all":p(()=>c);break;case"today":d(()=>c);break;case"starred":l(()=>w);break;case"history":i(()=>w);break;case"feed":{const v=Number.parseInt(t.id);y(v,c);break}case"group":{const v=Number.parseInt(t.id);a(v,c);break}}},[w,c]);const re=async v=>{Se(!1),setTimeout(()=>{o({...v,status:"read"})},200),v.status==="unread"&&(setTimeout(()=>{L(v,"read")},200),$e(v.id,"read").catch(()=>{F.error("Failed to mark entry as read, please try again later"),L(v,"unread")})),V.current&&(V.current.setAttribute("tabIndex","-1"),V.current.focus(),V.current.scrollTo(0,0))};u.useEffect(()=>{const v={27:()=>it(ne),37:()=>lt(re),39:()=>dt(re),66:()=>de(),68:()=>W(S),77:()=>ct(_),83:()=>ut(O)},N=G=>{const B=v[G.keyCode];B&&B()};return je?document.addEventListener("keydown",N):document.removeEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}},[r,g,je]);const pt=async()=>{const v=await s(),N=await s(C,"unread");return{responseAll:v,responseUnread:N}},xt=v=>{const N=v.data.entries.map(ht),G=x==="all"?N:N.filter(B=>B.status==="unread");return{fetchedArticles:N,filteredArticles:G}},mt=(v,N,G,B)=>{k(v),T(N),I(G.data.total),m(v.length<G.data.total),j(B.data.total),E(N.length<B.data.total)},ft=(v,N)=>{var G,B;if((G=v==null?void 0:v.data)!=null&&G.entries&&((B=N==null?void 0:N.data)==null?void 0:B.total)>=0){const{fetchedArticles:yt,filteredArticles:jt}=xt(v);mt(yt,jt,v,N)}},gt=async()=>{P(!0);try{const{responseAll:v,responseUnread:N}=await pt();ft(v,N)}catch(v){console.error("Error fetching articles:",v)}finally{P(!1)}};return u.useEffect(()=>{gt(),o(null),ne.current&&ne.current.scrollTo(0,0),V.current&&V.current.scrollTo(0,0),A(0)},[t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",borderRight:"1px solid var(--color-border-2)"},className:"entry-col",children:[e.jsx(Fe,{in:!f,timeout:200,nodeRef:ke,classNames:"fade",children:e.jsx(on,{cardsRef:ke,loading:f,getEntries:s,handleEntryClick:re,ref:ne})}),e.jsx(an,{info:t,markAllAsRead:n,ref:ne})]}),e.jsx(Fe,{in:je,timeout:200,nodeRef:V,classNames:"fade",unmountOnExit:!0,children:e.jsx(qs,{ref:V})}),e.jsx(Ws,{handleEntryClick:re}),e.jsx(Ks,{handleEntryClick:re})]})},ln=()=>{const t=async()=>{const s=await gs();return R.put(`/v1/users/${s.data.id}/mark-all-as-read`)};return e.jsx(te,{children:e.jsx(se,{info:{from:"all",id:""},getEntries:ks,markAllAsRead:t})})},cn=()=>{const t=ce(),s=ts();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx("div",{children:e.jsx(ss,{status:"404",subTitle:"Whoops, that page is gone. ",extra:[e.jsx(M,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})})},dn=()=>{const{f_id:t}=Ke(),s=async(r=0,o=null)=>{const i=`/v1/feeds/${t}/entries?order=published_at&direction=desc&offset=${r}`,l=o?`${i}&status=${o}`:i;return R.get(l)},n=async()=>R.put(`/v1/feeds/${t}/mark-all-as-read`);return e.jsx(te,{children:e.jsx(se,{info:{from:"feed",id:t},getEntries:s,markAllAsRead:n})})},un=()=>{const{c_id:t}=Ke(),s=async(r=0,o=null)=>{const i=`/v1/categories/${t}/entries?order=published_at&direction=desc&offset=${r}`,l=o?`${i}&status=${o}`:i;return R.get(l)},n=async()=>R.put(`/v1/categories/${t}/mark-all-as-read`);return e.jsx(te,{children:e.jsx(se,{info:{from:"group",id:t},getEntries:s,markAllAsRead:n})})},hn=()=>e.jsx(te,{children:e.jsx(se,{info:{from:"history",id:""},getEntries:Xe})}),pn=t=>{var r;const s=t.getFieldsValue();let n=!0;for(const o of Object.keys(s))if(o!=="password"){const i=(r=s[o])==null?void 0:r.trim();t.setFieldValue(o,i),i||(n=!1)}else s[o]||(n=!1);return n},ue=(t,s)=>{t.key==="Enter"&&s.submit()},xn=()=>{const[t]=ns(),[s,n]=u.useState(!1),[r,o]=u.useState(xe()||"token"),i=ce();u.useEffect(()=>{xe()&&i("/")},[]);const l=async()=>{n(!0);try{(await Le({url:"/v1/me",method:"get",baseURL:t.getFieldsValue().server,headers:{"X-Auth-Token":t.getFieldsValue().token},auth:{username:t.getFieldsValue().username,password:t.getFieldsValue().password},timeout:5e3})).status===200&&(F.success("Success"),xs(r,t.getFieldsValue()),i("/"))}catch(p){console.error(p),F.error(p.message)}n(!1)},d=()=>{l()};return e.jsx("div",{style:{backgroundColor:"var(--color-bg-1)",height:"100%"},children:e.jsx("div",{style:{backgroundColor:"var(--color-fill-1)",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",overflowY:"auto"},children:[e.jsx(Ge,{style:{fontSize:48,color:"rgb(var(--primary-6))",marginTop:"20px"}}),e.jsx(b.Title,{heading:3,children:"Connect to your server"}),e.jsxs(J,{style:{boxShadow:"0 4px 10px rgb(var(--color-bg-3))",padding:"20px",width:"380px",marginTop:"20px"},children:[e.jsxs(D,{autoComplete:"off",form:t,layout:"vertical",onSubmit:()=>{pn(t)?d():F.error("Please fill in all required fields")},children:[e.jsx(D.Item,{field:"server",label:"Server address",rules:[{required:!0}],onKeyDown:p=>{ue(p,t)},children:e.jsx(U,{disabled:s,placeholder:"Please input server address",prefix:e.jsx(rs,{})})}),r==="token"&&e.jsx(D.Item,{field:"token",label:"API Token",rules:[{required:!0}],onKeyDown:p=>{ue(p,t)},children:e.jsx(U,{disabled:s,placeholder:"Please input api token",prefix:e.jsx(Te,{})})}),r==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(D.Item,{field:"username",label:"Username",rules:[{required:!0}],onKeyDown:p=>{ue(p,t)},children:e.jsx(U,{disabled:s,prefix:e.jsx(Pe,{}),placeholder:"Please input username"})}),e.jsx(D.Item,{field:"password",label:"Password",rules:[{required:!0}],onKeyDown:p=>{ue(p,t)},children:e.jsx(U.Password,{disabled:s,prefix:e.jsx(Te,{}),placeholder:"Please input password"})})]})]}),e.jsx(M,{loading:s,type:"primary",long:!0,onClick:()=>t.submit(),style:{marginTop:"20px"},children:"Connect"}),e.jsx(K,{orientation:"center",children:"Or connect with"}),e.jsx(M,{type:"secondary",long:!0,onClick:()=>o(r==="token"?"user":"token"),style:{marginTop:"20px"},children:r==="token"?"Username and password":"API Token"})]}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(b.Text,{disabled:!0,children:"Need more information?"}),e.jsx(os,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:"Go to Miniflux official website"})]})]})})})},mn=({children:t})=>xe()?e.jsx(e.Fragment,{children:t}):e.jsx(as,{to:"/login"}),fn=()=>e.jsx(te,{children:e.jsx(se,{info:{from:"starred",id:""},getEntries:Ze})}),gn=()=>{const t=async()=>{const s=await he(0,"unread"),n=s.data.entries.map(r=>r.id);if(s.data.total>n.length){const r=s.data.total-n.length,o=Math.ceil(r/100)*100,i=await he(n.length,"unread",o);n.push(...i.data.entries.map(l=>l.id))}return Qe(n,"read")};return e.jsx(te,{children:e.jsx(se,{info:{from:"today",id:""},getEntries:he,markAllAsRead:t})})},yn=is([{path:"/",element:e.jsx(mn,{children:e.jsx(Os,{})}),errorElement:e.jsx(cn,{}),children:[{index:!0,element:e.jsx(ln,{})},{path:"/today",element:e.jsx(gn,{})},{path:"/starred",element:e.jsx(fn,{})},{path:"/history",element:e.jsx(hn,{})},{path:"/group/:c_id",element:e.jsx(un,{})},{path:"/feed/:f_id",element:e.jsx(dn,{})}]},{path:"/login",element:e.jsx(xn,{})}]),at=yn;ls.createRoot(document.getElementById("root")).render(e.jsx(cs,{locale:ds,children:e.jsx(us,{router:at})}));
