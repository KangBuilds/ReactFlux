import{p as vt,m as oe,u as p,r as g,d as U,P as us,i as hs,o as wt,a as ms,b as fs,c as ps,e as Y,M as v,C as gs,j as e,f as Q,g as Be,h as re,A as St,I as xs,T as y,S as ke,k as He,l as ot,n as ys,q as _s,s as qe,t as js,v as bs,w as Le,B as I,x as vs,D as ws,y as Te,z as he,E as Ct,F as Ss,G as Cs,H as ks,J as it,K as kt,L as Ts,N as Ie,O as Is,Q as Tt,R as ee,U as Es,V as Fs,W as As,X as Ns,Y as Ls,Z as K,_ as Z,$ as lt,a0 as M,a1 as me,a2 as W,a3 as It,a4 as ct,a5 as Et,a6 as Rs,a7 as Ft,a8 as P,a9 as Ps,aa as ae,ab as Ms,ac as Ds,ad as Vs,ae as zs,af as Os,ag as Us,ah as $s,ai as Bs,aj as At,ak as Nt,al as We,am as Hs,an as qs,ao as Ws,ap as Ks,aq as Gs,ar as Ys,as as Xs,at as Js,au as Qs,av as Re,aw as Zs,ax as er,ay as tr,az as Ee,aA as sr,aB as rr,aC as nr,aD as ar,aE as or,aF as ir,aG as dt,aH as Lt,aI as lr,aJ as cr,aK as dr,aL as Ke,aM as ur,aN as ut,aO as hr,aP as mr,aQ as fr,aR as pr,aS as gr,aT as xr,aU as yr,aV as _r}from"./vendor-DUbyzrez.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();const jr="modulepreload",br=function(t){return"/"+t},ht={},ye=function(s,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(r.map(l=>{if(l=br(l),l in ht)return;ht[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":jr,d||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),d)return new Promise((x,j)=>{h.addEventListener("load",x),h.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return a.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return s().catch(o)})},vr=(t,s,r)=>{const n=t[s];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,o)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(o.bind(null,new Error("Unknown variable dynamic import: "+s+(s.split("/").length!==r?". Note that variables only represent file names one level deep.":""))))})},wr=()=>{const{language:t}=k.get(),s=Ge();return t||s},Ge=()=>{const t=navigator.language;return t==="zh-Hans-CN"?"zh-CN":t},Rt={articleWidth:90,fontSize:1.05,homePage:"all",language:Ge(),layout:"large",markReadOnScroll:!1,orderBy:"created_at",orderDirection:"desc",pageSize:100,removeDuplicates:"none",showAllFeeds:!1,showDetailedRelativeTime:!1,showFeedIcon:!0,showStatus:"unread",theme:"light",themeColor:"Blue"},k=vt("settings",Rt,{encode:JSON.stringify,decode:JSON.parse}),$=t=>k.get()[t],q=t=>k.set({...k.get(),...t}),Sr=()=>k.set(Rt),F=(t,s=null)=>r=>{const n=t.get();if(typeof n=="object"&&n!==null){if(s===null)return;typeof r=="function"?t.set({...n,[s]:r(n[s])}):t.set({...n,[s]:r})}else typeof r=="function"?t.set(r(n)):t.set(r)},V=oe({polyglot:null}),Cr=F(V,"polyglot"),kr=async(t,s)=>{let r,n=t;try{r=await vr(Object.assign({"../locales/en-US.json":()=>ye(()=>import("./en-US-DMNVdjUD.js"),[]),"../locales/es-ES.json":()=>ye(()=>import("./es-ES-Be2JIWkD.js"),[]),"../locales/zh-CN.json":()=>ye(()=>import("./zh-CN-Bhza66QC.js"),[])}),`../locales/${t}.json`,3)}catch{r=await ye(()=>import("./en-US-DMNVdjUD.js"),[]),n="en-US"}{const a=new us({phrases:r.default,locale:n});Cr(a)}},Pt=()=>{const{language:t}=p(k);g.useEffect(()=>{t?(kr(t),t==="zh-CN"?U.locale("zh-cn"):t==="es"||t.startsWith("es-")?U.locale("es"):U.locale("en")):q({language:Ge()})},[t])},Ye=oe({addFeedModalVisible:!1,settingsModalVisible:!1}),Tr=F(Ye,"addFeedModalVisible"),Ir=F(Ye,"settingsModalVisible"),Xe=()=>{const{addFeedModalVisible:t,settingsModalVisible:s}=p(Ye);return{addFeedModalVisible:t,setAddFeedModalVisible:Tr,settingsModalVisible:s,setSettingsModalVisible:Ir}},fe=()=>{const[t,s]=g.useState(window.innerWidth),r=t<=768,n=t<=992;return g.useEffect(()=>{const a=()=>s(window.innerWidth);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),{width:t,isBelowMedium:r,isBelowLarge:n}},Mt={server:"",token:"",username:"",password:""},Pe=vt("auth",Mt,{encode:JSON.stringify,decode:JSON.parse}),Dt=t=>Pe.set(t),Er=()=>Dt(Mt),Fr=t=>{try{const s=new URL(t),{hostname:r,port:n}=s;return!!r&&!!n}catch{return!1}},Fe=t=>{const{server:s,token:r,username:n,password:a}=t;return!s||!hs(s,{require_protocol:!0})&&!Fr(s)?!1:r||n&&a},Ar=()=>wt.create({retry:3,onRequest({_request:t,options:s}){const r=Pe.get();if(!Fe(r))throw new Error("Invalid auth");const{server:n,token:a,username:o,password:i}=r;s.baseURL=n,s.headers=a?{"X-Auth-Token":a}:{Authorization:`Basic ${btoa(`${o}:${i}`)}`}},onRequestError({_request:t,_options:s,error:r}){console.error("Request error: ",r)},async onResponseError({_request:t,response:s,_options:r}){var o;s.status===401&&(localStorage.removeItem("auth"),await ds.navigate("/login"));const a=((o=s._data)==null?void 0:o.error_message)??s.statusText;throw console.error("Response error: ",a),new Error(a)}}),C=Ar();C.get=t=>C(t,{method:"GET"});C.post=(t,s)=>C(t,{method:"POST",body:s});C.put=(t,s)=>C(t,{method:"PUT",body:s});const Nr=async()=>C.get("/v1/categories"),Lr=async t=>C.post("/v1/categories",{title:t}),Rr=async t=>C.raw(`/v1/categories/${t}`,{method:"DELETE"}),Pr=async(t,s,r=!1)=>{const n={title:s,hide_globally:r?"on":void 0};return C.put(`/v1/categories/${t}`,n)},Mr=async t=>C.put(`/v1/categories/${t}/mark-all-as-read`);U.extend(ms);U.extend(fs);U.extend(ps);const Dr=t=>U(t).isAfter(U().subtract(24,"hour")),Vr=()=>U().subtract(24,"hour").unix(),zr=()=>U().utc().format("YYYY-MM-DDTHH:mm:ss.SSSSSSZ"),Or=t=>U(t).format("dddd, MMMM D, YYYY h:mm A"),Vt=(t,s)=>{const{polyglot:r}=V.get();if(!s){const m=U(),b=U(t),E=b.from(m),S=U.duration(m.diff(b)).asSeconds();return S>=0&&S<60?r.t("date.just_now"):E}const n=U(),o=U(t).diff(n),i=U.duration(Math.abs(o)),c=i.years(),l=i.months(),d=i.days(),u=i.hours(),h=i.minutes(),x=[];if(c>0&&x.push(r.t(c>1?"date.years":"date.year",{count:c})),l>0&&x.push(r.t(l>1?"date.months":"date.month",{count:l})),d>0&&x.push(r.t(d>1?"date.days":"date.day",{count:d})),u>0&&x.push(r.t(u>1?"date.hours":"date.hour",{count:u})),h>0&&x.push(r.t(h>1?"date.minutes":"date.minute",{count:h})),x.length===0)return r.t("date.just_now");const j=x.join(" ");return o>0?r.t("date.in_time",{time:j}):r.t("date.time_ago",{time:j})},Me=async(t,s)=>C.put("/v1/entries",{entry_ids:t,status:s}),Ur=async t=>C.put(`/v1/entries/${t}/bookmark`),$r=async t=>C.get(`/v1/entries/${t}/fetch-content`),Br=async t=>C.raw(`/v1/entries/${t}/save`,{method:"POST"}),ie=(t,s={})=>{const{baseUrl:r,orderField:n,offset:a,limit:o,status:i}=t,c=$("orderDirection"),l=new URLSearchParams({order:n,direction:c,offset:a,limit:o,...s});return i&&l.append("status",i),`${r}?${l}`},Hr=async(t=0,s=null)=>{const r=$("orderBy"),n=$("pageSize"),a=$("showAllFeeds"),o={baseUrl:"/v1/entries",orderField:r,offset:t,limit:n,status:s},i={globally_visible:!a};return C.get(ie(o,i))},we=async(t=0,s=null,r=null)=>{const n=$("orderBy"),a=r??$("pageSize"),o=$("showAllFeeds"),i=Vr(),c={baseUrl:"/v1/entries",orderField:n,offset:t,limit:a,status:s},l={globally_visible:!o,published_after:i};return C.get(ie(c,l))},zt=async(t=0,s=null)=>{const r=$("pageSize"),n={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:r,status:s},a={starred:"true"};return C.get(ie(n,a))},Ot=async(t=0)=>{const s=$("pageSize"),r={baseUrl:"/v1/entries",orderField:"changed_at",offset:t,limit:s,status:"read"};return C.get(ie(r))},qr=async()=>C.get("/v1/feeds"),Wr=async()=>C.get("/v1/feeds/counters"),Kr=async t=>C.raw(`/v1/feeds/${t}/refresh`,{method:"PUT"}),Gr=async()=>C.raw("/v1/feeds/refresh",{method:"PUT"}),Yr=async(t,s,r)=>C.post("/v1/feeds",{feed_url:t,category_id:s,crawler:r}),Xr=async t=>C.raw(`/v1/feeds/${t}`,{method:"DELETE"}),mt=async(t,s)=>{const{categoryId:r,title:n,siteUrl:a,feedUrl:o,hidden:i,disabled:c,isFullText:l}=s;return C.put(`/v1/feeds/${t}`,{category_id:r,title:n,site_url:a,feed_url:o,hide_globally:i,disabled:c,crawler:l})},Jr=async t=>C.put(`/v1/feeds/${t}/mark-all-as-read`),Qr=async()=>C.get("/v1/me"),Zr=async t=>C.get(`/v1/icons/${t}`),en=async()=>C.get("/v1/version"),tn=async()=>{const t=await Qr();return C.put(`/v1/users/${t.data.id}/mark-all-as-read`)},Ut={isAppDataReady:!1,unreadInfo:{},unreadTodayCount:0,starredCount:0,historyCount:0,feedsData:[],categoriesData:[],isVersionAtLeast2_2_0:!1},z=oe(Ut),Je=Y(z,t=>{const{unreadInfo:s,feedsData:r}=t;return r.map(a=>({...a,unreadCount:s[a.id]??0})).sort((a,o)=>a.title.localeCompare(o.title,"en"))}),pe=Y([z,Je],(t,s)=>{const{categoriesData:r}=t;return r.map(a=>{const o=s.filter(i=>i.category.id===a.id);return{...a,unreadCount:o.reduce((i,c)=>i+(c.unreadCount??0),0),feedCount:o.length}}).sort((a,o)=>a.title.localeCompare(o.title,"en"))}),$t=Y(pe,t=>t.filter(s=>s.hide_globally).map(s=>s.id)),Qe=Y([Je,$t],(t,s)=>t.filter(r=>r.hide_globally||s.includes(r.category.id)).map(r=>r.id)),Bt=Y([Je,Qe,k],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),sn=Y([pe,$t,k],(t,s,r)=>{const{showAllFeeds:n}=r;return t.filter(a=>n||!s.includes(a.id))}),Ht=Y(Bt,t=>t.reduce((s,r)=>{const{id:n}=r.category;return s[n]||(s[n]=[]),s[n].push(r),s},{})),rn=Y([z,Bt],(t,s)=>{const{unreadInfo:r}=t;return Object.entries(r).reduce((n,[a,o])=>s.some(i=>i.id===Number(a))?n+o:n,0)}),Se=F(z,"categoriesData"),se=F(z,"feedsData"),Ve=F(z,"historyCount"),ft=F(z,"isAppDataReady"),ze=F(z,"starredCount"),qt=F(z,"unreadInfo"),Wt=F(z,"unreadTodayCount"),nn=F(z,"isVersionAtLeast2_2_0"),an=()=>z.set(Ut),Kt=(t,s)=>{const r=s.map(n=>n.id);return t.map(n=>r.includes(n.id)&&s.find(o=>o.id===n.id)||n)},Oe=(t,s)=>{const r={};let n=0;const a=t.filter(l=>l.status!==s);if(a.length===0)return;Ve(s==="read"?l=>l+a.length:l=>Math.max(0,l-a.length));for(const l of a){const d=l.feed.id,u=Dr(l.published_at),h=s==="read"?-1:1;r[d]=(r[d]??0)+h,n+=u?h:0}Wt(l=>Math.max(0,l+n)),qt(l=>{const d={...l};for(const[u,h]of Object.entries(r))d[u]=Math.max(0,(d[u]??0)+h);return d});const o=a.map(l=>({...l,status:s})),{activeContent:i}=A.get(),c=o.find(l=>l.id===(i==null?void 0:i.id));c&&G(c),ge(l=>Kt(l,o))},Ze=()=>{const{activeContent:t}=p(A),{polyglot:s}=p(V),r=(l,d)=>{Oe([l],d)},n=(l,d)=>{d?(ze(h=>h+1),gs({particleCount:100,angle:120,spread:70,origin:{x:1,y:1}})):ze(h=>Math.max(0,h-1));const u={...l,starred:d};t&&G(u),ge(h=>Kt(h,[u]))};return{handleEntryStatusUpdate:r,handleFetchContent:async()=>{try{const l=await $r(t.id);v.success(s.t("actions.fetched_content_success")),G({...t,content:l.content})}catch{v.error(s.t("actions.fetched_content_error"))}},handleSaveToThirdPartyServices:async()=>{(await Br(t.id)).status===202?v.success(s.t("actions.saved_to_third-party_services_success")):v.error(s.t("actions.saved_to_third-party_services_error"))},handleToggleStarred:async l=>{const d=!l.starred;n(l,d),Ur(l.id).catch(()=>{v.error(d?s.t("actions.star_error"):s.t("actions.unstar_error")),n(l,!d)})},handleToggleStatus:async l=>{const d=l.status,u=d==="read"?"unread":"read";r(l,u),Me([l.id],u).catch(()=>{v.error(u==="read"?s.t("actions.mark_as_read_error"):s.t("actions.mark_as_unread_error")),r(l,d)})}}},on=(t,s)=>{const{polyglot:r}=V.get();if(t.length===0||s==="none")return t;const n=t.map((u,h)=>({id:u.id,index:h})),a=new Map,o=new Map,i=new Map,c=[],l=t.slice().sort((u,h)=>u.id-h.id).filter(u=>{const{hash:h,title:x,url:j,id:m}=u;switch(s){case"hash":if(a.has(h))return c.push(u),!1;a.set(h,m);break;case"title":if(o.has(x))return c.push(u),!1;o.set(x,m);break;case"url":if(i.has(j))return c.push(u),!1;i.set(j,m);break;default:return!0}return!0}),d=c.filter(u=>u.status==="unread").map(u=>u.id);return d.length>0&&(Oe(c,"read"),Me(d,"read").catch(()=>{v.error(r.t("deduplicate.mark_as_read_error")),Oe(c,"unread")})),l.sort((u,h)=>{const x=n.find(m=>m.id===u.id).index,j=n.find(m=>m.id===h.id).index;return x-j})},ln=t=>{const s=new Array(t.length).fill(0);let r=0,n=1;for(;n<t.length;)t[n]===t[r]?(r++,s[n]=r,n++):r!==0?r=s[r-1]:(s[n]=0,n++);return s},_e=(t,s,r=!0)=>{const n=r?t.toLowerCase():t,a=r?s.toLowerCase():s;if(a.length===0)return 0;const o=ln(a);let i=0,c=0;for(;i<n.length;)if(n[i]===a[c]?(i++,c++):c!==0?c=o[c-1]:i++,c===a.length)return i-c;return-1},cn=t=>{const s=[],r=[];let n=[];const a=[],o=t.match(/([-+|]?)\s*"([^"]+)"/g);let i=t;o&&(n=o.map(l=>{const d=l.trim()[0],u=l.match(/"([^"]+)"/)[1];switch(d){case"-":r.push(u);break;case"+":s.push(u);break;case"|":a.push([u]);break;default:s.push(u);break}return u}),i=t.replace(/([-+|]?)\s*"([^"]+)"/g,""));const c=i.split(/\s+/);for(const l of c){const d=l.replace(/^-|\+|\|$/,"");if(l.startsWith("-")&&d)r.push(d);else if(l.startsWith("+")&&d)s.push(d);else if(l.includes("|")){const u=l.split("|").filter(h=>h);u.length>0&&a.push(u)}else d&&s.push(d)}return{includeTerms:s,excludeTerms:r,exactPhrases:n,orConditions:a}},dn=(t,s,r=[],n=!0)=>{const{includeTerms:a,excludeTerms:o,exactPhrases:i,orConditions:c}=cn(s);return t.filter(l=>r.some(d=>{const u=l[d];if(typeof u!="string")return!1;const h=n?u.toLowerCase():u;if(o.some(m=>_e(h,m,n)!==-1)||i.length>0&&!i.some(m=>_e(h,m,n)!==-1))return!1;const x=a.every(m=>_e(h,m,n)!==-1),j=c.length===0||c.some(m=>m.some(b=>_e(h,b,n)!==-1));return x&&j}))},un=(t,s,r=[],n=!0)=>{try{if(!Array.isArray(t)||t.length===0)throw new Error("Invalid data input");if(typeof s!="string"||s.trim().length===0)throw new Error("Invalid query input");return dn(t,s,r,n)}catch(a){return console.error(a.message),[]}},Ce=(t,s)=>t.toLowerCase().includes(s.toLowerCase()),hn=(t,s,r)=>r?un(t,r,[s]):t,Gt={activeContent:null,entries:[],filterString:"",filterType:"Title",infoFrom:$("homePage"),isArticleFocused:!1,isArticleListReady:!1,loadMoreVisible:!1,offset:0,total:0},A=oe(Gt),et=Y([A,z,Qe,k],(t,s,r,n)=>{const{entries:a,filterString:o,filterType:i,infoFrom:c}=t,l=hn(a,i,o),{isVersionAtLeast2_2_0:d}=s,{removeDuplicates:u,showAllFeeds:h}=n,x=!["starred","history"].includes(c),j=b=>d||h||!r.includes(b.feed.id),m=x?l.filter(j):l;return u==="none"||["starred","history"].includes(c)?m:on(m,u)}),G=F(A,"activeContent"),ge=F(A,"entries"),Ae=F(A,"filterString"),Ne=F(A,"filterType"),mn=F(A,"infoFrom"),J=F(A,"isArticleFocused"),pt=F(A,"isArticleListReady"),Yt=F(A,"loadMoreVisible"),Xt=F(A,"offset"),fn=F(A,"total"),pn=()=>A.set(Gt),gt=oe(),je=new Set,gn=t=>{const s=p(gt);return g.useEffect(()=>{s[t]||je.has(t)||(je.add(t),Zr(t).then(r=>{const n=`data:${r.data}`;gt.setKey(t,n),je.delete(t)}).catch(()=>{je.delete(t)}))},[t,s]),s[t]},xn=t=>{const s=/^(?:http|https):\/\/((?!(\d+\.){3}\d+)([^/?#]+))/,r=t.match(s);return r?r[1]:null},xt=t=>{const s=xn(t);if(s){const r=s.split(".");if(r.length>=2)return r.slice(-2).join(".")}return null},yn=t=>`https://icons.duckduckgo.com/ip3/${xt(t.site_url)??xt(t.feed_url)}.ico`,Jt=({feed:t,className:s="feed-icon"})=>{const{icon_id:r}=t.icon,n=yn(t);if(r===0)return e.jsx("img",{className:s,src:n,alt:""});const[a,o]=g.useState(n),i=gn(r);return g.useEffect(()=>{i&&o(i)},[i]),e.jsx("img",{className:s,src:a,alt:"",onError:()=>o(n)})},Qt=Q.Item,_n=({category:t,path:s})=>{var i;const n=(i=p(Ht)[t.id])==null?void 0:i.reduce((c,l)=>c+l.unreadCount,0),a=re(),o=()=>{a(`/category/${t.id}`),G(null)};return e.jsxs("div",{className:Le("category-title",{"active-subMenu":s===`/category/${t.id}`,"inactive-subMenu":s!==`/category/${t.id}`}),onClick:o,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&o()},tabIndex:0,role:"button",style:{cursor:"pointer"},children:[e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:n?"80%":"100%",fontWeight:500},children:t.title}),n>0&&e.jsx(y.Ellipsis,{className:"unread-count",expandable:!1,style:{fontWeight:500},children:n})]})},jn=({count:t})=>e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:t||""}),be=({path:t,Icon:s,label:r,count:n})=>{const a=Be(),o=re(),i=a.pathname===t,c=()=>{o(t),G(null)};return e.jsx(Qt,{onClick:c,className:Le("arco-menu-item",{"arco-menu-selected":i}),children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs("span",{children:[e.jsx(s,{}),r]}),e.jsx(jn,{count:n})]})},t)},Zt=()=>{const{homePage:t,showFeedIcon:s}=p(k),{historyCount:r,isAppDataReady:n,starredCount:a,unreadTodayCount:o}=p(z),i=p(Ht),c=p(sn),l=p(rn),{polyglot:d}=p(V),u=Be(),h=re(),[x,j]=g.useState([`/${t}`]),m=u.pathname;g.useEffect(()=>{j([m])},[m]);const b=()=>e.jsxs(e.Fragment,{children:[e.jsx(be,{path:"/all",Icon:ys,label:d.t("sidebar.all"),count:l}),e.jsx(be,{path:"/today",Icon:_s,label:d.t("sidebar.today"),count:o}),e.jsx(be,{path:"/starred",Icon:qe,label:d.t("sidebar.starred"),count:a}),e.jsx(be,{path:"/history",Icon:js,label:d.t("sidebar.history"),count:r})]}),E=T=>{var N;return(N=i[T])==null?void 0:N.map(O=>e.jsx(Qt,{style:{position:"relative",overflow:"hidden"},onClick:H=>{H.stopPropagation(),h(`/feed/${O.id}`),G(null)},children:e.jsxs("div",{className:"custom-menu-item",children:[e.jsxs(y.Ellipsis,{expandable:!1,showTooltip:!0,style:{width:O.unreadCount?"80%":"100%",paddingLeft:"20px",boxSizing:"border-box"},children:[s&&e.jsx(Jt,{feed:O,className:"feed-icon-sidebar"}),O.title]}),O.unreadCount!==0&&e.jsx(y.Ellipsis,{className:"item-count",expandable:!1,children:O.unreadCount})]})},`/feed/${O.id}`))},S=()=>c.map(T=>e.jsx(ot.Item,{name:`/category/${T.id}`,style:{position:"relative",overflow:"hidden"},header:e.jsx(_n,{category:T,path:m}),expandIcon:e.jsx(bs,{}),children:E(T.id)},T.id));return e.jsxs("div",{className:"sidebar-container",children:[e.jsxs(Q,{hasCollapseButton:!1,selectedKeys:x,children:[e.jsxs("div",{className:"menu-header",children:[e.jsx(St,{className:"avatar",size:32,children:e.jsx(xs,{style:{color:"var(--color-bg-1)"}})}),e.jsx(y.Title,{heading:6,style:{margin:0},children:"ReactFlux"})]}),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:d.t("sidebar.articles")}),e.jsx(ke,{loading:!n,animation:!0,text:{rows:3}}),n&&b(),e.jsx(y.Title,{className:"section-title",heading:6,style:{paddingLeft:"12px"},children:d.t("sidebar.feeds")})]}),e.jsx("div",{className:"feeds-menu-wrapper",children:e.jsx(He,{style:{maxHeight:"100%"},autoHide:!0,children:e.jsxs(Q,{autoScrollIntoView:!0,hasCollapseButton:!1,selectedKeys:x,children:[e.jsx(ke,{loading:!n,animation:!0,text:{rows:6}}),n&&e.jsx(ot,{triggerRegion:"icon",bordered:!1,children:S()})]})})})]})},bn=()=>{const{showAllFeeds:t,theme:s}=p(k),{polyglot:r}=p(V),n=[{label:r.t("header.theme_option_light"),value:"light"},{label:r.t("header.theme_option_dark"),value:"dark"},{label:r.t("header.theme_option_system"),value:"system"}],a=re(),o=Be().pathname,{setAddFeedModalVisible:i,setSettingsModalVisible:c}=Xe(),{isBelowLarge:l}=fe(),[d,u]=g.useState(!1),[h,x]=g.useState(!1),[j,m]=g.useState(!1);g.useEffect(()=>{l||u(!1)},[l]),g.useEffect(()=>{o&&u(!1)},[o]);const b=()=>{q({showAllFeeds:!t})},E=()=>{q({theme:s==="light"?"dark":"light"})},S=()=>{Sr(),x(!1)},T=()=>{Er(),pn(),an(),a("/login"),v.success(r.t("header.logout_success"))},N=()=>s==="dark"?e.jsx(Es,{}):s==="system"?e.jsx(Fs,{}):e.jsx(As,{});return e.jsxs("div",{className:"header",children:[e.jsx("div",{className:"brand",children:e.jsx(I,{className:"trigger",onClick:()=>u(!d),shape:"circle",size:"small",children:e.jsx(vs,{})})}),e.jsx(ws,{className:"sidebar-drawer",visible:d,title:null,footer:null,closable:!1,onCancel:()=>u(!1),placement:"left",width:240,children:e.jsx(Zt,{})}),e.jsx("div",{className:"button-group",children:e.jsxs(Te,{size:16,children:[e.jsx(he,{content:r.t("header.add_feed"),mini:!0,children:e.jsx(I,{shape:"circle",size:"small",type:"primary",icon:e.jsx(Ct,{}),onClick:()=>i(!0)})}),e.jsx(he,{content:t?r.t("header.hide_some_feeds"):r.t("header.show_all_feeds"),mini:!0,children:e.jsx(I,{shape:"circle",size:"small",icon:t?e.jsx(Ss,{}):e.jsx(Cs,{}),onClick:b})}),e.jsx(I,{shape:"circle",size:"small",icon:e.jsx(ks,{}),onClick:()=>window.open("https://github.com/electh/ReactFlux","_blank")}),e.jsx(it,{droplist:e.jsx(Q,{defaultSelectedKeys:[s],className:"theme-menu",children:n.map(({label:O,value:H})=>e.jsxs(Q.Item,{className:"theme-menu-item",onClick:()=>q({theme:H}),children:[O,s===H&&e.jsx(kt,{style:{marginLeft:8}})]},H))}),trigger:"hover",position:"bottom",children:e.jsx(I,{icon:N(),shape:"circle",size:"small",onClick:E})}),e.jsx(it,{droplist:e.jsxs(Q,{children:[e.jsxs(Q.Item,{onClick:()=>c(!0),children:[e.jsx(Ts,{className:"icon-right"}),r.t("header.settings")]},"0"),e.jsxs(Q.Item,{onClick:()=>x(!0),children:[e.jsx(Ie,{className:"icon-right"}),r.t("header.reset_settings")]},"1"),e.jsxs(Q.Item,{onClick:()=>m(!0),children:[e.jsx(Is,{className:"icon-right"}),r.t("header.logout")]},"2")]}),trigger:"click",position:"br",children:e.jsx(St,{size:28,style:{cursor:"pointer"},children:e.jsx(Tt,{})})})]})}),e.jsx(ee,{title:r.t("header.settings_reset_confirm"),visible:h,onOk:S,onCancel:()=>x(!1),children:e.jsx("p",{children:r.t("header.settings_reset_description")})}),e.jsx(ee,{title:r.t("header.logout_confirm"),visible:j,onOk:T,onCancel:()=>m(!1),children:e.jsx("p",{children:r.t("header.logout_description")})})]})},vn=(t,s)=>{const r=t.split("."),n=s.split(".");for(let a=0;a<Math.max(r.length,n.length);a++){const o=r[a]||"0",i=n[a]||"0",c=o.localeCompare(i,void 0,{numeric:!0});if(c!==0)return c}return 0},tt=()=>{const t=g.useRef(!1);return{fetchAppData:async()=>{if(!t.current){t.current=!0,ft(!1);try{const r=await Promise.all([Wr(),we(0,"unread"),zt(),Ot(),qr(),Nr(),en()]),[n,a,o,i,c,l,d]=r,u=c.reduce((h,x)=>(h[x.id]=n.unreads[x.id]??0,h),{});qt(u),Wt(a.total??0),ze(o.total??0),Ve(i.total??0),se(c),Se(l),nn(vn(d.version,"2.2.0")>=0),ft(!0)}catch(r){console.error("Error fetching app data: ",r)}finally{t.current=!1}}}}},Ue={Red:{light:"#F53F3F",dark:"#F76965"},Orange:{light:"#F77234",dark:"#F9925A"},Gold:{light:"#F7BA1E",dark:"#F9CC44"},Green:{light:"#00B42A",dark:"#27C346"},Cyan:{light:"#14C9C9",dark:"#3FD4CF"},Blue:{light:"#165DFF",dark:"#3C7EFF"},Purple:{light:"#722ED1",dark:"#8E51DA"},Magenta:{light:"#F5319D",dark:"#F756A9"}},$e=t=>{const s=Ue[t]||Ue.Blue,r=window.matchMedia("(prefers-color-scheme: dark)").matches,n=$("theme");return(n==="system"?r:n==="dark")?s.dark:s.light},es=t=>{Ns($e(t),{list:!0}).map(Ls).forEach((r,n)=>{document.body.style.setProperty(`--primary-${n+1}`,r)})},wn=()=>{const{articleWidth:t,fontSize:s,layout:r,showDetailedRelativeTime:n,showFeedIcon:a,themeColor:o}=p(k),{polyglot:i}=p(V),c=l=>{q(l),l.themeColor&&es(l.themeColor)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.theme_color_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.theme_color_description")})]}),e.jsx("div",{style:{display:"flex"},children:Object.keys(Ue).map(l=>e.jsx("div",{style:{width:"18px",height:"18px",borderRadius:"50%",margin:"2px",backgroundColor:$e(l),cursor:"pointer",border:"3px solid var(--color-bg-3)",outline:l===o?`1px solid ${$e(l)}`:"none"},onClick:()=>c({themeColor:l}),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&c({themeColor:l})},"aria-label":i.t("appearance.theme_color_aria_label",{color:l})},l))})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.compact_article_list_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.compact_article_list_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:r==="small",onChange:l=>c({layout:l?"small":"large"})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.show_detailed_relative_time_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.show_detailed_relative_time_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:n,onChange:l=>c({showDetailedRelativeTime:l})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.show_feed_icon_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.show_feed_icon_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:a,onChange:l=>c({showFeedIcon:l})})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.font_size_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.font_size_description")})]}),e.jsx("div",{children:e.jsxs(Te,{children:[e.jsx(y.Text,{style:{fontSize:"0.75rem"},children:"A"}),e.jsx(lt,{formatTooltip:l=>`${l}rem`,max:1.25,min:.75,showTicks:!0,step:.05,style:{width:200},value:s,onChange:l=>c({fontSize:l})}),e.jsx(y.Text,{style:{fontSize:"1.25rem"},children:"A"})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.article_width_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.article_width_description")})]}),e.jsx("div",{children:e.jsxs(Te,{children:[e.jsx(y.Text,{children:"60%"}),e.jsx(lt,{formatTooltip:l=>`${l}%`,max:90,min:60,showTicks:!0,step:10,style:{width:160},value:t,onChange:l=>c({articleWidth:l})}),e.jsx(y.Text,{children:"90%"})]})})]})]})},Sn=()=>{const t=p(pe),{polyglot:s}=p(V),[r]=M.useForm(),[n,a]=g.useState(!1),[o,i]=g.useState(""),[c,l]=g.useState({}),[d,u]=g.useState(!1),h=async()=>{if(o.trim()){try{const m=await Lr(o);Se(b=>[...b,{...m}]),v.success(s.t("category_list.add_category_success"))}catch(m){console.error(`${s.t("category_list.add_category_error")}: `,m),v.error(s.t("category_list.add_category_error"))}i(""),u(!1)}},x=async(m,b,E)=>{try{const S=await Pr(m,b,E);se(T=>T.map(N=>N.category.id===m?{...N,category:{...N.category,title:b,hide_globally:E}}:N)),Se(T=>T.map(N=>N.id===m?{...N,...S}:N)),v.success(s.t("category_list.update_category_success"))}catch{v.error(s.t("category_list.update_category_error"))}a(!1),r.resetFields()},j=async m=>{try{(await Rr(m.id)).status===204?(Se(E=>E.filter(S=>S.id!==m.id)),v.success(s.t("category_list.remove_category_success",{title:m.title}))):v.error(s.t("category_list.remove_category_error",{title:m.title}))}catch(b){console.error(s.t("category_list.remove_category_error",{title:m.title}),b),v.error(s.t("category_list.remove_category_error",{title:m.title}))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[t.map(m=>e.jsx(me,{className:"tag-style",closable:m.feedCount===0,size:"medium",onClick:()=>{l(m),a(!0),r.setFieldsValue({title:m.title})},onClose:async b=>{b.stopPropagation(),await j(m)},children:m.title},m.id)),d?e.jsx(W,{autoFocus:!0,className:"input-style",onBlur:h,onChange:i,onPressEnter:h,size:"small",value:o}):e.jsx(me,{className:"add-category-tag",icon:e.jsx(Ct,{}),onClick:()=>u(!0),size:"medium",tabIndex:0})]}),c&&e.jsx(ee,{className:"modal-style",onOk:r.submit,title:"Edit Category",unmountOnExit:!0,visible:n,onCancel:()=>{a(!1),r.resetFields()},children:e.jsxs(M,{form:r,layout:"vertical",onSubmit:m=>x(c.id,m.title,m.hidden),labelCol:{style:{flexBasis:90}},wrapperCol:{style:{flexBasis:"calc(100% - 90px)"}},children:[e.jsx(M.Item,{label:"Title",field:"title",rules:[{required:!0}],children:e.jsx(W,{placeholder:"Please input category title"})}),e.jsx(M.Item,{label:"Hidden",field:"hidden",initialValue:c.hide_globally,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})})]})})]})},Cn=t=>new Promise(s=>setTimeout(s,t)),ts=It(""),yt=F(ts),ss=Y([z,ts],(t,s)=>{const{feedsData:r}=t;return[...r].sort((n,a)=>n.disabled&&!a.disabled?1:!n.disabled&&a.disabled?-1:0).sort((n,a)=>a.parsing_error_count-n.parsing_error_count).filter(n=>Ce(n.title,s)||Ce(n.site_url,s)||Ce(n.feed_url,s))}),kn=Y(ss,t=>t.map(s=>({category:s.category,checked_at:s.checked_at,crawler:s.crawler,disabled:s.disabled,feed_url:s.feed_url,hidden:s.hide_globally,key:s.id,parsing_error_count:s.parsing_error_count,site_url:s.site_url,title:s.title}))),_t=(t,s,r=null)=>r===null||r===t.id?{...t,parsing_error_count:s?0:t.parsing_error_count+1,checked_at:zr()}:t,Tn=()=>{const t=p(pe),{isAppDataReady:s}=p(z),{showDetailedRelativeTime:r}=p(k),n=p(ss),a=p(kn),{polyglot:o}=p(V),[i,c]=g.useState(!1),[l]=M.useForm(),[d,u]=g.useState(!1),[h,x]=g.useState(""),[j,m]=g.useState(null),{isBelowMedium:b}=fe();g.useEffect(()=>{yt("")},[]);const E=f=>{m(f),u(!0),l.setFieldsValue({category:f.category.id,title:f.title,siteUrl:f.site_url,feedUrl:f.feed_url,hidden:f.hidden,disabled:f.disabled,crawler:f.crawler})},S=async(f,_,w=!0)=>{try{const R=(await f()).status===204;return w&&(R?v.success(o.t("feed_table.refresh_success")):v.error(o.t("feed_table.refresh_error"))),se(te=>te.map(ne=>_(ne,R))),R}catch{return w&&v.error(o.t("feed_table.refresh_error")),se(R=>R.map(te=>_(te,!1))),!1}},T=async(f,_=!0)=>{const w=f.id||f.key;return S(()=>Kr(w),(L,R)=>_t(L,R,w),_)},N=async()=>{try{const f=await Promise.all(n.map(async _=>{const w=new URL(_.feed_url).hostname;if(w===h)return _;const L=_.feed_url.replace(w,h),R=await mt(_.id,{feedUrl:L});return{..._,...R}}));se(_=>_.map(w=>f.find(L=>L.id===w.id)||w)),v.success(o.t("feed_table.bulk_update_success")),c(!1)}catch{v.error(o.t("feed_table.bulk_update_error"))}},O=()=>{const[f,_]=g.useState(!1),w=async()=>{_(!1),await S(Gr,_t)},L=async()=>{_(!1);const te=n.filter(ce=>ce.parsing_error_count>0);v.success(o.t("feed_table.bulk_refresh_error_feeds_message"));let ne=0,xe=0;for(const ce of te)await T(ce,!1)?ne++:xe++,await Cn(500);v.success(o.t("feed_table.bulk_refresh_error_feeds_result",{success:ne,failure:xe}))},R=()=>_(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{icon:e.jsx(Ie,{}),shape:"circle",onClick:()=>_(!0)}),e.jsx(ee,{className:"edit-modal",onCancel:R,title:o.t("feed_table.refresh_feeds_title"),visible:f,footer:[e.jsx(I,{onClick:R,children:o.t("feed_table.refresh_feeds_cancel")},"cancel"),e.jsx(I,{type:"outline",onClick:L,children:o.t("feed_table.refresh_feeds_error")},"error"),e.jsx(I,{type:"primary",onClick:w,children:o.t("feed_table.refresh_feeds_all")},"all")],children:e.jsx("p",{children:o.t("feed_table.refresh_feeds_description")})})]})},H=async f=>{try{(await Xr(f.key)).status===204?(se(w=>w.filter(L=>L.id!==f.key)),v.success(o.t("feed_table.remove_feed_success",{title:f.title}))):v.error(o.t("feed_table.remove_feed_error",{title:f.title}))}catch(_){console.error(`Failed to unfollow feed: ${f.title}`,_),v.error(o.t("feed_table.remove_feed_error",{title:f.title}))}},D=[{title:o.t("feed_table.table_title"),dataIndex:"title",sorter:(f,_)=>f.title.localeCompare(_.title,"en"),render:(f,_)=>{const w=_.parsing_error_count;let L=_.disabled?`🚫 ${f}`:f;w>0&&(L=`⚠️ ${f}`);const R=e.jsxs("div",{children:[f,w>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"⚠️ Parsing error count: ",w]})]});return e.jsx(y.Ellipsis,{expandable:!1,children:e.jsx(he,{mini:!0,content:R,children:L})})}},!b&&{title:o.t("feed_table.table_url"),dataIndex:"feed_url",sorter:(f,_)=>f.feed_url.localeCompare(_.feed_url,"en"),render:f=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:f})},{title:o.t("feed_table.table_category"),dataIndex:"category.title",sorter:(f,_)=>f.category.title.localeCompare(_.category.title,"en"),render:f=>e.jsx(y.Ellipsis,{expandable:!1,showTooltip:!0,children:e.jsx(me,{children:f})})},!b&&{title:o.t("feed_table.table_checked_at"),dataIndex:"checked_at",sorter:(f,_)=>f.checked_at.localeCompare(_.checked_at,"en"),render:f=>e.jsx(y.Ellipsis,{expandable:!1,children:Vt(f,r)})},{title:o.t("feed_table.table_actions"),dataIndex:"op",fixed:"right",width:100,render:(f,_)=>e.jsxs(Te,{children:[e.jsx("button",{"aria-label":o.t("feed_table.table_feed_edit_label"),className:"list-item-action",onClick:()=>E(_),type:"button",children:e.jsx(ct,{})}),e.jsx("button",{"aria-label":o.t("feed_table.table_feed_refresh_label"),className:"list-item-action",onClick:()=>T(_),type:"button",children:e.jsx(Ie,{})}),e.jsx(Et,{focusLock:!0,position:"left",title:o.t("feed_table.table_feed_remove_confirm"),onOk:()=>H(_),children:e.jsx("span",{className:"list-item-action",children:e.jsx(Rs,{})})})]})}].filter(Boolean),B=async(f,_)=>{try{const w=await mt(f,_);se(L=>L.map(R=>R.id===f?{...R,...w}:R)),v.success(o.t("feed_table.update_feed_success")),u(!1),l.resetFields()}catch{v.error(o.t("feed_table.update_feed_error"))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{alignItems:"center",display:"flex",width:"100%"},children:[e.jsx("div",{style:{display:"flex",flex:1,justifyContent:"center",minWidth:0},children:e.jsx(W.Search,{className:"search-input",placeholder:o.t("feed_table.search_placeholder"),searchButton:!0,onChange:yt})}),e.jsxs("div",{style:{display:"flex",gap:16,paddingBottom:16,paddingLeft:16},children:[e.jsx(I,{icon:e.jsx(ct,{}),shape:"circle",onClick:()=>c(!0)}),e.jsxs(ee,{className:"edit-modal",onOk:N,title:o.t("feed_table.modal_bulk_update_title"),visible:i,onCancel:()=>{c(!1),x("")},children:[e.jsx("p",{children:o.t("feed_table.modal_bulk_update_description")}),e.jsx(W,{placeholder:"rsshub.app",value:h,onChange:f=>x(f)})]}),e.jsx(O,{})]})]}),e.jsx(Ft,{borderCell:!0,className:"feed-table",columns:D,data:a,loading:!s,pagePosition:"bottomCenter",scroll:{x:!0},size:"small"}),j&&e.jsx(ee,{className:"edit-modal",onOk:l.submit,title:o.t("feed_table.modal_edit_feed_title"),unmountOnExit:!0,visible:d,onCancel:()=>{u(!1),l.resetFields()},children:e.jsxs(M,{form:l,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async f=>{const _={categoryId:f.category,title:f.title,siteUrl:f.siteUrl.trim(),feedUrl:f.feedUrl.trim(),hidden:f.hidden,disabled:f.disabled,isFullText:f.crawler};_.feedUrl?await B(j.key,_):v.error(o.t("feed_table.modal_edit_feed_submit_error"))},children:[e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_category_label"),required:!0,field:"category",rules:[{required:!0}],children:e.jsx(P,{children:t.map(f=>e.jsx(P.Option,{value:f.id,children:f.title},f.id))})}),e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_title_label"),field:"title",rules:[{required:!0}],children:e.jsx(W,{placeholder:o.t("feed_table.modal_edit_feed_title_placeholder")})}),e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_site_url_label"),field:"siteUrl",rules:[{required:!0}],children:e.jsx(W,{placeholder:o.t("feed_table.modal_edit_feed_site_url_placeholder")})}),e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_feed_url_label"),field:"feedUrl",rules:[{required:!0}],children:e.jsx(W,{placeholder:o.t("feed_table.modal_edit_feed_feed_url_placeholder")})}),e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_hidden_label"),field:"hidden",initialValue:j.hidden,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})}),e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_disabled_label"),field:"disabled",initialValue:j.disabled,triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})}),e.jsx(M.Item,{label:o.t("feed_table.modal_edit_feed_crawler_label"),field:"crawler",tooltip:e.jsx("div",{children:o.t("feed_table.modal_edit_feed_crawler_tooltip")}),triggerPropName:"checked",rules:[{type:"boolean"}],children:e.jsx(Z,{})})]})})]})},In=[{label:"English",value:"en-US"},{label:"Español",value:"es-ES"},{label:"简体中文",value:"zh-CN"}],En=()=>{const{homePage:t,language:s,markReadOnScroll:r,orderBy:n,pageSize:a,removeDuplicates:o}=p(k),{polyglot:i}=p(V);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("appearance.language_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("appearance.language_description")})]}),e.jsx("div",{children:e.jsx(P,{className:"input-select",onChange:c=>q({language:c}),value:s,children:In.map(({label:c,value:l})=>e.jsx(P.Option,{value:l,children:c},l))})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.default_home_page_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.default_home_page_description")})]}),e.jsx("div",{children:e.jsxs(P,{className:"input-select",onChange:c=>q({homePage:c}),value:t,children:[e.jsx(P.Option,{value:"all",children:i.t("settings.default_home_page_option_all")}),e.jsx(P.Option,{value:"today",children:i.t("settings.default_home_page_option_today")}),e.jsx(P.Option,{value:"starred",children:i.t("settings.default_home_page_option_starred")}),e.jsx(P.Option,{value:"history",children:i.t("settings.default_home_page_option_history")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.entries_order_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.entries_order_description")})]}),e.jsx("div",{children:e.jsxs(P,{className:"input-select",onChange:c=>q({orderBy:c}),value:n,children:[e.jsx(P.Option,{value:"published_at",children:i.t("settings.entries_order_option_published_at")}),e.jsx(P.Option,{value:"created_at",children:i.t("settings.entries_order_option_created_at")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.entries_per_page_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.entries_per_page_description")})]}),e.jsx("div",{children:e.jsx(Ps,{className:"input-select",defaultValue:a,min:1,mode:"button",onChange:c=>q({pageSize:c}),size:"small"})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.remove_duplicates_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.remove_duplicates_description")})]}),e.jsx("div",{children:e.jsxs(P,{className:"input-select",onChange:c=>q({removeDuplicates:c}),value:o,children:[e.jsx(P.Option,{value:"none",children:i.t("settings.remove_duplicates_option_none")}),e.jsx(P.Option,{value:"hash",children:i.t("settings.remove_duplicates_option_hash")}),e.jsx(P.Option,{value:"title",children:i.t("settings.remove_duplicates_option_title")}),e.jsx(P.Option,{value:"url",children:i.t("settings.remove_duplicates_option_url")})]})})]}),e.jsx(K,{}),e.jsxs("div",{className:"setting-row",children:[e.jsxs("div",{children:[e.jsx(y.Title,{heading:6,style:{marginTop:0},children:i.t("settings.mark_read_on_scroll_label")}),e.jsx(y.Text,{type:"secondary",children:i.t("settings.mark_read_on_scroll_description")})]}),e.jsx("div",{children:e.jsx(Z,{checked:r,onChange:c=>q({markReadOnScroll:c})})})]})]})},Fn=()=>{const{polyglot:t}=p(V),s=[{title:t.t("hotkeys.key"),dataIndex:"keyName",render:n=>e.jsx(me,{children:n})},{title:t.t("hotkeys.function"),dataIndex:"description"}],r=[{key:"1",keyName:"Esc",description:t.t("hotkeys.esc")},{key:"2",keyName:"←",description:t.t("hotkeys.left")},{key:"3",keyName:"Ctrl + ←",description:t.t("hotkeys.ctrl_left")},{key:"4",keyName:"→",description:t.t("hotkeys.right")},{key:"5",keyName:"Ctrl + →",description:t.t("hotkeys.ctrl_right")},{key:"6",keyName:"A",description:t.t("hotkeys.a")},{key:"7",keyName:"B",description:t.t("hotkeys.b")},{key:"8",keyName:"D",description:t.t("hotkeys.d")},{key:"9",keyName:"M",description:t.t("hotkeys.m")},{key:"10",keyName:"S",description:t.t("hotkeys.s")},{key:"11",keyName:"V",description:t.t("hotkeys.v")}];return e.jsx(Ft,{borderCell:!0,columns:s,data:r,pagination:!1,size:"small",style:{margin:"0 auto",width:"90%"}})},An=()=>{const{polyglot:t}=p(V),s=(r,n)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r,e.jsx("div",{style:{fontSize:"12px"},children:n})]});return e.jsxs(ae,{className:"custom-tabs",defaultActiveTab:"1",tabPosition:"top",animation:!0,children:[e.jsx(ae.TabPane,{title:s(e.jsx(Ms,{style:{fontSize:"20px"}}),t.t("settings.feeds")),children:e.jsx(Tn,{})},"1"),e.jsx(ae.TabPane,{title:s(e.jsx(Ds,{style:{fontSize:"20px"}}),t.t("settings.categories")),children:e.jsx(Sn,{})},"2"),e.jsx(ae.TabPane,{title:s(e.jsx(Vs,{style:{fontSize:"20px"}}),t.t("settings.general")),children:e.jsx(En,{})},"3"),e.jsx(ae.TabPane,{title:s(e.jsx(zs,{style:{fontSize:"20px"}}),t.t("settings.appearance")),children:e.jsx(wn,{})},"4"),e.jsx(ae.TabPane,{title:s(e.jsx(Os,{style:{fontSize:"20px"}}),t.t("settings.hotkeys")),children:e.jsx(Fn,{})},"5")]})},Nn=[{required:!0}],Ln=[{required:!0}],Rn=[{type:"boolean"}],Pn=()=>{const{setSettingsModalVisible:t,settingsModalVisible:s}=Xe();return e.jsx(ee,{alignCenter:!1,autoFocus:!1,className:"settings-modal",focusLock:!0,footer:null,onCancel:()=>t(!1),title:null,unmountOnExit:!0,visible:s,children:e.jsx(An,{})})},Mn=()=>{const t=p(pe),{polyglot:s}=p(V),{addFeedModalVisible:r,setAddFeedModalVisible:n}=Xe(),[a,o]=g.useState(!1),[i]=M.useForm(),{fetchAppData:c}=tt(),l=async(d,u,h)=>{o(!0);try{await Yr(d,u,h),await c(),v.success(s.t("main.add_feed_success")),n(!1),i.resetFields()}catch{v.error(s.t("main.add_feed_error"))}finally{o(!1)}};return e.jsx(ee,{title:s.t("main.add_feed_modal_title"),visible:r,unmountOnExit:!0,style:{width:"400px"},onOk:i.submit,confirmLoading:a,onCancel:()=>{n(!1),i.resetFields()},children:e.jsxs(M,{form:i,labelCol:{span:7},layout:"vertical",wrapperCol:{span:17},onSubmit:async d=>{const u=d.url.trim();u?await l(u,d.category,d.crawler):v.error(s.t("main.add_feed_url_empty"))},children:[e.jsx(M.Item,{label:s.t("main.add_feed_modal_feed_url_label"),field:"url",rules:Nn,children:e.jsx(W,{placeholder:s.t("main.add_feed_modal_feed_url_placeholder")})}),e.jsx(M.Item,{field:"category",label:s.t("main.add_feed_modal_category_label"),required:!0,rules:Ln,children:e.jsx(P,{placeholder:s.t("main.add_feed_modal_category_placeholder"),showSearch:!0,filterOption:(d,u)=>Ce(u.props.children,d),children:t.map(d=>e.jsx(P.Option,{value:d.id,children:d.title},d.id))})}),e.jsx(M.Item,{field:"crawler",initialValue:!1,label:s.t("main.add_feed_modal_crawler_label"),rules:Rn,style:{marginBottom:0},triggerPropName:"checked",children:e.jsx(Z,{})})]})})},Dn=()=>e.jsxs("div",{className:"main",children:[e.jsx(Us,{}),e.jsx(Pn,{}),e.jsx(Mn,{})]}),rs=()=>{const{theme:t,themeColor:s}=p(k),[r,n]=g.useState(window.matchMedia("(prefers-color-scheme: dark)").matches);g.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),o=i=>n(i.matches);return a.addEventListener("change",o),()=>a.removeEventListener("change",o)},[]),g.useEffect(()=>{const a=o=>{const i=o?"dark":"light";document.body.setAttribute("arco-theme",i),document.body.style.colorScheme=i};es(s),a(t==="system"?r:t==="dark")},[r,t,s])},ns=()=>{const t=document.querySelector(".spinner");t&&(t.style.display="none")},Vn=()=>{Pt(),rs();const{isBelowLarge:t}=fe(),{polyglot:s}=p(V);return g.useEffect(()=>{ns()},[]),s&&e.jsxs("div",{className:"app",children:[t?null:e.jsx($s.Sider,{breakpoint:"lg",className:"sidebar",collapsible:!1,trigger:null,width:240,children:e.jsx(Zt,{})}),e.jsx(bn,{}),e.jsx(Dn,{})]})},as=t=>{const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll("img");return Array.from(r).map(n=>n.getAttribute("src"))},os=t=>{var a;const n=(a=new DOMParser().parseFromString(t.content,"text/html").querySelector("img"))==null?void 0:a.getAttribute("src");return{...t,imgSrc:n}},zn=t=>{if((t==null?void 0:t.total)>=0){const s=t.entries.map(os);ge(s),fn(t.total),Yt(s.length<t.total)}},On=t=>{const{isAppDataReady:s}=p(z),{showStatus:r}=p(k),n=g.useRef(!1),a=async o=>{if(!n.current){n.current=!0,pt(!1);try{const i=r==="unread"?await o(0,"unread"):await o();pt(!0),J(!0),zn(i)}catch(i){console.error("Error fetching articles: ",i),J(!1)}finally{n.current=!1}}};return g.useEffect(()=>{s&&a(t)},[s]),{fetchArticleList:a}},is=It(!1),jt=F(is),st=()=>{const{offset:t}=p(A),{pageSize:s,showStatus:r}=p(k),n=p(is),a=i=>{const c=(l,d)=>d.filter(u=>!l.some(h=>h.id===u.id));ge(l=>[...l,...c(l,i)]),Xt(l=>l+s)};return{handleLoadMore:async i=>{var c;jt(!0);try{const l=r==="unread"?await i(t+s,"unread"):await i(t+s);if(((c=l==null?void 0:l.entries)==null?void 0:c.length)>0){const d=l.entries.map(os);a(d)}else Yt(!1)}catch(l){console.error("Error fetching more articles: ",l)}finally{jt(!1)}},loadingMore:n}},rt=oe({isPhotoSliderVisible:!1,selectedIndex:0}),Un=F(rt,"isPhotoSliderVisible"),$n=F(rt,"selectedIndex"),ls=()=>{const{isPhotoSliderVisible:t,selectedIndex:s}=p(rt);return{isPhotoSliderVisible:t,setIsPhotoSliderVisible:Un,selectedIndex:s,setSelectedIndex:$n}},cs=(t,s)=>{const{activeContent:r,loadMoreVisible:n}=p(A),a=p(et),{isPhotoSliderVisible:o,setIsPhotoSliderVisible:i,setSelectedIndex:c}=ls(),{loadingMore:l}=st(),[d,u]=g.useState(!1),[h,x]=g.useState(!1);g.useEffect(()=>{h&&!l&&(u(!1),x(!1),b())},[l,h]),g.useEffect(()=>{var D;r&&((D=document.querySelector(".card-custom-selected-style"))==null||D.scrollIntoView({behavior:"smooth",block:"nearest"}))},[r]);const j=()=>{r&&(G(null),s.current&&s.current.contentWrapperEl.focus())},m=(D=!1)=>{const B=a.findIndex(f=>f.id===(r==null?void 0:r.id));if(B>0){const f=D?a.slice(0,B).toReversed().find(_=>_.status==="unread"):a[B-1];f&&t(f)}},b=(D=!1)=>{if(d)return;const B=a.findIndex(w=>w.id===(r==null?void 0:r.id));if(B===a.length-1&&n){u(!0),x(!0);return}if(B===-1){s.current.contentWrapperEl.scrollTo({top:0,left:0,behavior:"smooth"});return}const _=D?a.slice(B+1).find(w=>w.status==="unread"):a[B+1];_&&(t(_),x(!1))};return{exitDetailView:j,fetchOriginalArticle:D=>{r&&D()},navigateToNextArticle:b,navigateToPreviousArticle:m,openLinkExternally:()=>{r&&window.open(r.url,"_blank")},openPhotoSlider:()=>{!r||!as(r.content).length||o||(c(0),i(!0),J(!1))},saveToThirdPartyServices:D=>{r&&D()},toggleReadStatus:D=>{r&&D()},toggleStarStatus:D=>{r&&D()}}},Bn=({handleEntryClick:t,entryListRef:s})=>{const{activeContent:r}=p(A),{handleFetchContent:n,handleSaveToThirdPartyServices:a,handleToggleStarred:o,handleToggleStatus:i}=Ze(),{exitDetailView:c,navigateToNextArticle:l,navigateToPreviousArticle:d}=cs(t,s);if(!r)return null;const u=r.status==="unread",h=r.starred;return e.jsxs(I.Group,{className:"action-buttons",children:[e.jsx(I,{icon:e.jsx(Bs,{}),onClick:()=>c(),shape:"round",type:"primary"}),e.jsx(I,{icon:u?e.jsx(At,{}):e.jsx(Nt,{}),onClick:()=>i(r),type:"primary"}),e.jsx(I,{icon:h?e.jsx(We,{style:{color:"#ffcd00"}}):e.jsx(qe,{}),onClick:()=>o(r),type:"primary"}),e.jsx(I,{icon:e.jsx(Hs,{}),onClick:a,type:"primary"}),e.jsx(I,{icon:e.jsx(qs,{}),onClick:()=>d(),type:"primary"}),e.jsx(I,{icon:e.jsx(Ws,{}),onClick:()=>l(),type:"primary"}),e.jsx(I,{icon:e.jsx(Ks,{}),onClick:n,shape:"round",type:"primary"})]})},Hn=({url:t,text:s})=>{const[r,n]=g.useState(!1),a=()=>n(!r);return e.jsx(Js,{to:t,style:{color:"inherit",textDecoration:r?"underline":"none"},onMouseEnter:a,onMouseLeave:a,children:s})},bt=({node:t,index:s,togglePhotoSlider:r,isLinkWrapper:n=!1})=>{var m;const{fontSize:a}=p(k),[o,i]=g.useState(!1),[c,l]=g.useState(!1),{isBelowMedium:d}=fe();g.useEffect(()=>{const E=(n?t.children[0]:t).attribs.src,S=new Image;S.src=E,S.onload=()=>l(S.width<=100&&S.height<=100)},[t,n]);const u=n?t.children[0]:t,h=()=>e.jsx("img",{...u.attribs,alt:u.attribs.alt??"image",style:c?{display:"inline-block",width:"auto",height:`${a}rem`,margin:0}:{}});if(c)return n?e.jsxs("a",{...t.attribs,children:[h(),(m=t.children[1])==null?void 0:m.data]}):h();const x=()=>i(!0),j=()=>i(!1);return e.jsx("div",{style:{textAlign:"center",position:"relative"},children:e.jsxs("div",{style:{display:"inline-block",position:"relative"},onMouseEnter:x,onMouseLeave:j,children:[n?e.jsx("a",{...t.attribs,children:h()}):h(),e.jsx(I,{icon:e.jsx(Qs,{}),shape:"circle",style:{position:"absolute",top:30,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.5)",opacity:d||o?1:0,transition:"opacity 0.3s"},onClick:b=>{b.preventDefault(),r(s)}})]})})},qn=(t,s)=>({replace:r=>{if(r.type==="tag"&&r.name==="a"&&r.children.length>0){const n=r.children[0];if(n.type==="tag"&&n.name==="img"){const a=t.findIndex(o=>o===n.attribs.src);return e.jsx(bt,{node:r,index:a,togglePhotoSlider:s,isLinkWrapper:!0})}}else if(r.type==="tag"&&r.name==="img"){const n=t.findIndex(a=>a===r.attribs.src);return e.jsx(bt,{node:r,index:n,togglePhotoSlider:s})}return r}}),Wn=g.forwardRef(({handleEntryClick:t,entryListRef:s},r)=>{const n=re(),{activeContent:a}=p(A),{articleWidth:o,fontSize:i}=p(k),{isPhotoSliderVisible:c,setIsPhotoSliderVisible:l,selectedIndex:d,setSelectedIndex:u}=ls(),h=()=>{Ne("author"),Ae(a.author)},x=T=>{u(T),l(N=>!N),J(N=>!N)};if(!a)return e.jsxs("div",{ref:r,className:"content-empty",children:[e.jsx(Gs,{style:{fontSize:"64px"}}),e.jsx(y.Title,{heading:6,style:{color:"var(--color-text-3)",marginTop:"10px"},children:"ReactFlux"})]});const j=as(a.content),m=qn(j,x),b=Ys(a.content,m),{id:E,title:S}=a.feed.category;return e.jsxs("article",{className:"article-content",onBlur:()=>J(!1),onFocus:()=>J(!0),ref:r,children:[e.jsxs(He,{className:"scroll-container",children:[e.jsxs("div",{className:"article-header",style:{width:`${o}%`},children:[e.jsx(y.Title,{className:"article-title",heading:3,children:e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title})}),e.jsxs("div",{className:"article-meta",children:[e.jsx(y.Text,{children:e.jsx(Hn,{url:`/feed/${a.feed.id}`,text:a.feed.title})}),e.jsx(y.Text,{onClick:h,style:{cursor:"pointer"},children:` - ${a.author}`}),e.jsx(y.Text,{children:e.jsx(me,{size:"small",style:{marginLeft:"10px",cursor:"pointer"},onClick:()=>n(`/category/${E}`),children:S})})]}),e.jsx(y.Text,{className:"article-date",children:Or(a.published_at)}),e.jsx(K,{})]}),e.jsxs("div",{className:"article-body",style:{fontSize:`${i}rem`,width:`${o}%`},children:[b,e.jsx(Xs,{images:j.map(T=>({src:T,key:T})),loop:!1,visible:c,onClose:()=>{l(!1),J(!0)},index:d,onIndexChange:u})]},a.id)]}),e.jsx(Bn,{handleEntryClick:t,entryListRef:s})]})}),Kn=({alt:t,borderRadius:s,height:r,src:n,status:a,width:o})=>{const[i,c]=g.useState(!1),{ref:l}=Re({triggerOnce:!0,onChange:(d,u)=>{if(d&&!i){const h=new Image;h.onload=()=>c(!0),h.onerror=()=>{u.target.style.display="none"},h.src=n}}});return e.jsx("div",{className:"image-container",ref:l,children:e.jsx("div",{className:"img-placeholder",style:{width:"100%",height:"100%",backgroundColor:"var(--color-fill-2)",position:"absolute",left:0,top:0},children:i?e.jsx("img",{className:a==="unread"?"":"read",src:n,alt:t,style:{width:o,height:r,objectFit:"cover",borderRadius:s}}):e.jsx("div",{className:"skeleton-container",children:e.jsx(ke,{text:{rows:0},image:{style:{width:o,height:r,margin:"0",borderRadius:s}},animation:!0})})})})},Gn=({entry:t,isThumbnail:s})=>{if(!t.imgSrc)return null;const r=s?{width:"80px",height:"80px"}:{width:"100%",height:"160px"};return e.jsx("div",{className:s?"thumbnail":"cover-image",children:e.jsx(Kn,{alt:t.id,borderRadius:s?"2px":void 0,src:t.imgSrc,status:t.status,width:r.width,height:r.height})})},Yn=({entry:t,showFeedIcon:s,mini:r,children:n})=>{const{showDetailedRelativeTime:a}=p(k),o=Le({"article-card-mini-content":r,"article-card-mini-content-padding":r&&s});return e.jsxs("div",{className:o,style:{width:"100%",boxSizing:"border-box",opacity:t.status==="unread"?1:.5},children:[e.jsx("div",{style:{padding:t.imgSrc?r?"0 10px 0 0":"0 0 10px 0":"0"},children:e.jsx(Gn,{entry:t,isThumbnail:r})}),e.jsxs("div",{className:r?"article-card-mini-content-text":"",children:[e.jsx(y.Text,{className:"article-card-title",children:t.title}),e.jsxs(y.Text,{className:"article-card-info",children:[e.jsx("br",{}),s&&e.jsx(Jt,{feed:t.feed,className:r?"feed-icon-mini":"feed-icon"}),t.feed.title,e.jsx("br",{}),Vt(t.published_at,a)]}),t.starred&&e.jsx(We,{className:"icon-starred"})]}),e.jsx("div",{children:n})]})},Xn=({entry:t,handleEntryClick:s,mini:r,children:n})=>{const{markReadOnScroll:a,showFeedIcon:o}=p(k),{activeContent:i}=p(A),{polyglot:c}=p(V),l=i&&t.id===i.id,{handleToggleStarred:d,handleToggleStatus:u}=Ze(),[h,x]=g.useState(0),j=100,m=.5,b=t.starred,E=t.status==="unread",S=Zs({preventScrollOnSwipe:!0,delta:j/2,onSwiping:w=>{const L=Math.min(Math.abs(w.deltaX*m),j)*Math.sign(w.deltaX);x(L)},onSwiped:async w=>{try{w.deltaX>j?(await d(t),v.success(b?c.t("article_card.unmarked_as_starred"):c.t("article_card.marked_as_starred"))):w.deltaX<-j&&(await u(t),v.success(E?c.t("article_card.marked_as_read"):c.t("article_card.marked_as_unread")))}catch{v.error(c.t("article_card.update_failed"))}x(0)}}),[T,N]=g.useState(!1),[O,H]=g.useState(!1),D=()=>u(t),B=20,{ref:f}=Re({skip:O,onChange:async(w,L)=>{if(!(!a||!E)){if(w)N(!0);else if(T){const{top:R}=L.boundingClientRect;R<B&&(await D(),H(!0))}}}}),_=er({x:h});return g.createElement("div",{...S,className:"article-card",key:t.id},e.jsxs("div",{ref:f,children:[e.jsx(tr.div,{className:"swipe-card",style:_,children:e.jsx(Ee,{className:Le("swipe-content","card-custom-style","card-custom-hover-style",{"card-custom-selected-style":l}),"data-entry-id":t.id,hoverable:!0,onClick:()=>s(t),bordered:!1,children:e.jsx(Ee.Meta,{description:e.jsx(Yn,{entry:t,showFeedIcon:o,mini:r,children:n})})})}),e.jsxs("div",{className:"swipe-actions",children:[e.jsx("div",{className:"swipe-action left",children:b?e.jsx(We,{style:{color:"#ffcd00",fontSize:"24px"}}):e.jsx(qe,{style:{color:"#ffffff",fontSize:"24px"}})}),e.jsx("div",{className:"swipe-action right",children:E?e.jsx(At,{style:{color:"#ffffff",fontSize:"24px"}}):e.jsx(Nt,{style:{color:"#ffffff",fontSize:"24px"}})})]})]}))},Jn=()=>{const{layout:t}=p(k),{isArticleListReady:s}=p(A),r=t==="large"?2:4,n=a=>e.jsx(Ee,{className:"card-style",cover:t==="large"?e.jsx("div",{className:"card-cover-style"}):null,children:e.jsx(Ee.Meta,{description:e.jsx(ke,{loading:!s,animation:!0,text:{rows:3,width:150}})})},a);return!s&&Array.from({length:r},(a,o)=>n(o))},Qn=()=>{const{orderDirection:t}=p(k),{filterString:s,filterType:r}=p(A),{polyglot:n}=p(V),{isBelowMedium:a}=fe(),o=()=>{q({orderDirection:t==="desc"?"asc":"desc"})};return g.useEffect(()=>{Ne("title"),Ae("")},[]),e.jsxs("div",{className:"search-and-sort-bar",children:[e.jsx(W.Search,{allowClear:!0,onBlur:()=>J(!0),onFocus:()=>J(!1),onChange:Ae,placeholder:n.t("article_list.search_placeholder"),style:{width:a?"100%":272,marginLeft:8},value:s,addBefore:e.jsxs(P,{onChange:Ne,style:{width:100},value:r,children:[e.jsx(P.Option,{value:"title",children:n.t("article_list.search_type_title")}),e.jsx(P.Option,{value:"content",children:n.t("article_list.search_type_content")}),e.jsx(P.Option,{value:"author",children:n.t("article_list.search_type_author")})]})}),e.jsxs("div",{className:"button-group",children:[e.jsx(he,{mini:!0,content:e.jsx("div",{children:n.t("article_list.search_tooltip").split(`
`).map((i,c)=>e.jsxs(g.Fragment,{children:[i,c<n.t("article_list.search_tooltip").split(`
`).length-1&&e.jsx("br",{})]},`line-${c}-${i.length}`))}),children:e.jsx(I,{shape:"circle",size:"small",icon:e.jsx(sr,{}),onClick:()=>J(!1)})}),e.jsx(he,{mini:!0,content:t==="desc"?n.t("article_list.sort_direction_desc"):n.t("article_list.sort_direction_asc"),children:e.jsx(I,{shape:"circle",size:"small",icon:t==="desc"?e.jsx(rr,{}):e.jsx(nr,{}),onClick:o})})]})]})},Zn=(...t)=>s=>{for(const r of t)typeof r=="function"?r(s):r&&typeof r=="object"&&(r.current=s)},ea=(t,s,r)=>{g.useLayoutEffect(()=>{let n=null;return t>0&&(clearTimeout(n),n=setTimeout(()=>{r(),clearTimeout(n)},s*4)),()=>clearTimeout(n)},[t,s,r])},ta=({duration:t,color:s})=>{const[r,n]=g.useState([]);ea(r.length,t,()=>{n([])});const a=o=>{const i=o.currentTarget.getBoundingClientRect(),c=i.width>i.height?i.width:i.height,l=o.pageX-i.x-c/2,d=o.pageY-i.y-c/2,u={x:l,y:d,size:c,id:`${new Date().getTime()}-${l}-${d}`};n([...r,u])};return e.jsx("div",{className:"ripple-container",onMouseDown:a,children:r.length>0&&r.map(o=>e.jsx("span",{className:"ripple-span",style:{top:o.y,left:o.x,width:o.size,height:o.size,backgroundColor:s,animationDuration:`${t}ms`}},o.id))})},sa=({getEntries:t})=>{const{isArticleListReady:s,loadMoreVisible:r}=p(A),{loadingMore:n,handleLoadMore:a}=st(),{ref:o}=Re({skip:!r,onChange:async i=>{!i||!s||n||await a(t)}});return s&&r&&e.jsxs("div",{className:"load-more-container",ref:o,children:[e.jsx(or,{loading:n,style:{paddingRight:"10px"}}),"Loading more ..."]})},ra=g.forwardRef(({getEntries:t,handleEntryClick:s,cardsRef:r},n)=>{const{layout:a,pageSize:o}=p(k),i=a==="small",{isArticleListReady:c,loadMoreVisible:l}=p(A),d=p(et),u=d.length-Math.ceil(o*.2)-1,{loadingMore:h,handleLoadMore:x}=st(),{ref:j}=Re({skip:!l,onChange:async S=>{!S||!c||h||await x(t)}}),m=ar({count:d.length,getScrollElement:()=>r.current,estimateSize:()=>i?120:280}),b=m.getVirtualItems(),E=g.useCallback(S=>S===u?Zn(m.measureElement,j):m.measureElement,[u,m.measureElement,j]);return g.useEffect(()=>{d.length>=o||!h&&l&&x(t)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(Qn,{}),e.jsxs(He,{className:"entry-list",ref:n,children:[e.jsx(Jn,{}),c&&e.jsx("div",{ref:r,children:e.jsx("div",{style:{height:m.getTotalSize(),width:"100%",position:"relative"},children:b.map(S=>e.jsx("div",{"data-index":S.index,ref:E(S.index),style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${S.start}px)`},children:e.jsx(Xn,{entry:d[S.index],handleEntryClick:s,mini:i,children:e.jsx(ta,{color:"var(--color-text-4)",duration:1e3})})},S.key))})}),e.jsx(sa,{getEntries:t})]})]})}),na=()=>{ge(t=>t.map(s=>({...s,status:"read"})))},aa=({info:t,refreshArticleList:s,markAllAsRead:r})=>{const{isArticleListReady:n}=p(A),{showStatus:a}=p(k),{polyglot:o}=p(V),{fetchAppData:i}=tt(),c=async()=>{try{await r(),na(),await i(),v.success(o.t("article_list.mark_all_as_read_success"))}catch{v.error(o.t("article_list.mark_all_as_read_error"))}},l=d=>{q({showStatus:d})};return g.useEffect(()=>{Ne("title"),Ae("")},[a]),e.jsxs("div",{className:"entry-panel",children:[e.jsx(Et,{focusLock:!0,onOk:c,title:o.t("article_list.mark_all_as_read_confirm"),children:e.jsx(I,{icon:e.jsx(kt,{}),shape:"circle",style:{visibility:["starred","history"].includes(t.from)?"hidden":"visible"}})}),e.jsx(ir.Group,{onChange:l,options:[{label:o.t("article_list.filter_status_all"),value:"all"},{label:o.t("article_list.filter_status_unread"),value:"unread"}],style:{visibility:t.from==="history"?"hidden":"visible"},type:"button",value:a}),e.jsx(I,{icon:e.jsx(Ie,{}),loading:!n,shape:"circle",onClick:s})]})},le=({info:t,getEntries:s,markAllAsRead:r})=>{const{activeContent:n,isArticleFocused:a,isArticleListReady:o}=p(A),{isAppDataReady:i}=p(z),{orderBy:c,orderDirection:l,showAllFeeds:d,showStatus:u}=p(k),h=p(et),x=p(Qe),{polyglot:j}=p(V),{handleFetchContent:m,handleSaveToThirdPartyServices:b,handleToggleStarred:E,handleToggleStatus:S,handleEntryStatusUpdate:T}=Ze(),{fetchAppData:N}=tt(),{fetchArticleList:O}=On(s),H=g.useRef(null),D=g.useRef(null),B=g.useRef(null);g.useEffect(()=>{mn(t.from),n&&G(null),de(s)},[t]),g.useEffect(()=>{["starred","history"].includes(t.from)||de(s)},[c]),g.useEffect(()=>{x.length===0||["starred","history"].includes(t.from)||de(s)},[d]),g.useEffect(()=>{de(s)},[l,u]);const f=async X=>{if(G(null),X.status!=="unread"){setTimeout(()=>{G({...X,status:"read"})},200);return}try{setTimeout(()=>{G({...X,status:"read"}),T(X,"read")},200),await Me([X.id],"read")}catch{v.error(j.t("content.mark_as_read_error")),T(X,"unread")}},{exitDetailView:_,fetchOriginalArticle:w,navigateToNextArticle:L,navigateToPreviousArticle:R,openLinkExternally:te,openPhotoSlider:ne,saveToThirdPartyServices:xe,toggleReadStatus:ce,toggleStarStatus:nt}=cs(f,H);g.useEffect(()=>{const X={ArrowLeft:()=>R(),ArrowRight:()=>L(),Escape:()=>_(),a:()=>xe(b),b:te,d:()=>w(m),m:()=>ce(()=>S(n)),s:()=>nt(()=>E(n)),v:ne},De=ue=>{const at=X[ue.key];at&&(ue.key==="ArrowLeft"?R(ue.ctrlKey):ue.key==="ArrowRight"?L(ue.ctrlKey):at())};return a?document.addEventListener("keydown",De):document.removeEventListener("keydown",De),()=>{document.removeEventListener("keydown",De)}},[n,h,a]);const de=async X=>{Xt(0),i?await O(X):await N()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entry-col",children:[e.jsx(dt,{in:o,timeout:200,nodeRef:D,classNames:"fade",children:e.jsx(ra,{cardsRef:D,getEntries:s,handleEntryClick:f,ref:H})}),e.jsx(aa,{info:t,refreshArticleList:()=>de(s),markAllAsRead:r})]}),e.jsx(dt,{in:n!==null,timeout:200,nodeRef:B,classNames:"fade",unmountOnExit:!0,children:e.jsx(Wn,{handleEntryClick:f,entryListRef:H,ref:B})})]})},oa=()=>e.jsx(le,{info:{from:"all",id:""},getEntries:Hr,markAllAsRead:tn}),ia=()=>{const{id:t}=Lt(),s=$("orderBy"),r=$("pageSize"),n=$("showAllFeeds"),a=async(o=0,i=null)=>{const c={baseUrl:`/v1/categories/${t}/entries`,orderField:s,offset:o,limit:r,status:i},l={globally_visible:!n};return C.get(ie(c,l))};return e.jsx(le,{info:{from:"category",id:t},getEntries:a,markAllAsRead:()=>Mr(t)})},la=()=>{const t=re(),s=lr();return console.error(s),e.jsx("div",{id:"error-page",style:{top:"30%",position:"relative"},children:e.jsx(cr,{status:"404",subTitle:s.statusText||s.message,extra:[e.jsx(I,{type:"primary",onClick:()=>t("/"),children:"Back to Home"},"back")]})})},ca=()=>{const{id:t}=Lt(),s=$("orderBy"),r=$("pageSize"),n=async(a=0,o=null)=>{const i={baseUrl:`/v1/feeds/${t}/entries`,orderField:s,offset:a,limit:r,status:o};return C.get(ie(i))};return e.jsx(le,{info:{from:"feed",id:t},getEntries:n,markAllAsRead:()=>Jr(t)})},da=()=>e.jsx(le,{info:{from:"history",id:""},getEntries:Ot}),ua=t=>{const s=t.getFieldsValue();let r=!0;for(const[n,a]of Object.entries(s))if(n!=="password"){const o=a==null?void 0:a.trim();t.setFieldValue(n,o),o||(r=!1)}else a||(r=!1);return r},ve=(t,s)=>{t.key==="Enter"&&s.submit()},ha=()=>{Pt(),rs();const t=p(Pe),{homePage:s}=p(k),{polyglot:r}=p(V),[n]=dr(),[a,o]=g.useState(!1),[i,c]=g.useState("token"),l=re(),d=async()=>{o(!0);const{server:h,token:x,username:j,password:m}=n.getFieldsValue();try{(await wt.raw("v1/me",{baseURL:h,headers:x?{"X-Auth-Token":x}:{Authorization:`Basic ${btoa(`${j}:${m}`)}`}})).status===200&&(v.success(r.t("login.success")),Dt({server:h,token:x,username:j,password:m}),l("/"))}catch(b){console.error(b),v.error(b.message)}o(!1)},u=async()=>{const h=n.getFieldsValue();if(!Fe(h)){v.error(r.t("login.auth_error"));return}await d()};return g.useEffect(()=>{ns()},[]),Fe(t)?e.jsx(Ke,{to:`/${s}`}):r&&e.jsxs("div",{className:"page-layout",children:[e.jsx("div",{className:"form-panel",children:e.jsxs("div",{className:"login-form",children:[e.jsx(y.Title,{heading:3,children:r.t("login.login_to_your_server")}),e.jsxs(M,{autoComplete:"off",form:n,layout:"vertical",onSubmit:async()=>{ua(n)?await u():v.error(r.t("login.submit_error"))},children:[e.jsx(M.Item,{field:"server",label:r.t("login.server_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,n)},children:e.jsx(W,{disabled:a,placeholder:r.t("login.server_placeholder"),prefix:e.jsx(ur,{})})}),i==="token"&&e.jsx(M.Item,{field:"token",label:r.t("login.token_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,n)},children:e.jsx(W.Password,{disabled:a,placeholder:r.t("login.token_placeholder"),prefix:e.jsx(ut,{})})}),i==="user"&&e.jsxs(e.Fragment,{children:[e.jsx(M.Item,{field:"username",label:r.t("login.username_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,n)},children:e.jsx(W,{disabled:a,placeholder:r.t("login.username_placeholder"),prefix:e.jsx(Tt,{})})}),e.jsx(M.Item,{field:"password",label:r.t("login.password_label"),rules:[{required:!0}],onKeyDown:h=>{ve(h,n)},children:e.jsx(W.Password,{disabled:a,placeholder:r.t("login.password_placeholder"),prefix:e.jsx(ut,{})})})]})]}),e.jsx(I,{loading:a,type:"primary",long:!0,onClick:()=>n.submit(),style:{marginTop:"20px"},children:r.t("login.login_button")}),e.jsx(K,{orientation:"center",children:r.t("login.another_login_method")}),e.jsx(I,{type:"secondary",long:!0,onClick:()=>c(i==="token"?"user":"token"),style:{marginTop:"20px"},children:i==="token"?r.t("login.another_login_button"):r.t("login.token_label")}),e.jsxs("div",{style:{display:"flex",marginTop:"40px"},children:[e.jsx(y.Text,{disabled:!0,children:r.t("login.need_help")}),e.jsx(hr,{href:"https://miniflux.app/docs/api.html#authentication",style:{fontWeight:"500"},children:r.t("login.miniflux_official_website")})]})]})}),e.jsx("div",{className:"background"})]})},ma=({children:t})=>{const s=p(Pe);return Fe(s)?e.jsx(e.Fragment,{children:t}):e.jsx(Ke,{to:"/login"})},fa=()=>e.jsx(le,{info:{from:"starred",id:""},getEntries:zt}),pa=()=>{const t=async()=>{const s=await we(0,"unread"),r=s.total;let n=s.entries;r>n.length&&(n=we(0,"unread",r).then(o=>o.entries));const a=n.map(o=>o.id);return Me(a,"read")};return e.jsx(le,{info:{from:"today",id:""},getEntries:we,markAllAsRead:t})},ga=$("homePage"),xa=[{path:"/all",element:e.jsx(oa,{})},{path:"/today",element:e.jsx(pa,{})},{path:"/starred",element:e.jsx(fa,{})},{path:"/history",element:e.jsx(da,{})},{path:"/category/:id",element:e.jsx(ia,{})},{path:"/feed/:id",element:e.jsx(ca,{})}],ds=mr([{path:"/",element:e.jsx(ma,{children:e.jsx(Vn,{})}),errorElement:e.jsx(la,{}),children:[...xa,{index:!0,element:e.jsx(Ke,{to:`/${ga}`,replace:!0})}]},{path:"/login",element:e.jsx(ha,{})}]),ya={"zh-CN":yr,"es-ES":_r},_a=()=>ya[wr()]||xr;fr.createRoot(document.getElementById("root")).render(e.jsx(pr,{locale:_a(),children:e.jsx(gr,{router:ds})}));
